#include "fsystem.h"
#include "globals.h"

#ifndef READ_ONLY
#if WITHFAT12 == 1
struct DSKSZTOSECPERCLUS const DskTableFAT12 [] = {
	{ 4085, 1},
	{ 8170, 2},
	{ 16340, 4},
	{ 32680, 8},
	{ 0xFFFFFFFF, 0} /* any disk greater than 16MB, 0 value for SecPerClusVal trips an error */
};
#endif

struct DSKSZTOSECPERCLUS const DskTableFAT16 [] = {
	{ 8400, 1}, //modify by zhangyan /* disks up to 4.1 MB, the 0 value for SecPerClusVal trips an error */
	{ 32680, 2}, /* disks up to 16 MB, 1k cluster */
	{ 262144, 4}, /* disks up to 128 MB, 2k cluster */
	{ 524288, 8}, /* disks up to 256 MB, 4k cluster */
	{ 1048576, 16}, /* disks up to 512 MB, 8k cluster */
	/* The entries after this point are not used unless FAT16 is forced */
	{ 2097152, 32}, /* disks up to 1 GB, 16k cluster */
	{ 4194304, 64}, /* disks up to 2 GB, 32k cluster */
	{ 0xFFFFFFFF, 0} /* any disk greater than 2GB, 0 value for SecPerClusVal trips an error */
};

#if 0  // dominant modified to support advanced cluster size
struct DSKSZTOSECPERCLUS const DskTableFAT32 [] = {
	{ 66600, 0}, /* disks up to 32.5 MB, the 0 value for SecPerClusVal trips an error */
	{ 532480, 1}, /* disks up to 260 MB, .5k cluster */
	{ 16777216, 8}, /* disks up to 8 GB, 4k cluster */
	{ 33554432, 16}, /* disks up to 16 GB, 8k cluster */
	{ 67108864, 32}, /* disks up to 32 GB, 16k cluster */
	{ 0xFFFFFFFF, 64}/* disks greater than 32GB, 32k cluster */
};
#else
struct DSKSZTOSECPERCLUS const DskTableFAT32 [] = {
	{ 532480, 1}, /* disks up to 260 MB,  512Byte cluster */
	{ 1048576, 8}, /* disks up to 512 MB, 4KB cluster */
	{ 2097152, 16}, /* disks up to 1 GB, 8KB cluster */	
	{ 4194304, 32}, /* disks up to 2 GB, 16KB cluster */	
	{ 67108864, 64}, /* disks up to 32 GB, 32KB cluster */
	{ 0xFFFFFFFF, 64}/* disks greater than 32GB, 32k cluster */
};
#endif

struct DSKSZTOSECPERCLUS const DskTableEXFAT [] = {
	{ 14336, 2}, /* disks up to 7 MB, 1k cluster*/
	{ 524228, 8},  /* disks up to 256 MB, 4k cluster*/
	{ 67108864, 64}, /* disks up to 32 GB,  32k cluster */
	{ 0xFFFFFFFF, 256} /* disks greater than 128GB, 128k cluster */
};

//if disk size > 512M, FAT32 is more good than FAT16.
/***************************************************************************/
BOOLEAN FAT16_Format(INT16S dsk, INT32U sector_offset,  INT32U sector_number, INT8U *buf)
{
	INT32U TempValue;
	INT16U nfsect, reser_sector1 = 1, reser_sector2, data;
	INT16U nsector, FATStartSector, RootEndSector, i;
#ifdef	unSP
	INT16U *bp = (INT16U *)buf;
#else
	INT8U *bp = (INT8U *)buf;
#endif
#if FS_FORMAT_SPEEDUP == 1	
	INT32U *p_format_temp_buffer;
#endif

#if _FAT_CLUSTER_SIZE_4K == 1
	nsector = 0x08;
#else
	for (i=0; i<8; i++) {
		if (sector_number <= DskTableFAT16[i].DiskSize) {
			nsector = DskTableFAT16[i].SecPerClusVal;
			if (nsector == 0){
				return FALSE;				 
			}
			break;
		}
	}
#endif
	// ( 簇总数 ＋ 2个保留扇区 ) 占用多少个扇区 
	TempValue = sector_number / nsector;	
	nfsect = ( INT16U)((TempValue+2+255)>>8);
	
	//fmemset(bp, 0, 512>>WORD_PACK_VALUE);
    memset(bp, 0, 512);  // dominant modify
    
	if ( 0 != dskxfer(dsk, sector_offset, (INT32U)bp, 1, DSKWRITE) )
	{
		return FALSE;			
	}

	FATStartSector = 1+sector_offset; 
	RootEndSector = FATStartSector + (nfsect<<1)+(0x0200*32+(512-1))/512;
	
	//==========================================================================
	//修改者 ：   wangzhq
	//修改时间 ： 2010/06/17
	//修改原因 :  保证data区的起始sector为16kbyte的整数倍
	//==========================================================================
	if(RootEndSector%ALIGN_16)
	{
	   reser_sector2 = RootEndSector/ALIGN_16 + 1;
	   reser_sector2 *= ALIGN_16;
	   data = reser_sector2;
	   
	   reser_sector2 = reser_sector2 - RootEndSector;
       FATStartSector = FATStartSector + reser_sector2 ;
	   reser_sector1  = FATStartSector - sector_offset;
	   RootEndSector = data;
	   /*
	   for(reser_sector1=1; ;reser_sector1++)
	   {
	     FATStartSector = reser_sector1+sector_offset;   //fat的起始sector
	
		 RootEndSector = FATStartSector + (nfsect<<1)+(0x0200*32+(512-1))/512;
		
		  if(reser_sector2 == RootEndSector)
		  {
		     break;
		  }
	   }*/
	   
	}

	//memset(bp, 0, 512>>WORD_PACK_VALUE);
    memset(bp, 0, 512);  // dominant modify

	
#if FS_FORMAT_SPEEDUP == 1
	p_format_temp_buffer = (INT32U*)gp_malloc_align(C_FS_FORMAT_BUFFER_SIZE,4);
	if(p_format_temp_buffer)
	{
		gp_memset((INT8S*)p_format_temp_buffer, 0, C_FS_FORMAT_BUFFER_SIZE>>WORD_PACK_VALUE);
		for (i = FATStartSector; i < RootEndSector; i += C_FS_FORMAT_BUFFER_SECTOR_SIZE)
		{
			if( 0 != FileSysDrv[dsk]->Drv_WriteSector(i, C_FS_FORMAT_BUFFER_SECTOR_SIZE, (INT32U)p_format_temp_buffer) )
			{
			#if FS_FORMAT_SPEEDUP_BUFFER_SOURCE == ALLOCATE_BUFFER
				gp_free(p_format_temp_buffer);
			#endif
				return FALSE;
			}
		}
		if(i > RootEndSector)
		{
			if( 0 != FileSysDrv[dsk]->Drv_WriteSector(i - C_FS_FORMAT_BUFFER_SECTOR_SIZE, C_FS_FORMAT_BUFFER_SECTOR_SIZE - (i - RootEndSector), (INT32U)p_format_temp_buffer) )
			{
			#if FS_FORMAT_SPEEDUP_BUFFER_SOURCE == ALLOCATE_BUFFER
				gp_free(p_format_temp_buffer);
			#endif
				return FALSE;
			}
		}
	}
	else
#endif
	{
		for (i=FATStartSector; i<RootEndSector; i++)
		{
			if ( (i == FATStartSector) || (i == FATStartSector+nfsect) ) 
			{
				continue;
			}

		    if ( 0 != dskxfer(dsk, i, (INT32U)bp, 1, DSKWRITE) )
			{
			#if (FS_FORMAT_SPEEDUP == 1) && (FS_FORMAT_SPEEDUP_BUFFER_SOURCE == ALLOCATE_BUFFER)
				gp_free(p_format_temp_buffer);
			#endif
				return FALSE;			
			}
			format_printf1("%d ", i);
		}
	}
	
#ifdef unSP
	bp[0] = 0xfff8;
	bp[1] = 0xffff;
#else
	memset(bp, 0xff, 4);
	bp[0] = 0xf8;
#endif

	if ( 0 != dskxfer(dsk, FATStartSector, (INT32U)bp, 1, DSKWRITE) )
	{
	#if (FS_FORMAT_SPEEDUP == 1) && (FS_FORMAT_SPEEDUP_BUFFER_SOURCE == ALLOCATE_BUFFER)
		gp_free(p_format_temp_buffer);
	#endif
		return FALSE;			
	}
	if ( 0 != dskxfer(dsk, FATStartSector + nfsect, (INT32U)bp, 1, DSKWRITE) )
	{
	#if (FS_FORMAT_SPEEDUP == 1) && (FS_FORMAT_SPEEDUP_BUFFER_SOURCE == ALLOCATE_BUFFER)
		gp_free(p_format_temp_buffer);
	#endif
		return FALSE;
	}
	
	//fmemset(bp, 0, 512>>WORD_PACK_VALUE);
    memset(bp, 0, 512);

#ifdef	unSP
	bp[0] =  0x3ceb;
	bp[1] =  0x90+('M'<<8);
	bp[2] =  'S'+('W'<<8);
	bp[3] =  'I'+('N'<<8);
	bp[4] =  '4'+('.'<<8);
	bp[5] =  '1'+(0<<8);
	bp[6] =  0x02+(nsector<<8); 		 //DBR_nbyte_Addr 	 + 	 DBR_nsector_Addr	 
#else
	bp[0] = 0xeb, bp[1] = 0x3c, bp[2] = 0x90;	// 0xEB 3C 90
	strcpy((CHAR *) bp+3, "MSWIN5.1");				// MSWIN4.1
	bp[12] = 0x02;								// 0x0200=512 bytes per sector
	bp[13] = nsector;
#endif

	putword(&bp[DBR_nreserved_Addr>>WORD_PACK_VALUE], reser_sector1);

#ifdef	unSP
	bp[8] = 0x0002; 		 //DBR_nfat_Addr 	 = 0x02
	bp[9] = 0x0002; 	 //DBR_ndirent_Addr= 0x0200
	bp[10] = 0xf800; 	 // DBR_mdesc_Addr = 0xf8	 
#else
	putword(&bp[16], 0x02);
	putword(&bp[18], 0x0002);
	putword(&bp[20], 0xf800);
#endif

	if (sector_number > 65535 )		
	{
		putword(&bp[DBR_nsize_Addr], 0x0000);
		putlong(&bp[DBR_huge_Addr>>WORD_PACK_VALUE], sector_number);
	}
	else
	{
	#ifdef unSP
		bp[9] |= (sector_number & 0xFF)<<8; 	 //DBR_nsize_Addr
		bp[10] |= (sector_number >> 8) & 0xFF; 	 //DBR_nsize_Addr
	#else
		bp[19] = sector_number & 0xFF;
		bp[20] = (sector_number >> 8) & 0xFF;	
	#endif
		putlong(&bp[DBR_huge_Addr>>WORD_PACK_VALUE], 0x00000000);		 
	}
	 
	putword(&bp[DBR_nfsect_Addr>>WORD_PACK_VALUE], nfsect);
	putlong(&bp[DBR_hidden_Addr>>WORD_PACK_VALUE], sector_offset);

#ifdef	unSP
	bp[19] =  0x29 + (0x14<<8);
	bp[20] =  0x10+(0x04<<8);
	bp[21] =  0x20+('N'<<8);
	bp[22] =  'O'+(' '<<8);
	bp[23] =  'N'+('A'<<8);
	bp[24] =  'M'+('E'<<8);
	bp[25] =  ' '+(' '<<8);
	bp[26] =  ' '+(' '<<8);	 
	bp[27] =  'F'+('A'<<8);
	bp[28] =  'T'+('1'<<8);
	bp[29] =  '6';	 
#else
	bp[38] = 0x29;
	putlong(&bp[DBR_FAT16_VOL_ID], 0x20041014);
	memcpy(&bp[DBR_FAT16_VOL_LAB], "NO NAME    ", 11);	
	memcpy(&bp[DBR_FAT16_FilSysType], "FAT16", 5);
#endif

	bp[36>>WORD_PACK_VALUE] = 0x80;       //BS_DrvNum     0x00 for floopy disks, 0x80 for hard disks	 

	putword(&bp[DBR_end_Addr>>WORD_PACK_VALUE], 0xaa55);
	if ( 0 != dskxfer(dsk, sector_offset, (INT32U)bp, 1, DSKWRITE) )
	{
	#if (FS_FORMAT_SPEEDUP == 1) && (FS_FORMAT_SPEEDUP_BUFFER_SOURCE == ALLOCATE_BUFFER)
		gp_free(p_format_temp_buffer);
	#endif
		return FALSE;			
	}
	
#if (FS_FORMAT_SPEEDUP == 1) && (FS_FORMAT_SPEEDUP_BUFFER_SOURCE == ALLOCATE_BUFFER)
	gp_free(p_format_temp_buffer);
#endif
	return TRUE; 
}

/***************************************************************************/
BOOLEAN FAT32_Format(INT16S dsk, INT32U sector_offset,  INT32U sector_number, INT8U *buf)
{
	INT32U TmpVal1,TmpVal2, nfsect, reser_sector1, reser_sector2;
	INT32U nsector, FATStartSector, FATEndSector, i;
	INT16U BPB_BkBootSec = 6;
#ifdef	unSP
	INT16U *bp = (INT16U *)buf;
#else
	INT8U *bp = (INT8U *)buf;
#endif
#if FS_FORMAT_SPEEDUP == 1	
	INT32U *p_format_temp_buffer;
#endif

	for (i=0; i < 6; i++)
	{
		if (sector_number <= DskTableFAT32[i].DiskSize) 
		{
			nsector = DskTableFAT32[i].SecPerClusVal;
			if (nsector == 0) 
			{
				format_printf("fail to format\n");
				return FALSE;
			}
			break;
		}
	}
	
	TmpVal1 = sector_number - (32);
	TmpVal2 = ((256 * nsector) + 2) >> 1;
	nfsect = (TmpVal1 + (TmpVal2 - 1)) / TmpVal2;  // two fat table size
  
  
  	FATStartSector = 0x0020 + sector_offset; 
	FATEndSector = FATStartSector + (nfsect << 1);
	//==========================================================================
	//修改者 ：   wangzhq
	//修改时间 ： 2010/06/17
	//修改原因 :  保证data区的起始sector为16kbyte的整数倍
	//==========================================================================
	if(FATEndSector%ALIGN_16)
	{
	   reser_sector2 = FATEndSector/ALIGN_16 + 1;
	   reser_sector2 *= ALIGN_16;
	   
	   for(reser_sector1=32; ;reser_sector1++)
	   {
	      TmpVal1 = sector_number - (reser_sector1);         //计算出该分区中总的sector数，其中32为reserve sector
		  TmpVal2 = ((256 * nsector) + 2) >> 1;   //计算每个簇所占的word数目
		  nfsect = (TmpVal1 + (TmpVal2 - 1)) / TmpVal2; //计算fat占用的总sector数目
	
	
		  FATStartSector = reser_sector1 + sector_offset; 
		  FATEndSector = FATStartSector + (nfsect << 1);
		  
		  if(reser_sector2 == FATEndSector)
		  {
		     break;
		  }
	   }
	   
	}
	
	
	fmemset(bp, 0, 512>>WORD_PACK_VALUE);
	if ( 0 != dskxfer(dsk, sector_offset, (INT32U)bp, 1, DSKWRITE) )
	{
		return FALSE;			
	}
	
	//memset(bp, 0, 512>>WORD_PACK_VALUE);
	
	putlong(&bp[0], 0x41615252); 			 //First Signature
	putlong(&bp[0x01e4>>WORD_PACK_VALUE], 0x61417272); 	 //Signture of FSInfo sector
	putlong(&bp[0x01e8>>WORD_PACK_VALUE], 0xffffffff); 	 //remain clusters
	putlong(&bp[0x01ec>>WORD_PACK_VALUE], 0x02); 	        //next clusters
	putword(&bp[DBR_end_Addr>>WORD_PACK_VALUE], 0xaa55);
	if ( 0 != dskxfer(dsk, sector_offset + 1, (INT32U)bp, 1, DSKWRITE) )
	{
		return FALSE;			
	}
	if ( 0 != dskxfer(dsk, sector_offset + 1 + BPB_BkBootSec, (INT32U)bp, 1, DSKWRITE) )
	{
		return FALSE;			
	}
	
	//FATStartSector = 0x0020 + sector_offset; 
	//FATEndSector = FATStartSector + (nfsect << 1);
	memset(bp, 0, 512>>WORD_PACK_VALUE);
	
#if FS_FORMAT_SPEEDUP == 1
#if FS_FORMAT_SPEEDUP_BUFFER_SOURCE == ALLOCATE_BUFFER
	p_format_temp_buffer = (INT32U*)gp_malloc_align(C_FS_FORMAT_BUFFER_SIZE,4);
#else
	p_format_temp_buffer = (INT32U*)gFS_format_speedup_buffer;
#endif
	if(p_format_temp_buffer)
	{
		gp_memset((INT8S*)p_format_temp_buffer, 0, C_FS_FORMAT_BUFFER_SIZE>>WORD_PACK_VALUE);
		for (i = FATStartSector; i < (FATEndSector + nsector); i += C_FS_FORMAT_BUFFER_SECTOR_SIZE)
		{
			if( 0 != FileSysDrv[dsk]->Drv_WriteSector(i, C_FS_FORMAT_BUFFER_SECTOR_SIZE, (INT32U)p_format_temp_buffer) )
			{
			#if FS_FORMAT_SPEEDUP_BUFFER_SOURCE == ALLOCATE_BUFFER
				gp_free(p_format_temp_buffer);
			#endif
				return FALSE;
			}
		}
		if(i > FATEndSector + nsector)
		{
			if( 0 != FileSysDrv[dsk]->Drv_WriteSector(i - C_FS_FORMAT_BUFFER_SECTOR_SIZE, C_FS_FORMAT_BUFFER_SECTOR_SIZE - (i - (FATEndSector + nsector)), (INT32U)p_format_temp_buffer) )
			{
			#if FS_FORMAT_SPEEDUP_BUFFER_SOURCE == ALLOCATE_BUFFER
				gp_free(p_format_temp_buffer);
			#endif
				return FALSE;
			}
		}
	}
	else
#endif
	{
		for (i = FATStartSector; i < (FATEndSector + nsector); i++)
		{
			if ( (i == FATStartSector) || (i == FATStartSector+nfsect) ) 
			{
				continue;
			}
			
			if ( 0 != dskxfer(dsk, i, (INT32U)bp, 1, DSKWRITE) )
			{
			#if (FS_FORMAT_SPEEDUP == 1) && (FS_FORMAT_SPEEDUP_BUFFER_SOURCE == ALLOCATE_BUFFER)
				gp_free(p_format_temp_buffer);
			#endif
				return FALSE;
			}
		}
	}
	
#ifdef	unSP
	bp[0] = 0xfff8; 
	bp[1] = 0xffff; 
	
	bp[2] = 0xffff; 
	bp[3] = 0x0fff; 
	
	bp[4] = 0xffff; 
	bp[5] = 0x0fff; 
#else
	memset(bp, 0xff, 12);
	bp[0] = 0xf8;
//	bp[1] = 0xff;
//	bp[2] = 0xff;
//	bp[3] = 0xff;

//	bp[4] = 0xff;
//	bp[5] = 0xff;
//	bp[6] = 0xff;
	bp[7] = 0x0f;

//	bp[8] = 0xff;
//	bp[9] = 0xff;
//	bp[10] = 0xff;
	bp[11] = 0x0f;
#endif
	
	if ( 0 != dskxfer(dsk, FATStartSector, (INT32U)bp, 1, DSKWRITE) )
	{
	#if (FS_FORMAT_SPEEDUP == 1) && (FS_FORMAT_SPEEDUP_BUFFER_SOURCE == ALLOCATE_BUFFER)
		gp_free(p_format_temp_buffer);
	#endif	
		return FALSE;			
	}
	if ( 0 != dskxfer(dsk, FATStartSector + nfsect, (INT32U)bp, 1, DSKWRITE) )
	{
	#if (FS_FORMAT_SPEEDUP == 1) && (FS_FORMAT_SPEEDUP_BUFFER_SOURCE == ALLOCATE_BUFFER)
		gp_free(p_format_temp_buffer);
	#endif
		return FALSE;			
	}
	
	fmemset(bp, 0, 512>>WORD_PACK_VALUE);
	
#ifdef unSP
	bp[0] =  0x58eb;
	bp[1] =  0x90+('M'<<8);
	bp[2] =  'S'+('W'<<8);
	bp[3] =  'I'+('N'<<8);
	bp[4] =  '4'+('.'<<8);
	bp[5] =  '1'+(0<<8);	
	bp[6] =  0x02+(nsector<<8); 		 //DBR_nbyte_Addr 	 + 	 DBR_nsector_Addr
#else
	bp[0] = 0xeb, bp[1] = 0x58, bp[2] = 0x90;	// 0xEB 58 90
	strcpy((CHAR *) bp+3, "MSWIN4.1");				// MSWIN4.1
	bp[12] = 0x02;								// 2 FAT table area
	bp[13] = nsector;	
#endif
	
	putword(&bp[DBR_nreserved_Addr>>WORD_PACK_VALUE], reser_sector1);
	
#ifdef	unSP
	bp[8] = 0x0002; 	 //DBR_nfat_Addr 	 = 0x02, DBR_ndirent_Addr= 0x0000
//	bp[9] = 0x0000; 	 //DBR_ndirent_Addr= 0x0000, DBR_nsize_Addr = 0x0000
	bp[10] = 0xf800; 	 //DBR_nsize_Addr= 0x0000, DBR_mdesc_Addr = 0xf8
#else
	putword(&bp[16], 0x02);
	putword(&bp[18], 0x00);
	putword(&bp[21], 0xf8);
#endif
	
	putword(&bp[DBR_nfsect_Addr>>WORD_PACK_VALUE], 0x0000);
	putlong(&bp[DBR_hidden_Addr>>WORD_PACK_VALUE], sector_offset);
	
	putlong(&bp[DBR_huge_Addr>>WORD_PACK_VALUE], sector_number);
	
	putlong(&bp[DBR_xnfsect_Addr>>WORD_PACK_VALUE], nfsect);
	
	putword(&bp[DBR_xflags_Addr>>WORD_PACK_VALUE], 0x0000);
	putword(&bp[DBR_xfsversion_Addr>>WORD_PACK_VALUE], 0x0000);
	
	putlong(&bp[DBR_xrootclst_Addr>>WORD_PACK_VALUE], 0x00000002);
	
	putword(&bp[DBR_xfsinfosec_Addr>>WORD_PACK_VALUE], 0x0001);
	putword(&bp[DBR_xbackupsec_Addr>>WORD_PACK_VALUE], BPB_BkBootSec);

	bp[64>>WORD_PACK_VALUE] = 0x80;       //BS_DrvNum     0x00 for floopy disks, 0x80 for hard disks
#ifdef	unSP
	bp[33] =  0x29 + (0x14<<8);
	bp[34] =  0x10+(0x04<<8);
	bp[35] =  0x20+('N'<<8);
	bp[36] =  'O'+(' '<<8);
	bp[37] =  'N'+('A'<<8);
	bp[38] =  'M'+('E'<<8);
	bp[39] =  ' '+(' '<<8);
	bp[40] =  ' '+(' '<<8);
	
	bp[41] =  'F'+('A'<<8);
	bp[42] =  'T'+('3'<<8);
	bp[43] =  '2';
#else
	bp[66] = 0x29;
	putlong(&bp[DBR_FAT32_VOL_ID], 0x20041014);
	memcpy(&bp[DBR_FAT32_VOL_LAB], "NO NAME    ", 11);	
	memcpy(&bp[DBR_FAT32_FilSysType], "FAT32", 5);

	bp[0x40] = 0x00;   // Dominant add
	bp[0x41] = 0x00;   // Dominant add  , very important for FAT32
#endif
	
	putword(&bp[DBR_end_Addr>>WORD_PACK_VALUE], 0xaa55);
	
	format_printf1("sector_offset=%ld\r\n", sector_offset);
	if ( 0 != dskxfer(dsk, sector_offset, (INT32U)bp, 1, DSKWRITE) )
	{
	#if (FS_FORMAT_SPEEDUP == 1) && (FS_FORMAT_SPEEDUP_BUFFER_SOURCE == ALLOCATE_BUFFER)
		gp_free(p_format_temp_buffer);
	#endif
		return FALSE;			
	}
	if ( 0 != dskxfer(dsk, sector_offset + BPB_BkBootSec, (INT32U)bp, 1, DSKWRITE) )
	{
	#if (FS_FORMAT_SPEEDUP == 1) && (FS_FORMAT_SPEEDUP_BUFFER_SOURCE == ALLOCATE_BUFFER)
		gp_free(p_format_temp_buffer);
	#endif
		return FALSE;			
	}
#if (FS_FORMAT_SPEEDUP == 1) && (FS_FORMAT_SPEEDUP_BUFFER_SOURCE == ALLOCATE_BUFFER)
	gp_free(p_format_temp_buffer);
#endif
	return TRUE; 
}

#if WITHEXFAT == 1
INT8U G_EXFAT_UPCASE_TABLE[FORMAT_UPCASE_LENGTH] ={/* set array to data seg to avoid stackoverflow */
                0x00, 0x00, 0x01, 0x00, 0x02, 0x00, 0x03, 0x00,
                0x04, 0x00, 0x05, 0x00, 0x06, 0x00, 0x07, 0x00,
                0x08, 0x00, 0x09, 0x00, 0x0A, 0x00, 0x0B, 0x00,
                0x0C, 0x00, 0x0D, 0x00, 0x0E, 0x00, 0x0F, 0x00,
                0x10, 0x00, 0x11, 0x00, 0x12, 0x00, 0x13, 0x00,
                0x14, 0x00, 0x15, 0x00, 0x16, 0x00, 0x17, 0x00,
                0x18, 0x00, 0x19, 0x00, 0x1A, 0x00, 0x1B, 0x00,
                0x1C, 0x00, 0x1D, 0x00, 0x1E, 0x00, 0x1F, 0x00,
                0x20, 0x00, 0x21, 0x00, 0x22, 0x00, 0x23, 0x00,
                0x24, 0x00, 0x25, 0x00, 0x26, 0x00, 0x27, 0x00,
                0x28, 0x00, 0x29, 0x00, 0x2A, 0x00, 0x2B, 0x00,
                0x2C, 0x00, 0x2D, 0x00, 0x2E, 0x00, 0x2F, 0x00,
                0x30, 0x00, 0x31, 0x00, 0x32, 0x00, 0x33, 0x00,
                0x34, 0x00, 0x35, 0x00, 0x36, 0x00, 0x37, 0x00,
                0x38, 0x00, 0x39, 0x00, 0x3A, 0x00, 0x3B, 0x00,
                0x3C, 0x00, 0x3D, 0x00, 0x3E, 0x00, 0x3F, 0x00,
                0x40, 0x00, 0x41, 0x00, 0x42, 0x00, 0x43, 0x00,
                0x44, 0x00, 0x45, 0x00, 0x46, 0x00, 0x47, 0x00,
                0x48, 0x00, 0x49, 0x00, 0x4A, 0x00, 0x4B, 0x00,
                0x4C, 0x00, 0x4D, 0x00, 0x4E, 0x00, 0x4F, 0x00,
                0x50, 0x00, 0x51, 0x00, 0x52, 0x00, 0x53, 0x00,
                0x54, 0x00, 0x55, 0x00, 0x56, 0x00, 0x57, 0x00,
                0x58, 0x00, 0x59, 0x00, 0x5A, 0x00, 0x5B, 0x00,
                0x5C, 0x00, 0x5D, 0x00, 0x5E, 0x00, 0x5F, 0x00,
                0x60, 0x00, 0x41, 0x00, 0x42, 0x00, 0x43, 0x00,
                0x44, 0x00, 0x45, 0x00, 0x46, 0x00, 0x47, 0x00,
                0x48, 0x00, 0x49, 0x00, 0x4A, 0x00, 0x4B, 0x00,
                0x4C, 0x00, 0x4D, 0x00, 0x4E, 0x00, 0x4F, 0x00,
                0x50, 0x00, 0x51, 0x00, 0x52, 0x00, 0x53, 0x00,
                0x54, 0x00, 0x55, 0x00, 0x56, 0x00, 0x57, 0x00,
                0x58, 0x00, 0x59, 0x00, 0x5A, 0x00, 0x7B, 0x00,
                0x7C, 0x00, 0x7D, 0x00, 0x7E, 0x00, 0x7F, 0x00,
                0x80, 0x00, 0x81, 0x00, 0x82, 0x00, 0x83, 0x00,
                0x84, 0x00, 0x85, 0x00, 0x86, 0x00, 0x87, 0x00,
                0x88, 0x00, 0x89, 0x00, 0x8A, 0x00, 0x8B, 0x00,
                0x8C, 0x00, 0x8D, 0x00, 0x8E, 0x00, 0x8F, 0x00,
                0x90, 0x00, 0x91, 0x00, 0x92, 0x00, 0x93, 0x00,
                0x94, 0x00, 0x95, 0x00, 0x96, 0x00, 0x97, 0x00,
                0x98, 0x00, 0x99, 0x00, 0x9A, 0x00, 0x9B, 0x00,
                0x9C, 0x00, 0x9D, 0x00, 0x9E, 0x00, 0x9F, 0x00,
                0xA0, 0x00, 0xA1, 0x00, 0xA2, 0x00, 0xA3, 0x00,
                0xA4, 0x00, 0xA5, 0x00, 0xA6, 0x00, 0xA7, 0x00,
                0xA8, 0x00, 0xA9, 0x00, 0xAA, 0x00, 0xAB, 0x00,
                0xAC, 0x00, 0xAD, 0x00, 0xAE, 0x00, 0xAF, 0x00,
                0xB0, 0x00, 0xB1, 0x00, 0xB2, 0x00, 0xB3, 0x00,
                0xB4, 0x00, 0xB5, 0x00, 0xB6, 0x00, 0xB7, 0x00,
                0xB8, 0x00, 0xB9, 0x00, 0xBA, 0x00, 0xBB, 0x00,
                0xBC, 0x00, 0xBD, 0x00, 0xBE, 0x00, 0xBF, 0x00,
                0xC0, 0x00, 0xC1, 0x00, 0xC2, 0x00, 0xC3, 0x00,
                0xC4, 0x00, 0xC5, 0x00, 0xC6, 0x00, 0xC7, 0x00,
                0xC8, 0x00, 0xC9, 0x00, 0xCA, 0x00, 0xCB, 0x00,
                0xCC, 0x00, 0xCD, 0x00, 0xCE, 0x00, 0xCF, 0x00,
                0xD0, 0x00, 0xD1, 0x00, 0xD2, 0x00, 0xD3, 0x00,
                0xD4, 0x00, 0xD5, 0x00, 0xD6, 0x00, 0xD7, 0x00,
                0xD8, 0x00, 0xD9, 0x00, 0xDA, 0x00, 0xDB, 0x00,
                0xDC, 0x00, 0xDD, 0x00, 0xDE, 0x00, 0xDF, 0x00,
                0xC0, 0x00, 0xC1, 0x00, 0xC2, 0x00, 0xC3, 0x00,
                0xC4, 0x00, 0xC5, 0x00, 0xC6, 0x00, 0xC7, 0x00,
                0xC8, 0x00, 0xC9, 0x00, 0xCA, 0x00, 0xCB, 0x00,
                0xCC, 0x00, 0xCD, 0x00, 0xCE, 0x00, 0xCF, 0x00,
                0xD0, 0x00, 0xD1, 0x00, 0xD2, 0x00, 0xD3, 0x00,
                0xD4, 0x00, 0xD5, 0x00, 0xD6, 0x00, 0xF7, 0x00,
                0xD8, 0x00, 0xD9, 0x00, 0xDA, 0x00, 0xDB, 0x00,
                0xDC, 0x00, 0xDD, 0x00, 0xDE, 0x00, 0x78, 0x01,
                0x00, 0x01, 0x00, 0x01, 0x02, 0x01, 0x02, 0x01,
                0x04, 0x01, 0x04, 0x01, 0x06, 0x01, 0x06, 0x01,
                0x08, 0x01, 0x08, 0x01, 0x0A, 0x01, 0x0A, 0x01,
                0x0C, 0x01, 0x0C, 0x01, 0x0E, 0x01, 0x0E, 0x01,
                0x10, 0x01, 0x10, 0x01, 0x12, 0x01, 0x12, 0x01,
                0x14, 0x01, 0x14, 0x01, 0x16, 0x01, 0x16, 0x01,
                0x18, 0x01, 0x18, 0x01, 0x1A, 0x01, 0x1A, 0x01,
                0x1C, 0x01, 0x1C, 0x01, 0x1E, 0x01, 0x1E, 0x01,
                0x20, 0x01, 0x20, 0x01, 0x22, 0x01, 0x22, 0x01,
                0x24, 0x01, 0x24, 0x01, 0x26, 0x01, 0x26, 0x01,
                0x28, 0x01, 0x28, 0x01, 0x2A, 0x01, 0x2A, 0x01,
                0x2C, 0x01, 0x2C, 0x01, 0x2E, 0x01, 0x2E, 0x01,
                0x30, 0x01, 0x31, 0x01, 0x32, 0x01, 0x32, 0x01,
                0x34, 0x01, 0x34, 0x01, 0x36, 0x01, 0x36, 0x01,
                0x38, 0x01, 0x39, 0x01, 0x39, 0x01, 0x3B, 0x01,
                0x3B, 0x01, 0x3D, 0x01, 0x3D, 0x01, 0x3F, 0x01,
                0x3F, 0x01, 0x41, 0x01, 0x41, 0x01, 0x43, 0x01,
                0x43, 0x01, 0x45, 0x01, 0x45, 0x01, 0x47, 0x01,
                0x47, 0x01, 0x49, 0x01, 0x4A, 0x01, 0x4A, 0x01,
                0x4C, 0x01, 0x4C, 0x01, 0x4E, 0x01, 0x4E, 0x01,
                0x50, 0x01, 0x50, 0x01, 0x52, 0x01, 0x52, 0x01,
                0x54, 0x01, 0x54, 0x01, 0x56, 0x01, 0x56, 0x01,
                0x58, 0x01, 0x58, 0x01, 0x5A, 0x01, 0x5A, 0x01,
                0x5C, 0x01, 0x5C, 0x01, 0x5E, 0x01, 0x5E, 0x01,
                0x60, 0x01, 0x60, 0x01, 0x62, 0x01, 0x62, 0x01,
                0x64, 0x01, 0x64, 0x01, 0x66, 0x01, 0x66, 0x01,
                0x68, 0x01, 0x68, 0x01, 0x6A, 0x01, 0x6A, 0x01,
                0x6C, 0x01, 0x6C, 0x01, 0x6E, 0x01, 0x6E, 0x01,
                0x70, 0x01, 0x70, 0x01, 0x72, 0x01, 0x72, 0x01,
                0x74, 0x01, 0x74, 0x01, 0x76, 0x01, 0x76, 0x01,
                0x78, 0x01, 0x79, 0x01, 0x79, 0x01, 0x7B, 0x01,
                0x7B, 0x01, 0x7D, 0x01, 0x7D, 0x01, 0x7F, 0x01,
                0x43, 0x02, 0x81, 0x01, 0x82, 0x01, 0x82, 0x01,
                0x84, 0x01, 0x84, 0x01, 0x86, 0x01, 0x87, 0x01,
                0x87, 0x01, 0x89, 0x01, 0x8A, 0x01, 0x8B, 0x01,
                0x8B, 0x01, 0x8D, 0x01, 0x8E, 0x01, 0x8F, 0x01,
                0x90, 0x01, 0x91, 0x01, 0x91, 0x01, 0x93, 0x01,
                0x94, 0x01, 0xF6, 0x01, 0x96, 0x01, 0x97, 0x01,
                0x98, 0x01, 0x98, 0x01, 0x3D, 0x02, 0x9B, 0x01,
                0x9C, 0x01, 0x9D, 0x01, 0x20, 0x02, 0x9F, 0x01,
                0xA0, 0x01, 0xA0, 0x01, 0xA2, 0x01, 0xA2, 0x01,
                0xA4, 0x01, 0xA4, 0x01, 0xA6, 0x01, 0xA7, 0x01,
                0xA7, 0x01, 0xA9, 0x01, 0xAA, 0x01, 0xAB, 0x01,
                0xAC, 0x01, 0xAC, 0x01, 0xAE, 0x01, 0xAF, 0x01,
                0xAF, 0x01, 0xB1, 0x01, 0xB2, 0x01, 0xB3, 0x01,
                0xB3, 0x01, 0xB5, 0x01, 0xB5, 0x01, 0xB7, 0x01,
                0xB8, 0x01, 0xB8, 0x01, 0xBA, 0x01, 0xBB, 0x01,
                0xBC, 0x01, 0xBC, 0x01, 0xBE, 0x01, 0xF7, 0x01,
                0xC0, 0x01, 0xC1, 0x01, 0xC2, 0x01, 0xC3, 0x01,
                0xC4, 0x01, 0xC5, 0x01, 0xC4, 0x01, 0xC7, 0x01,
                0xC8, 0x01, 0xC7, 0x01, 0xCA, 0x01, 0xCB, 0x01,
                0xCA, 0x01, 0xCD, 0x01, 0xCD, 0x01, 0xCF, 0x01,
                0xCF, 0x01, 0xD1, 0x01, 0xD1, 0x01, 0xD3, 0x01,
                0xD3, 0x01, 0xD5, 0x01, 0xD5, 0x01, 0xD7, 0x01,
                0xD7, 0x01, 0xD9, 0x01, 0xD9, 0x01, 0xDB, 0x01,
                0xDB, 0x01, 0x8E, 0x01, 0xDE, 0x01, 0xDE, 0x01,
                0xE0, 0x01, 0xE0, 0x01, 0xE2, 0x01, 0xE2, 0x01,
                0xE4, 0x01, 0xE4, 0x01, 0xE6, 0x01, 0xE6, 0x01,
                0xE8, 0x01, 0xE8, 0x01, 0xEA, 0x01, 0xEA, 0x01,
                0xEC, 0x01, 0xEC, 0x01, 0xEE, 0x01, 0xEE, 0x01,
                0xF0, 0x01, 0xF1, 0x01, 0xF2, 0x01, 0xF1, 0x01,
                0xF4, 0x01, 0xF4, 0x01, 0xF6, 0x01, 0xF7, 0x01,
                0xF8, 0x01, 0xF8, 0x01, 0xFA, 0x01, 0xFA, 0x01,
                0xFC, 0x01, 0xFC, 0x01, 0xFE, 0x01, 0xFE, 0x01,
                0x00, 0x02, 0x00, 0x02, 0x02, 0x02, 0x02, 0x02,
                0x04, 0x02, 0x04, 0x02, 0x06, 0x02, 0x06, 0x02,
                0x08, 0x02, 0x08, 0x02, 0x0A, 0x02, 0x0A, 0x02,
                0x0C, 0x02, 0x0C, 0x02, 0x0E, 0x02, 0x0E, 0x02,
                0x10, 0x02, 0x10, 0x02, 0x12, 0x02, 0x12, 0x02,
                0x14, 0x02, 0x14, 0x02, 0x16, 0x02, 0x16, 0x02,
                0x18, 0x02, 0x18, 0x02, 0x1A, 0x02, 0x1A, 0x02,
                0x1C, 0x02, 0x1C, 0x02, 0x1E, 0x02, 0x1E, 0x02,
                0x20, 0x02, 0x21, 0x02, 0x22, 0x02, 0x22, 0x02,
                0x24, 0x02, 0x24, 0x02, 0x26, 0x02, 0x26, 0x02,
                0x28, 0x02, 0x28, 0x02, 0x2A, 0x02, 0x2A, 0x02,
                0x2C, 0x02, 0x2C, 0x02, 0x2E, 0x02, 0x2E, 0x02,
                0x30, 0x02, 0x30, 0x02, 0x32, 0x02, 0x32, 0x02,
                0x34, 0x02, 0x35, 0x02, 0x36, 0x02, 0x37, 0x02,
                0x38, 0x02, 0x39, 0x02, 0x65, 0x2C, 0x3B, 0x02,
                0x3B, 0x02, 0x3D, 0x02, 0x66, 0x2C, 0x3F, 0x02,
                0x40, 0x02, 0x41, 0x02, 0x41, 0x02, 0x43, 0x02,
                0x44, 0x02, 0x45, 0x02, 0x46, 0x02, 0x46, 0x02,
                0x48, 0x02, 0x48, 0x02, 0x4A, 0x02, 0x4A, 0x02,
                0x4C, 0x02, 0x4C, 0x02, 0x4E, 0x02, 0x4E, 0x02,
                0x50, 0x02, 0x51, 0x02, 0x52, 0x02, 0x81, 0x01,
                0x86, 0x01, 0x55, 0x02, 0x89, 0x01, 0x8A, 0x01,
                0x58, 0x02, 0x8F, 0x01, 0x5A, 0x02, 0x90, 0x01,
                0x5C, 0x02, 0x5D, 0x02, 0x5E, 0x02, 0x5F, 0x02,
                0x93, 0x01, 0x61, 0x02, 0x62, 0x02, 0x94, 0x01,
                0x64, 0x02, 0x65, 0x02, 0x66, 0x02, 0x67, 0x02,
                0x97, 0x01, 0x96, 0x01, 0x6A, 0x02, 0x62, 0x2C,
                0x6C, 0x02, 0x6D, 0x02, 0x6E, 0x02, 0x9C, 0x01,
                0x70, 0x02, 0x71, 0x02, 0x9D, 0x01, 0x73, 0x02,
                0x74, 0x02, 0x9F, 0x01, 0x76, 0x02, 0x77, 0x02,
                0x78, 0x02, 0x79, 0x02, 0x7A, 0x02, 0x7B, 0x02,
                0x7C, 0x02, 0x64, 0x2C, 0x7E, 0x02, 0x7F, 0x02,
                0xA6, 0x01, 0x81, 0x02, 0x82, 0x02, 0xA9, 0x01,
                0x84, 0x02, 0x85, 0x02, 0x86, 0x02, 0x87, 0x02,
                0xAE, 0x01, 0x44, 0x02, 0xB1, 0x01, 0xB2, 0x01,
                0x45, 0x02, 0x8D, 0x02, 0x8E, 0x02, 0x8F, 0x02,
                0x90, 0x02, 0x91, 0x02, 0xB7, 0x01, 0x93, 0x02,
                0x94, 0x02, 0x95, 0x02, 0x96, 0x02, 0x97, 0x02,
                0x98, 0x02, 0x99, 0x02, 0x9A, 0x02, 0x9B, 0x02,
                0x9C, 0x02, 0x9D, 0x02, 0x9E, 0x02, 0x9F, 0x02,
                0xA0, 0x02, 0xA1, 0x02, 0xA2, 0x02, 0xA3, 0x02,
                0xA4, 0x02, 0xA5, 0x02, 0xA6, 0x02, 0xA7, 0x02,
                0xA8, 0x02, 0xA9, 0x02, 0xAA, 0x02, 0xAB, 0x02,
                0xAC, 0x02, 0xAD, 0x02, 0xAE, 0x02, 0xAF, 0x02,
                0xB0, 0x02, 0xB1, 0x02, 0xB2, 0x02, 0xB3, 0x02,
                0xB4, 0x02, 0xB5, 0x02, 0xB6, 0x02, 0xB7, 0x02,
                0xB8, 0x02, 0xB9, 0x02, 0xBA, 0x02, 0xBB, 0x02,
                0xBC, 0x02, 0xBD, 0x02, 0xBE, 0x02, 0xBF, 0x02,
                0xC0, 0x02, 0xC1, 0x02, 0xC2, 0x02, 0xC3, 0x02,
                0xC4, 0x02, 0xC5, 0x02, 0xC6, 0x02, 0xC7, 0x02,
                0xC8, 0x02, 0xC9, 0x02, 0xCA, 0x02, 0xCB, 0x02,
                0xCC, 0x02, 0xCD, 0x02, 0xCE, 0x02, 0xCF, 0x02,
                0xD0, 0x02, 0xD1, 0x02, 0xD2, 0x02, 0xD3, 0x02,
                0xD4, 0x02, 0xD5, 0x02, 0xD6, 0x02, 0xD7, 0x02,
                0xD8, 0x02, 0xD9, 0x02, 0xDA, 0x02, 0xDB, 0x02,
                0xDC, 0x02, 0xDD, 0x02, 0xDE, 0x02, 0xDF, 0x02,
                0xE0, 0x02, 0xE1, 0x02, 0xE2, 0x02, 0xE3, 0x02,
                0xE4, 0x02, 0xE5, 0x02, 0xE6, 0x02, 0xE7, 0x02,
                0xE8, 0x02, 0xE9, 0x02, 0xEA, 0x02, 0xEB, 0x02,
                0xEC, 0x02, 0xED, 0x02, 0xEE, 0x02, 0xEF, 0x02,
                0xF0, 0x02, 0xF1, 0x02, 0xF2, 0x02, 0xF3, 0x02,
                0xF4, 0x02, 0xF5, 0x02, 0xF6, 0x02, 0xF7, 0x02,
                0xF8, 0x02, 0xF9, 0x02, 0xFA, 0x02, 0xFB, 0x02,
                0xFC, 0x02, 0xFD, 0x02, 0xFE, 0x02, 0xFF, 0x02,
                0x00, 0x03, 0x01, 0x03, 0x02, 0x03, 0x03, 0x03,
                0x04, 0x03, 0x05, 0x03, 0x06, 0x03, 0x07, 0x03,
                0x08, 0x03, 0x09, 0x03, 0x0A, 0x03, 0x0B, 0x03,
                0x0C, 0x03, 0x0D, 0x03, 0x0E, 0x03, 0x0F, 0x03,
                0x10, 0x03, 0x11, 0x03, 0x12, 0x03, 0x13, 0x03,
                0x14, 0x03, 0x15, 0x03, 0x16, 0x03, 0x17, 0x03,
                0x18, 0x03, 0x19, 0x03, 0x1A, 0x03, 0x1B, 0x03,
                0x1C, 0x03, 0x1D, 0x03, 0x1E, 0x03, 0x1F, 0x03,
                0x20, 0x03, 0x21, 0x03, 0x22, 0x03, 0x23, 0x03,
                0x24, 0x03, 0x25, 0x03, 0x26, 0x03, 0x27, 0x03,
                0x28, 0x03, 0x29, 0x03, 0x2A, 0x03, 0x2B, 0x03,
                0x2C, 0x03, 0x2D, 0x03, 0x2E, 0x03, 0x2F, 0x03,
                0x30, 0x03, 0x31, 0x03, 0x32, 0x03, 0x33, 0x03,
                0x34, 0x03, 0x35, 0x03, 0x36, 0x03, 0x37, 0x03,
                0x38, 0x03, 0x39, 0x03, 0x3A, 0x03, 0x3B, 0x03,
                0x3C, 0x03, 0x3D, 0x03, 0x3E, 0x03, 0x3F, 0x03,
                0x40, 0x03, 0x41, 0x03, 0x42, 0x03, 0x43, 0x03,
                0x44, 0x03, 0x45, 0x03, 0x46, 0x03, 0x47, 0x03,
                0x48, 0x03, 0x49, 0x03, 0x4A, 0x03, 0x4B, 0x03,
                0x4C, 0x03, 0x4D, 0x03, 0x4E, 0x03, 0x4F, 0x03,
                0x50, 0x03, 0x51, 0x03, 0x52, 0x03, 0x53, 0x03,
                0x54, 0x03, 0x55, 0x03, 0x56, 0x03, 0x57, 0x03,
                0x58, 0x03, 0x59, 0x03, 0x5A, 0x03, 0x5B, 0x03,
                0x5C, 0x03, 0x5D, 0x03, 0x5E, 0x03, 0x5F, 0x03,
                0x60, 0x03, 0x61, 0x03, 0x62, 0x03, 0x63, 0x03,
                0x64, 0x03, 0x65, 0x03, 0x66, 0x03, 0x67, 0x03,
                0x68, 0x03, 0x69, 0x03, 0x6A, 0x03, 0x6B, 0x03,
                0x6C, 0x03, 0x6D, 0x03, 0x6E, 0x03, 0x6F, 0x03,
                0x70, 0x03, 0x71, 0x03, 0x72, 0x03, 0x73, 0x03,
                0x74, 0x03, 0x75, 0x03, 0x76, 0x03, 0x77, 0x03,
                0x78, 0x03, 0x79, 0x03, 0x7A, 0x03, 0xFD, 0x03,
                0xFE, 0x03, 0xFF, 0x03, 0x7E, 0x03, 0x7F, 0x03,
                0x80, 0x03, 0x81, 0x03, 0x82, 0x03, 0x83, 0x03,
                0x84, 0x03, 0x85, 0x03, 0x86, 0x03, 0x87, 0x03,
                0x88, 0x03, 0x89, 0x03, 0x8A, 0x03, 0x8B, 0x03,
                0x8C, 0x03, 0x8D, 0x03, 0x8E, 0x03, 0x8F, 0x03,
                0x90, 0x03, 0x91, 0x03, 0x92, 0x03, 0x93, 0x03,
                0x94, 0x03, 0x95, 0x03, 0x96, 0x03, 0x97, 0x03,
                0x98, 0x03, 0x99, 0x03, 0x9A, 0x03, 0x9B, 0x03,
                0x9C, 0x03, 0x9D, 0x03, 0x9E, 0x03, 0x9F, 0x03,
                0xA0, 0x03, 0xA1, 0x03, 0xA2, 0x03, 0xA3, 0x03,
                0xA4, 0x03, 0xA5, 0x03, 0xA6, 0x03, 0xA7, 0x03,
                0xA8, 0x03, 0xA9, 0x03, 0xAA, 0x03, 0xAB, 0x03,
                0x86, 0x03, 0x88, 0x03, 0x89, 0x03, 0x8A, 0x03,
                0xB0, 0x03, 0x91, 0x03, 0x92, 0x03, 0x93, 0x03,
                0x94, 0x03, 0x95, 0x03, 0x96, 0x03, 0x97, 0x03,
                0x98, 0x03, 0x99, 0x03, 0x9A, 0x03, 0x9B, 0x03,
                0x9C, 0x03, 0x9D, 0x03, 0x9E, 0x03, 0x9F, 0x03,
                0xA0, 0x03, 0xA1, 0x03, 0xA3, 0x03, 0xA3, 0x03,
                0xA4, 0x03, 0xA5, 0x03, 0xA6, 0x03, 0xA7, 0x03,
                0xA8, 0x03, 0xA9, 0x03, 0xAA, 0x03, 0xAB, 0x03,
                0x8C, 0x03, 0x8E, 0x03, 0x8F, 0x03, 0xCF, 0x03,
                0xD0, 0x03, 0xD1, 0x03, 0xD2, 0x03, 0xD3, 0x03,
                0xD4, 0x03, 0xD5, 0x03, 0xD6, 0x03, 0xD7, 0x03,
                0xD8, 0x03, 0xD8, 0x03, 0xDA, 0x03, 0xDA, 0x03,
                0xDC, 0x03, 0xDC, 0x03, 0xDE, 0x03, 0xDE, 0x03,
                0xE0, 0x03, 0xE0, 0x03, 0xE2, 0x03, 0xE2, 0x03,
                0xE4, 0x03, 0xE4, 0x03, 0xE6, 0x03, 0xE6, 0x03,
                0xE8, 0x03, 0xE8, 0x03, 0xEA, 0x03, 0xEA, 0x03,
                0xEC, 0x03, 0xEC, 0x03, 0xEE, 0x03, 0xEE, 0x03,
                0xF0, 0x03, 0xF1, 0x03, 0xF9, 0x03, 0xF3, 0x03,
                0xF4, 0x03, 0xF5, 0x03, 0xF6, 0x03, 0xF7, 0x03,
                0xF7, 0x03, 0xF9, 0x03, 0xFA, 0x03, 0xFA, 0x03,
                0xFC, 0x03, 0xFD, 0x03, 0xFE, 0x03, 0xFF, 0x03,
                0x00, 0x04, 0x01, 0x04, 0x02, 0x04, 0x03, 0x04,
                0x04, 0x04, 0x05, 0x04, 0x06, 0x04, 0x07, 0x04,
                0x08, 0x04, 0x09, 0x04, 0x0A, 0x04, 0x0B, 0x04,
                0x0C, 0x04, 0x0D, 0x04, 0x0E, 0x04, 0x0F, 0x04,
                0x10, 0x04, 0x11, 0x04, 0x12, 0x04, 0x13, 0x04,
                0x14, 0x04, 0x15, 0x04, 0x16, 0x04, 0x17, 0x04,
                0x18, 0x04, 0x19, 0x04, 0x1A, 0x04, 0x1B, 0x04,
                0x1C, 0x04, 0x1D, 0x04, 0x1E, 0x04, 0x1F, 0x04,
                0x20, 0x04, 0x21, 0x04, 0x22, 0x04, 0x23, 0x04,
                0x24, 0x04, 0x25, 0x04, 0x26, 0x04, 0x27, 0x04,
                0x28, 0x04, 0x29, 0x04, 0x2A, 0x04, 0x2B, 0x04,
                0x2C, 0x04, 0x2D, 0x04, 0x2E, 0x04, 0x2F, 0x04,
                0x10, 0x04, 0x11, 0x04, 0x12, 0x04, 0x13, 0x04,
                0x14, 0x04, 0x15, 0x04, 0x16, 0x04, 0x17, 0x04,
                0x18, 0x04, 0x19, 0x04, 0x1A, 0x04, 0x1B, 0x04,
                0x1C, 0x04, 0x1D, 0x04, 0x1E, 0x04, 0x1F, 0x04,
                0x20, 0x04, 0x21, 0x04, 0x22, 0x04, 0x23, 0x04,
                0x24, 0x04, 0x25, 0x04, 0x26, 0x04, 0x27, 0x04,
                0x28, 0x04, 0x29, 0x04, 0x2A, 0x04, 0x2B, 0x04,
                0x2C, 0x04, 0x2D, 0x04, 0x2E, 0x04, 0x2F, 0x04,
                0x00, 0x04, 0x01, 0x04, 0x02, 0x04, 0x03, 0x04,
                0x04, 0x04, 0x05, 0x04, 0x06, 0x04, 0x07, 0x04,
                0x08, 0x04, 0x09, 0x04, 0x0A, 0x04, 0x0B, 0x04,
                0x0C, 0x04, 0x0D, 0x04, 0x0E, 0x04, 0x0F, 0x04,
                0x60, 0x04, 0x60, 0x04, 0x62, 0x04, 0x62, 0x04,
                0x64, 0x04, 0x64, 0x04, 0x66, 0x04, 0x66, 0x04,
                0x68, 0x04, 0x68, 0x04, 0x6A, 0x04, 0x6A, 0x04,
                0x6C, 0x04, 0x6C, 0x04, 0x6E, 0x04, 0x6E, 0x04,
                0x70, 0x04, 0x70, 0x04, 0x72, 0x04, 0x72, 0x04,
                0x74, 0x04, 0x74, 0x04, 0x76, 0x04, 0x76, 0x04,
                0x78, 0x04, 0x78, 0x04, 0x7A, 0x04, 0x7A, 0x04,
                0x7C, 0x04, 0x7C, 0x04, 0x7E, 0x04, 0x7E, 0x04,
                0x80, 0x04, 0x80, 0x04, 0x82, 0x04, 0x83, 0x04,
                0x84, 0x04, 0x85, 0x04, 0x86, 0x04, 0x87, 0x04,
                0x88, 0x04, 0x89, 0x04, 0x8A, 0x04, 0x8A, 0x04,
                0x8C, 0x04, 0x8C, 0x04, 0x8E, 0x04, 0x8E, 0x04,
                0x90, 0x04, 0x90, 0x04, 0x92, 0x04, 0x92, 0x04,
                0x94, 0x04, 0x94, 0x04, 0x96, 0x04, 0x96, 0x04,
                0x98, 0x04, 0x98, 0x04, 0x9A, 0x04, 0x9A, 0x04,
                0x9C, 0x04, 0x9C, 0x04, 0x9E, 0x04, 0x9E, 0x04,
                0xA0, 0x04, 0xA0, 0x04, 0xA2, 0x04, 0xA2, 0x04,
                0xA4, 0x04, 0xA4, 0x04, 0xA6, 0x04, 0xA6, 0x04,
                0xA8, 0x04, 0xA8, 0x04, 0xAA, 0x04, 0xAA, 0x04,
                0xAC, 0x04, 0xAC, 0x04, 0xAE, 0x04, 0xAE, 0x04,
                0xB0, 0x04, 0xB0, 0x04, 0xB2, 0x04, 0xB2, 0x04,
                0xB4, 0x04, 0xB4, 0x04, 0xB6, 0x04, 0xB6, 0x04,
                0xB8, 0x04, 0xB8, 0x04, 0xBA, 0x04, 0xBA, 0x04,
                0xBC, 0x04, 0xBC, 0x04, 0xBE, 0x04, 0xBE, 0x04,
                0xC0, 0x04, 0xC1, 0x04, 0xC1, 0x04, 0xC3, 0x04,
                0xC3, 0x04, 0xC5, 0x04, 0xC5, 0x04, 0xC7, 0x04,
                0xC7, 0x04, 0xC9, 0x04, 0xC9, 0x04, 0xCB, 0x04,
                0xCB, 0x04, 0xCD, 0x04, 0xCD, 0x04, 0xC0, 0x04,
                0xD0, 0x04, 0xD0, 0x04, 0xD2, 0x04, 0xD2, 0x04,
                0xD4, 0x04, 0xD4, 0x04, 0xD6, 0x04, 0xD6, 0x04,
                0xD8, 0x04, 0xD8, 0x04, 0xDA, 0x04, 0xDA, 0x04,
                0xDC, 0x04, 0xDC, 0x04, 0xDE, 0x04, 0xDE, 0x04,
                0xE0, 0x04, 0xE0, 0x04, 0xE2, 0x04, 0xE2, 0x04,
                0xE4, 0x04, 0xE4, 0x04, 0xE6, 0x04, 0xE6, 0x04,
                0xE8, 0x04, 0xE8, 0x04, 0xEA, 0x04, 0xEA, 0x04,
                0xEC, 0x04, 0xEC, 0x04, 0xEE, 0x04, 0xEE, 0x04,
                0xF0, 0x04, 0xF0, 0x04, 0xF2, 0x04, 0xF2, 0x04,
                0xF4, 0x04, 0xF4, 0x04, 0xF6, 0x04, 0xF6, 0x04,
                0xF8, 0x04, 0xF8, 0x04, 0xFA, 0x04, 0xFA, 0x04,
                0xFC, 0x04, 0xFC, 0x04, 0xFE, 0x04, 0xFE, 0x04,
                0x00, 0x05, 0x00, 0x05, 0x02, 0x05, 0x02, 0x05,
                0x04, 0x05, 0x04, 0x05, 0x06, 0x05, 0x06, 0x05,
                0x08, 0x05, 0x08, 0x05, 0x0A, 0x05, 0x0A, 0x05,
                0x0C, 0x05, 0x0C, 0x05, 0x0E, 0x05, 0x0E, 0x05,
                0x10, 0x05, 0x10, 0x05, 0x12, 0x05, 0x12, 0x05,
                0x14, 0x05, 0x15, 0x05, 0x16, 0x05, 0x17, 0x05,
                0x18, 0x05, 0x19, 0x05, 0x1A, 0x05, 0x1B, 0x05,
                0x1C, 0x05, 0x1D, 0x05, 0x1E, 0x05, 0x1F, 0x05,
                0x20, 0x05, 0x21, 0x05, 0x22, 0x05, 0x23, 0x05,
                0x24, 0x05, 0x25, 0x05, 0x26, 0x05, 0x27, 0x05,
                0x28, 0x05, 0x29, 0x05, 0x2A, 0x05, 0x2B, 0x05,
                0x2C, 0x05, 0x2D, 0x05, 0x2E, 0x05, 0x2F, 0x05,
                0x30, 0x05, 0x31, 0x05, 0x32, 0x05, 0x33, 0x05,
                0x34, 0x05, 0x35, 0x05, 0x36, 0x05, 0x37, 0x05,
                0x38, 0x05, 0x39, 0x05, 0x3A, 0x05, 0x3B, 0x05,
                0x3C, 0x05, 0x3D, 0x05, 0x3E, 0x05, 0x3F, 0x05,
                0x40, 0x05, 0x41, 0x05, 0x42, 0x05, 0x43, 0x05,
                0x44, 0x05, 0x45, 0x05, 0x46, 0x05, 0x47, 0x05,
                0x48, 0x05, 0x49, 0x05, 0x4A, 0x05, 0x4B, 0x05,
                0x4C, 0x05, 0x4D, 0x05, 0x4E, 0x05, 0x4F, 0x05,
                0x50, 0x05, 0x51, 0x05, 0x52, 0x05, 0x53, 0x05,
                0x54, 0x05, 0x55, 0x05, 0x56, 0x05, 0x57, 0x05,
                0x58, 0x05, 0x59, 0x05, 0x5A, 0x05, 0x5B, 0x05,
                0x5C, 0x05, 0x5D, 0x05, 0x5E, 0x05, 0x5F, 0x05,
                0x60, 0x05, 0x31, 0x05, 0x32, 0x05, 0x33, 0x05,
                0x34, 0x05, 0x35, 0x05, 0x36, 0x05, 0x37, 0x05,
                0x38, 0x05, 0x39, 0x05, 0x3A, 0x05, 0x3B, 0x05,
                0x3C, 0x05, 0x3D, 0x05, 0x3E, 0x05, 0x3F, 0x05,
                0x40, 0x05, 0x41, 0x05, 0x42, 0x05, 0x43, 0x05,
                0x44, 0x05, 0x45, 0x05, 0x46, 0x05, 0x47, 0x05,
                0x48, 0x05, 0x49, 0x05, 0x4A, 0x05, 0x4B, 0x05,
                0x4C, 0x05, 0x4D, 0x05, 0x4E, 0x05, 0x4F, 0x05,
                0x50, 0x05, 0x51, 0x05, 0x52, 0x05, 0x53, 0x05,
                0x54, 0x05, 0x55, 0x05, 0x56, 0x05, 0xFF, 0xFF,
                0xF6, 0x17, 0x63, 0x2C, 0x7E, 0x1D, 0x7F, 0x1D,
                0x80, 0x1D, 0x81, 0x1D, 0x82, 0x1D, 0x83, 0x1D,
                0x84, 0x1D, 0x85, 0x1D, 0x86, 0x1D, 0x87, 0x1D,
                0x88, 0x1D, 0x89, 0x1D, 0x8A, 0x1D, 0x8B, 0x1D,
                0x8C, 0x1D, 0x8D, 0x1D, 0x8E, 0x1D, 0x8F, 0x1D,
                0x90, 0x1D, 0x91, 0x1D, 0x92, 0x1D, 0x93, 0x1D,
                0x94, 0x1D, 0x95, 0x1D, 0x96, 0x1D, 0x97, 0x1D,
                0x98, 0x1D, 0x99, 0x1D, 0x9A, 0x1D, 0x9B, 0x1D,
                0x9C, 0x1D, 0x9D, 0x1D, 0x9E, 0x1D, 0x9F, 0x1D,
                0xA0, 0x1D, 0xA1, 0x1D, 0xA2, 0x1D, 0xA3, 0x1D,
                0xA4, 0x1D, 0xA5, 0x1D, 0xA6, 0x1D, 0xA7, 0x1D,
                0xA8, 0x1D, 0xA9, 0x1D, 0xAA, 0x1D, 0xAB, 0x1D,
                0xAC, 0x1D, 0xAD, 0x1D, 0xAE, 0x1D, 0xAF, 0x1D,
                0xB0, 0x1D, 0xB1, 0x1D, 0xB2, 0x1D, 0xB3, 0x1D,
                0xB4, 0x1D, 0xB5, 0x1D, 0xB6, 0x1D, 0xB7, 0x1D,
                0xB8, 0x1D, 0xB9, 0x1D, 0xBA, 0x1D, 0xBB, 0x1D,
                0xBC, 0x1D, 0xBD, 0x1D, 0xBE, 0x1D, 0xBF, 0x1D,
                0xC0, 0x1D, 0xC1, 0x1D, 0xC2, 0x1D, 0xC3, 0x1D,
                0xC4, 0x1D, 0xC5, 0x1D, 0xC6, 0x1D, 0xC7, 0x1D,
                0xC8, 0x1D, 0xC9, 0x1D, 0xCA, 0x1D, 0xCB, 0x1D,
                0xCC, 0x1D, 0xCD, 0x1D, 0xCE, 0x1D, 0xCF, 0x1D,
                0xD0, 0x1D, 0xD1, 0x1D, 0xD2, 0x1D, 0xD3, 0x1D,
                0xD4, 0x1D, 0xD5, 0x1D, 0xD6, 0x1D, 0xD7, 0x1D,
                0xD8, 0x1D, 0xD9, 0x1D, 0xDA, 0x1D, 0xDB, 0x1D,
                0xDC, 0x1D, 0xDD, 0x1D, 0xDE, 0x1D, 0xDF, 0x1D,
                0xE0, 0x1D, 0xE1, 0x1D, 0xE2, 0x1D, 0xE3, 0x1D,
                0xE4, 0x1D, 0xE5, 0x1D, 0xE6, 0x1D, 0xE7, 0x1D,
                0xE8, 0x1D, 0xE9, 0x1D, 0xEA, 0x1D, 0xEB, 0x1D,
                0xEC, 0x1D, 0xED, 0x1D, 0xEE, 0x1D, 0xEF, 0x1D,
                0xF0, 0x1D, 0xF1, 0x1D, 0xF2, 0x1D, 0xF3, 0x1D,
                0xF4, 0x1D, 0xF5, 0x1D, 0xF6, 0x1D, 0xF7, 0x1D,
                0xF8, 0x1D, 0xF9, 0x1D, 0xFA, 0x1D, 0xFB, 0x1D,
                0xFC, 0x1D, 0xFD, 0x1D, 0xFE, 0x1D, 0xFF, 0x1D,
                0x00, 0x1E, 0x00, 0x1E, 0x02, 0x1E, 0x02, 0x1E,
                0x04, 0x1E, 0x04, 0x1E, 0x06, 0x1E, 0x06, 0x1E,
                0x08, 0x1E, 0x08, 0x1E, 0x0A, 0x1E, 0x0A, 0x1E,
                0x0C, 0x1E, 0x0C, 0x1E, 0x0E, 0x1E, 0x0E, 0x1E,
                0x10, 0x1E, 0x10, 0x1E, 0x12, 0x1E, 0x12, 0x1E,
                0x14, 0x1E, 0x14, 0x1E, 0x16, 0x1E, 0x16, 0x1E,
                0x18, 0x1E, 0x18, 0x1E, 0x1A, 0x1E, 0x1A, 0x1E,
                0x1C, 0x1E, 0x1C, 0x1E, 0x1E, 0x1E, 0x1E, 0x1E,
                0x20, 0x1E, 0x20, 0x1E, 0x22, 0x1E, 0x22, 0x1E,
                0x24, 0x1E, 0x24, 0x1E, 0x26, 0x1E, 0x26, 0x1E,
                0x28, 0x1E, 0x28, 0x1E, 0x2A, 0x1E, 0x2A, 0x1E,
                0x2C, 0x1E, 0x2C, 0x1E, 0x2E, 0x1E, 0x2E, 0x1E,
                0x30, 0x1E, 0x30, 0x1E, 0x32, 0x1E, 0x32, 0x1E,
                0x34, 0x1E, 0x34, 0x1E, 0x36, 0x1E, 0x36, 0x1E,
                0x38, 0x1E, 0x38, 0x1E, 0x3A, 0x1E, 0x3A, 0x1E,
                0x3C, 0x1E, 0x3C, 0x1E, 0x3E, 0x1E, 0x3E, 0x1E,
                0x40, 0x1E, 0x40, 0x1E, 0x42, 0x1E, 0x42, 0x1E,
                0x44, 0x1E, 0x44, 0x1E, 0x46, 0x1E, 0x46, 0x1E,
                0x48, 0x1E, 0x48, 0x1E, 0x4A, 0x1E, 0x4A, 0x1E,
                0x4C, 0x1E, 0x4C, 0x1E, 0x4E, 0x1E, 0x4E, 0x1E,
                0x50, 0x1E, 0x50, 0x1E, 0x52, 0x1E, 0x52, 0x1E,
                0x54, 0x1E, 0x54, 0x1E, 0x56, 0x1E, 0x56, 0x1E,
                0x58, 0x1E, 0x58, 0x1E, 0x5A, 0x1E, 0x5A, 0x1E,
                0x5C, 0x1E, 0x5C, 0x1E, 0x5E, 0x1E, 0x5E, 0x1E,
                0x60, 0x1E, 0x60, 0x1E, 0x62, 0x1E, 0x62, 0x1E,
                0x64, 0x1E, 0x64, 0x1E, 0x66, 0x1E, 0x66, 0x1E,
                0x68, 0x1E, 0x68, 0x1E, 0x6A, 0x1E, 0x6A, 0x1E,
                0x6C, 0x1E, 0x6C, 0x1E, 0x6E, 0x1E, 0x6E, 0x1E,
                0x70, 0x1E, 0x70, 0x1E, 0x72, 0x1E, 0x72, 0x1E,
                0x74, 0x1E, 0x74, 0x1E, 0x76, 0x1E, 0x76, 0x1E,
                0x78, 0x1E, 0x78, 0x1E, 0x7A, 0x1E, 0x7A, 0x1E,
                0x7C, 0x1E, 0x7C, 0x1E, 0x7E, 0x1E, 0x7E, 0x1E,
                0x80, 0x1E, 0x80, 0x1E, 0x82, 0x1E, 0x82, 0x1E,
                0x84, 0x1E, 0x84, 0x1E, 0x86, 0x1E, 0x86, 0x1E,
                0x88, 0x1E, 0x88, 0x1E, 0x8A, 0x1E, 0x8A, 0x1E,
                0x8C, 0x1E, 0x8C, 0x1E, 0x8E, 0x1E, 0x8E, 0x1E,
                0x90, 0x1E, 0x90, 0x1E, 0x92, 0x1E, 0x92, 0x1E,
                0x94, 0x1E, 0x94, 0x1E, 0x96, 0x1E, 0x97, 0x1E,
                0x98, 0x1E, 0x99, 0x1E, 0x9A, 0x1E, 0x9B, 0x1E,
                0x9C, 0x1E, 0x9D, 0x1E, 0x9E, 0x1E, 0x9F, 0x1E,
                0xA0, 0x1E, 0xA0, 0x1E, 0xA2, 0x1E, 0xA2, 0x1E,
                0xA4, 0x1E, 0xA4, 0x1E, 0xA6, 0x1E, 0xA6, 0x1E,
                0xA8, 0x1E, 0xA8, 0x1E, 0xAA, 0x1E, 0xAA, 0x1E,
                0xAC, 0x1E, 0xAC, 0x1E, 0xAE, 0x1E, 0xAE, 0x1E,
                0xB0, 0x1E, 0xB0, 0x1E, 0xB2, 0x1E, 0xB2, 0x1E,
                0xB4, 0x1E, 0xB4, 0x1E, 0xB6, 0x1E, 0xB6, 0x1E,
                0xB8, 0x1E, 0xB8, 0x1E, 0xBA, 0x1E, 0xBA, 0x1E,
                0xBC, 0x1E, 0xBC, 0x1E, 0xBE, 0x1E, 0xBE, 0x1E,
                0xC0, 0x1E, 0xC0, 0x1E, 0xC2, 0x1E, 0xC2, 0x1E,
                0xC4, 0x1E, 0xC4, 0x1E, 0xC6, 0x1E, 0xC6, 0x1E,
                0xC8, 0x1E, 0xC8, 0x1E, 0xCA, 0x1E, 0xCA, 0x1E,
                0xCC, 0x1E, 0xCC, 0x1E, 0xCE, 0x1E, 0xCE, 0x1E,
                0xD0, 0x1E, 0xD0, 0x1E, 0xD2, 0x1E, 0xD2, 0x1E,
                0xD4, 0x1E, 0xD4, 0x1E, 0xD6, 0x1E, 0xD6, 0x1E,
                0xD8, 0x1E, 0xD8, 0x1E, 0xDA, 0x1E, 0xDA, 0x1E,
                0xDC, 0x1E, 0xDC, 0x1E, 0xDE, 0x1E, 0xDE, 0x1E,
                0xE0, 0x1E, 0xE0, 0x1E, 0xE2, 0x1E, 0xE2, 0x1E,
                0xE4, 0x1E, 0xE4, 0x1E, 0xE6, 0x1E, 0xE6, 0x1E,
                0xE8, 0x1E, 0xE8, 0x1E, 0xEA, 0x1E, 0xEA, 0x1E,
                0xEC, 0x1E, 0xEC, 0x1E, 0xEE, 0x1E, 0xEE, 0x1E,
                0xF0, 0x1E, 0xF0, 0x1E, 0xF2, 0x1E, 0xF2, 0x1E,
                0xF4, 0x1E, 0xF4, 0x1E, 0xF6, 0x1E, 0xF6, 0x1E,
                0xF8, 0x1E, 0xF8, 0x1E, 0xFA, 0x1E, 0xFB, 0x1E,
                0xFC, 0x1E, 0xFD, 0x1E, 0xFE, 0x1E, 0xFF, 0x1E,
                0x08, 0x1F, 0x09, 0x1F, 0x0A, 0x1F, 0x0B, 0x1F,
                0x0C, 0x1F, 0x0D, 0x1F, 0x0E, 0x1F, 0x0F, 0x1F,
                0x08, 0x1F, 0x09, 0x1F, 0x0A, 0x1F, 0x0B, 0x1F,
                0x0C, 0x1F, 0x0D, 0x1F, 0x0E, 0x1F, 0x0F, 0x1F,
                0x18, 0x1F, 0x19, 0x1F, 0x1A, 0x1F, 0x1B, 0x1F,
                0x1C, 0x1F, 0x1D, 0x1F, 0x16, 0x1F, 0x17, 0x1F,
                0x18, 0x1F, 0x19, 0x1F, 0x1A, 0x1F, 0x1B, 0x1F,
                0x1C, 0x1F, 0x1D, 0x1F, 0x1E, 0x1F, 0x1F, 0x1F,
                0x28, 0x1F, 0x29, 0x1F, 0x2A, 0x1F, 0x2B, 0x1F,
                0x2C, 0x1F, 0x2D, 0x1F, 0x2E, 0x1F, 0x2F, 0x1F,
                0x28, 0x1F, 0x29, 0x1F, 0x2A, 0x1F, 0x2B, 0x1F,
                0x2C, 0x1F, 0x2D, 0x1F, 0x2E, 0x1F, 0x2F, 0x1F,
                0x38, 0x1F, 0x39, 0x1F, 0x3A, 0x1F, 0x3B, 0x1F,
                0x3C, 0x1F, 0x3D, 0x1F, 0x3E, 0x1F, 0x3F, 0x1F,
                0x38, 0x1F, 0x39, 0x1F, 0x3A, 0x1F, 0x3B, 0x1F,
                0x3C, 0x1F, 0x3D, 0x1F, 0x3E, 0x1F, 0x3F, 0x1F,
                0x48, 0x1F, 0x49, 0x1F, 0x4A, 0x1F, 0x4B, 0x1F,
                0x4C, 0x1F, 0x4D, 0x1F, 0x46, 0x1F, 0x47, 0x1F,
                0x48, 0x1F, 0x49, 0x1F, 0x4A, 0x1F, 0x4B, 0x1F,
                0x4C, 0x1F, 0x4D, 0x1F, 0x4E, 0x1F, 0x4F, 0x1F,
                0x50, 0x1F, 0x59, 0x1F, 0x52, 0x1F, 0x5B, 0x1F,
                0x54, 0x1F, 0x5D, 0x1F, 0x56, 0x1F, 0x5F, 0x1F,
                0x58, 0x1F, 0x59, 0x1F, 0x5A, 0x1F, 0x5B, 0x1F,
                0x5C, 0x1F, 0x5D, 0x1F, 0x5E, 0x1F, 0x5F, 0x1F,
                0x68, 0x1F, 0x69, 0x1F, 0x6A, 0x1F, 0x6B, 0x1F,
                0x6C, 0x1F, 0x6D, 0x1F, 0x6E, 0x1F, 0x6F, 0x1F,
                0x68, 0x1F, 0x69, 0x1F, 0x6A, 0x1F, 0x6B, 0x1F,
                0x6C, 0x1F, 0x6D, 0x1F, 0x6E, 0x1F, 0x6F, 0x1F,
                0xBA, 0x1F, 0xBB, 0x1F, 0xC8, 0x1F, 0xC9, 0x1F,
                0xCA, 0x1F, 0xCB, 0x1F, 0xDA, 0x1F, 0xDB, 0x1F,
                0xF8, 0x1F, 0xF9, 0x1F, 0xEA, 0x1F, 0xEB, 0x1F,
                0xFA, 0x1F, 0xFB, 0x1F, 0x7E, 0x1F, 0x7F, 0x1F,
                0x88, 0x1F, 0x89, 0x1F, 0x8A, 0x1F, 0x8B, 0x1F,
                0x8C, 0x1F, 0x8D, 0x1F, 0x8E, 0x1F, 0x8F, 0x1F,
                0x88, 0x1F, 0x89, 0x1F, 0x8A, 0x1F, 0x8B, 0x1F,
                0x8C, 0x1F, 0x8D, 0x1F, 0x8E, 0x1F, 0x8F, 0x1F,
                0x98, 0x1F, 0x99, 0x1F, 0x9A, 0x1F, 0x9B, 0x1F,
                0x9C, 0x1F, 0x9D, 0x1F, 0x9E, 0x1F, 0x9F, 0x1F,
                0x98, 0x1F, 0x99, 0x1F, 0x9A, 0x1F, 0x9B, 0x1F,
                0x9C, 0x1F, 0x9D, 0x1F, 0x9E, 0x1F, 0x9F, 0x1F,
                0xA8, 0x1F, 0xA9, 0x1F, 0xAA, 0x1F, 0xAB, 0x1F,
                0xAC, 0x1F, 0xAD, 0x1F, 0xAE, 0x1F, 0xAF, 0x1F,
                0xA8, 0x1F, 0xA9, 0x1F, 0xAA, 0x1F, 0xAB, 0x1F,
                0xAC, 0x1F, 0xAD, 0x1F, 0xAE, 0x1F, 0xAF, 0x1F,
                0xB8, 0x1F, 0xB9, 0x1F, 0xB2, 0x1F, 0xBC, 0x1F,
                0xB4, 0x1F, 0xB5, 0x1F, 0xB6, 0x1F, 0xB7, 0x1F,
                0xB8, 0x1F, 0xB9, 0x1F, 0xBA, 0x1F, 0xBB, 0x1F,
                0xBC, 0x1F, 0xBD, 0x1F, 0xBE, 0x1F, 0xBF, 0x1F,
                0xC0, 0x1F, 0xC1, 0x1F, 0xC2, 0x1F, 0xC3, 0x1F,
                0xC4, 0x1F, 0xC5, 0x1F, 0xC6, 0x1F, 0xC7, 0x1F,
                0xC8, 0x1F, 0xC9, 0x1F, 0xCA, 0x1F, 0xCB, 0x1F,
                0xC3, 0x1F, 0xCD, 0x1F, 0xCE, 0x1F, 0xCF, 0x1F,
                0xD8, 0x1F, 0xD9, 0x1F, 0xD2, 0x1F, 0xD3, 0x1F,
                0xD4, 0x1F, 0xD5, 0x1F, 0xD6, 0x1F, 0xD7, 0x1F,
                0xD8, 0x1F, 0xD9, 0x1F, 0xDA, 0x1F, 0xDB, 0x1F,
                0xDC, 0x1F, 0xDD, 0x1F, 0xDE, 0x1F, 0xDF, 0x1F,
                0xE8, 0x1F, 0xE9, 0x1F, 0xE2, 0x1F, 0xE3, 0x1F,
                0xE4, 0x1F, 0xEC, 0x1F, 0xE6, 0x1F, 0xE7, 0x1F,
                0xE8, 0x1F, 0xE9, 0x1F, 0xEA, 0x1F, 0xEB, 0x1F,
                0xEC, 0x1F, 0xED, 0x1F, 0xEE, 0x1F, 0xEF, 0x1F,
                0xF0, 0x1F, 0xF1, 0x1F, 0xF2, 0x1F, 0xF3, 0x1F,
                0xF4, 0x1F, 0xF5, 0x1F, 0xF6, 0x1F, 0xF7, 0x1F,
                0xF8, 0x1F, 0xF9, 0x1F, 0xFA, 0x1F, 0xFB, 0x1F,
                0xF3, 0x1F, 0xFD, 0x1F, 0xFE, 0x1F, 0xFF, 0x1F,
                0x00, 0x20, 0x01, 0x20, 0x02, 0x20, 0x03, 0x20,
                0x04, 0x20, 0x05, 0x20, 0x06, 0x20, 0x07, 0x20,
                0x08, 0x20, 0x09, 0x20, 0x0A, 0x20, 0x0B, 0x20,
                0x0C, 0x20, 0x0D, 0x20, 0x0E, 0x20, 0x0F, 0x20,
                0x10, 0x20, 0x11, 0x20, 0x12, 0x20, 0x13, 0x20,
                0x14, 0x20, 0x15, 0x20, 0x16, 0x20, 0x17, 0x20,
                0x18, 0x20, 0x19, 0x20, 0x1A, 0x20, 0x1B, 0x20,
                0x1C, 0x20, 0x1D, 0x20, 0x1E, 0x20, 0x1F, 0x20,
                0x20, 0x20, 0x21, 0x20, 0x22, 0x20, 0x23, 0x20,
                0x24, 0x20, 0x25, 0x20, 0x26, 0x20, 0x27, 0x20,
                0x28, 0x20, 0x29, 0x20, 0x2A, 0x20, 0x2B, 0x20,
                0x2C, 0x20, 0x2D, 0x20, 0x2E, 0x20, 0x2F, 0x20,
                0x30, 0x20, 0x31, 0x20, 0x32, 0x20, 0x33, 0x20,
                0x34, 0x20, 0x35, 0x20, 0x36, 0x20, 0x37, 0x20,
                0x38, 0x20, 0x39, 0x20, 0x3A, 0x20, 0x3B, 0x20,
                0x3C, 0x20, 0x3D, 0x20, 0x3E, 0x20, 0x3F, 0x20,
                0x40, 0x20, 0x41, 0x20, 0x42, 0x20, 0x43, 0x20,
                0x44, 0x20, 0x45, 0x20, 0x46, 0x20, 0x47, 0x20,
                0x48, 0x20, 0x49, 0x20, 0x4A, 0x20, 0x4B, 0x20,
                0x4C, 0x20, 0x4D, 0x20, 0x4E, 0x20, 0x4F, 0x20,
                0x50, 0x20, 0x51, 0x20, 0x52, 0x20, 0x53, 0x20,
                0x54, 0x20, 0x55, 0x20, 0x56, 0x20, 0x57, 0x20,
                0x58, 0x20, 0x59, 0x20, 0x5A, 0x20, 0x5B, 0x20,
                0x5C, 0x20, 0x5D, 0x20, 0x5E, 0x20, 0x5F, 0x20,
                0x60, 0x20, 0x61, 0x20, 0x62, 0x20, 0x63, 0x20,
                0x64, 0x20, 0x65, 0x20, 0x66, 0x20, 0x67, 0x20,
                0x68, 0x20, 0x69, 0x20, 0x6A, 0x20, 0x6B, 0x20,
                0x6C, 0x20, 0x6D, 0x20, 0x6E, 0x20, 0x6F, 0x20,
                0x70, 0x20, 0x71, 0x20, 0x72, 0x20, 0x73, 0x20,
                0x74, 0x20, 0x75, 0x20, 0x76, 0x20, 0x77, 0x20,
                0x78, 0x20, 0x79, 0x20, 0x7A, 0x20, 0x7B, 0x20,
                0x7C, 0x20, 0x7D, 0x20, 0x7E, 0x20, 0x7F, 0x20,
                0x80, 0x20, 0x81, 0x20, 0x82, 0x20, 0x83, 0x20,
                0x84, 0x20, 0x85, 0x20, 0x86, 0x20, 0x87, 0x20,
                0x88, 0x20, 0x89, 0x20, 0x8A, 0x20, 0x8B, 0x20,
                0x8C, 0x20, 0x8D, 0x20, 0x8E, 0x20, 0x8F, 0x20,
                0x90, 0x20, 0x91, 0x20, 0x92, 0x20, 0x93, 0x20,
                0x94, 0x20, 0x95, 0x20, 0x96, 0x20, 0x97, 0x20,
                0x98, 0x20, 0x99, 0x20, 0x9A, 0x20, 0x9B, 0x20,
                0x9C, 0x20, 0x9D, 0x20, 0x9E, 0x20, 0x9F, 0x20,
                0xA0, 0x20, 0xA1, 0x20, 0xA2, 0x20, 0xA3, 0x20,
                0xA4, 0x20, 0xA5, 0x20, 0xA6, 0x20, 0xA7, 0x20,
                0xA8, 0x20, 0xA9, 0x20, 0xAA, 0x20, 0xAB, 0x20,
                0xAC, 0x20, 0xAD, 0x20, 0xAE, 0x20, 0xAF, 0x20,
                0xB0, 0x20, 0xB1, 0x20, 0xB2, 0x20, 0xB3, 0x20,
                0xB4, 0x20, 0xB5, 0x20, 0xB6, 0x20, 0xB7, 0x20,
                0xB8, 0x20, 0xB9, 0x20, 0xBA, 0x20, 0xBB, 0x20,
                0xBC, 0x20, 0xBD, 0x20, 0xBE, 0x20, 0xBF, 0x20,
                0xC0, 0x20, 0xC1, 0x20, 0xC2, 0x20, 0xC3, 0x20,
                0xC4, 0x20, 0xC5, 0x20, 0xC6, 0x20, 0xC7, 0x20,
                0xC8, 0x20, 0xC9, 0x20, 0xCA, 0x20, 0xCB, 0x20,
                0xCC, 0x20, 0xCD, 0x20, 0xCE, 0x20, 0xCF, 0x20,
                0xD0, 0x20, 0xD1, 0x20, 0xD2, 0x20, 0xD3, 0x20,
                0xD4, 0x20, 0xD5, 0x20, 0xD6, 0x20, 0xD7, 0x20,
                0xD8, 0x20, 0xD9, 0x20, 0xDA, 0x20, 0xDB, 0x20,
                0xDC, 0x20, 0xDD, 0x20, 0xDE, 0x20, 0xDF, 0x20,
                0xE0, 0x20, 0xE1, 0x20, 0xE2, 0x20, 0xE3, 0x20,
                0xE4, 0x20, 0xE5, 0x20, 0xE6, 0x20, 0xE7, 0x20,
                0xE8, 0x20, 0xE9, 0x20, 0xEA, 0x20, 0xEB, 0x20,
                0xEC, 0x20, 0xED, 0x20, 0xEE, 0x20, 0xEF, 0x20,
                0xF0, 0x20, 0xF1, 0x20, 0xF2, 0x20, 0xF3, 0x20,
                0xF4, 0x20, 0xF5, 0x20, 0xF6, 0x20, 0xF7, 0x20,
                0xF8, 0x20, 0xF9, 0x20, 0xFA, 0x20, 0xFB, 0x20,
                0xFC, 0x20, 0xFD, 0x20, 0xFE, 0x20, 0xFF, 0x20,
                0x00, 0x21, 0x01, 0x21, 0x02, 0x21, 0x03, 0x21,
                0x04, 0x21, 0x05, 0x21, 0x06, 0x21, 0x07, 0x21,
                0x08, 0x21, 0x09, 0x21, 0x0A, 0x21, 0x0B, 0x21,
                0x0C, 0x21, 0x0D, 0x21, 0x0E, 0x21, 0x0F, 0x21,
                0x10, 0x21, 0x11, 0x21, 0x12, 0x21, 0x13, 0x21,
                0x14, 0x21, 0x15, 0x21, 0x16, 0x21, 0x17, 0x21,
                0x18, 0x21, 0x19, 0x21, 0x1A, 0x21, 0x1B, 0x21,
                0x1C, 0x21, 0x1D, 0x21, 0x1E, 0x21, 0x1F, 0x21,
                0x20, 0x21, 0x21, 0x21, 0x22, 0x21, 0x23, 0x21,
                0x24, 0x21, 0x25, 0x21, 0x26, 0x21, 0x27, 0x21,
                0x28, 0x21, 0x29, 0x21, 0x2A, 0x21, 0x2B, 0x21,
                0x2C, 0x21, 0x2D, 0x21, 0x2E, 0x21, 0x2F, 0x21,
                0x30, 0x21, 0x31, 0x21, 0x32, 0x21, 0x33, 0x21,
                0x34, 0x21, 0x35, 0x21, 0x36, 0x21, 0x37, 0x21,
                0x38, 0x21, 0x39, 0x21, 0x3A, 0x21, 0x3B, 0x21,
                0x3C, 0x21, 0x3D, 0x21, 0x3E, 0x21, 0x3F, 0x21,
                0x40, 0x21, 0x41, 0x21, 0x42, 0x21, 0x43, 0x21,
                0x44, 0x21, 0x45, 0x21, 0x46, 0x21, 0x47, 0x21,
                0x48, 0x21, 0x49, 0x21, 0x4A, 0x21, 0x4B, 0x21,
                0x4C, 0x21, 0x4D, 0x21, 0x32, 0x21, 0x4F, 0x21,
                0x50, 0x21, 0x51, 0x21, 0x52, 0x21, 0x53, 0x21,
                0x54, 0x21, 0x55, 0x21, 0x56, 0x21, 0x57, 0x21,
                0x58, 0x21, 0x59, 0x21, 0x5A, 0x21, 0x5B, 0x21,
                0x5C, 0x21, 0x5D, 0x21, 0x5E, 0x21, 0x5F, 0x21,
                0x60, 0x21, 0x61, 0x21, 0x62, 0x21, 0x63, 0x21,
                0x64, 0x21, 0x65, 0x21, 0x66, 0x21, 0x67, 0x21,
                0x68, 0x21, 0x69, 0x21, 0x6A, 0x21, 0x6B, 0x21,
                0x6C, 0x21, 0x6D, 0x21, 0x6E, 0x21, 0x6F, 0x21,
                0x60, 0x21, 0x61, 0x21, 0x62, 0x21, 0x63, 0x21,
                0x64, 0x21, 0x65, 0x21, 0x66, 0x21, 0x67, 0x21,
                0x68, 0x21, 0x69, 0x21, 0x6A, 0x21, 0x6B, 0x21,
                0x6C, 0x21, 0x6D, 0x21, 0x6E, 0x21, 0x6F, 0x21,
                0x80, 0x21, 0x81, 0x21, 0x82, 0x21, 0x83, 0x21,
                0x83, 0x21, 0xFF, 0xFF, 0x4B, 0x03, 0xB6, 0x24,
                0xB7, 0x24, 0xB8, 0x24, 0xB9, 0x24, 0xBA, 0x24,
                0xBB, 0x24, 0xBC, 0x24, 0xBD, 0x24, 0xBE, 0x24,
                0xBF, 0x24, 0xC0, 0x24, 0xC1, 0x24, 0xC2, 0x24,
                0xC3, 0x24, 0xC4, 0x24, 0xC5, 0x24, 0xC6, 0x24,
                0xC7, 0x24, 0xC8, 0x24, 0xC9, 0x24, 0xCA, 0x24,
                0xCB, 0x24, 0xCC, 0x24, 0xCD, 0x24, 0xCE, 0x24,
                0xCF, 0x24, 0xFF, 0xFF, 0x46, 0x07, 0x00, 0x2C,
                0x01, 0x2C, 0x02, 0x2C, 0x03, 0x2C, 0x04, 0x2C,
                0x05, 0x2C, 0x06, 0x2C, 0x07, 0x2C, 0x08, 0x2C,
                0x09, 0x2C, 0x0A, 0x2C, 0x0B, 0x2C, 0x0C, 0x2C,
                0x0D, 0x2C, 0x0E, 0x2C, 0x0F, 0x2C, 0x10, 0x2C,
                0x11, 0x2C, 0x12, 0x2C, 0x13, 0x2C, 0x14, 0x2C,
                0x15, 0x2C, 0x16, 0x2C, 0x17, 0x2C, 0x18, 0x2C,
                0x19, 0x2C, 0x1A, 0x2C, 0x1B, 0x2C, 0x1C, 0x2C,
                0x1D, 0x2C, 0x1E, 0x2C, 0x1F, 0x2C, 0x20, 0x2C,
                0x21, 0x2C, 0x22, 0x2C, 0x23, 0x2C, 0x24, 0x2C,
                0x25, 0x2C, 0x26, 0x2C, 0x27, 0x2C, 0x28, 0x2C,
                0x29, 0x2C, 0x2A, 0x2C, 0x2B, 0x2C, 0x2C, 0x2C,
                0x2D, 0x2C, 0x2E, 0x2C, 0x5F, 0x2C, 0x60, 0x2C,
                0x60, 0x2C, 0x62, 0x2C, 0x63, 0x2C, 0x64, 0x2C,
                0x65, 0x2C, 0x66, 0x2C, 0x67, 0x2C, 0x67, 0x2C,
                0x69, 0x2C, 0x69, 0x2C, 0x6B, 0x2C, 0x6B, 0x2C,
                0x6D, 0x2C, 0x6E, 0x2C, 0x6F, 0x2C, 0x70, 0x2C,
                0x71, 0x2C, 0x72, 0x2C, 0x73, 0x2C, 0x74, 0x2C,
                0x75, 0x2C, 0x75, 0x2C, 0x77, 0x2C, 0x78, 0x2C,
                0x79, 0x2C, 0x7A, 0x2C, 0x7B, 0x2C, 0x7C, 0x2C,
                0x7D, 0x2C, 0x7E, 0x2C, 0x7F, 0x2C, 0x80, 0x2C,
                0x80, 0x2C, 0x82, 0x2C, 0x82, 0x2C, 0x84, 0x2C,
                0x84, 0x2C, 0x86, 0x2C, 0x86, 0x2C, 0x88, 0x2C,
                0x88, 0x2C, 0x8A, 0x2C, 0x8A, 0x2C, 0x8C, 0x2C,
                0x8C, 0x2C, 0x8E, 0x2C, 0x8E, 0x2C, 0x90, 0x2C,
                0x90, 0x2C, 0x92, 0x2C, 0x92, 0x2C, 0x94, 0x2C,
                0x94, 0x2C, 0x96, 0x2C, 0x96, 0x2C, 0x98, 0x2C,
                0x98, 0x2C, 0x9A, 0x2C, 0x9A, 0x2C, 0x9C, 0x2C,
                0x9C, 0x2C, 0x9E, 0x2C, 0x9E, 0x2C, 0xA0, 0x2C,
                0xA0, 0x2C, 0xA2, 0x2C, 0xA2, 0x2C, 0xA4, 0x2C,
                0xA4, 0x2C, 0xA6, 0x2C, 0xA6, 0x2C, 0xA8, 0x2C,
                0xA8, 0x2C, 0xAA, 0x2C, 0xAA, 0x2C, 0xAC, 0x2C,
                0xAC, 0x2C, 0xAE, 0x2C, 0xAE, 0x2C, 0xB0, 0x2C,
                0xB0, 0x2C, 0xB2, 0x2C, 0xB2, 0x2C, 0xB4, 0x2C,
                0xB4, 0x2C, 0xB6, 0x2C, 0xB6, 0x2C, 0xB8, 0x2C,
                0xB8, 0x2C, 0xBA, 0x2C, 0xBA, 0x2C, 0xBC, 0x2C,
                0xBC, 0x2C, 0xBE, 0x2C, 0xBE, 0x2C, 0xC0, 0x2C,
                0xC0, 0x2C, 0xC2, 0x2C, 0xC2, 0x2C, 0xC4, 0x2C,
                0xC4, 0x2C, 0xC6, 0x2C, 0xC6, 0x2C, 0xC8, 0x2C,
                0xC8, 0x2C, 0xCA, 0x2C, 0xCA, 0x2C, 0xCC, 0x2C,
                0xCC, 0x2C, 0xCE, 0x2C, 0xCE, 0x2C, 0xD0, 0x2C,
                0xD0, 0x2C, 0xD2, 0x2C, 0xD2, 0x2C, 0xD4, 0x2C,
                0xD4, 0x2C, 0xD6, 0x2C, 0xD6, 0x2C, 0xD8, 0x2C,
                0xD8, 0x2C, 0xDA, 0x2C, 0xDA, 0x2C, 0xDC, 0x2C,
                0xDC, 0x2C, 0xDE, 0x2C, 0xDE, 0x2C, 0xE0, 0x2C,
                0xE0, 0x2C, 0xE2, 0x2C, 0xE2, 0x2C, 0xE4, 0x2C,
                0xE5, 0x2C, 0xE6, 0x2C, 0xE7, 0x2C, 0xE8, 0x2C,
                0xE9, 0x2C, 0xEA, 0x2C, 0xEB, 0x2C, 0xEC, 0x2C,
                0xED, 0x2C, 0xEE, 0x2C, 0xEF, 0x2C, 0xF0, 0x2C,
                0xF1, 0x2C, 0xF2, 0x2C, 0xF3, 0x2C, 0xF4, 0x2C,
                0xF5, 0x2C, 0xF6, 0x2C, 0xF7, 0x2C, 0xF8, 0x2C,
                0xF9, 0x2C, 0xFA, 0x2C, 0xFB, 0x2C, 0xFC, 0x2C,
                0xFD, 0x2C, 0xFE, 0x2C, 0xFF, 0x2C, 0xA0, 0x10,
                0xA1, 0x10, 0xA2, 0x10, 0xA3, 0x10, 0xA4, 0x10,
                0xA5, 0x10, 0xA6, 0x10, 0xA7, 0x10, 0xA8, 0x10,
                0xA9, 0x10, 0xAA, 0x10, 0xAB, 0x10, 0xAC, 0x10,
                0xAD, 0x10, 0xAE, 0x10, 0xAF, 0x10, 0xB0, 0x10,
                0xB1, 0x10, 0xB2, 0x10, 0xB3, 0x10, 0xB4, 0x10,
                0xB5, 0x10, 0xB6, 0x10, 0xB7, 0x10, 0xB8, 0x10,
                0xB9, 0x10, 0xBA, 0x10, 0xBB, 0x10, 0xBC, 0x10,
                0xBD, 0x10, 0xBE, 0x10, 0xBF, 0x10, 0xC0, 0x10,
                0xC1, 0x10, 0xC2, 0x10, 0xC3, 0x10, 0xC4, 0x10,
                0xC5, 0x10, 0xFF, 0xFF, 0x1B, 0xD2, 0x21, 0xFF,
                0x22, 0xFF, 0x23, 0xFF, 0x24, 0xFF, 0x25, 0xFF,
                0x26, 0xFF, 0x27, 0xFF, 0x28, 0xFF, 0x29, 0xFF,
                0x2A, 0xFF, 0x2B, 0xFF, 0x2C, 0xFF, 0x2D, 0xFF,
                0x2E, 0xFF, 0x2F, 0xFF, 0x30, 0xFF, 0x31, 0xFF,
                0x32, 0xFF, 0x33, 0xFF, 0x34, 0xFF, 0x35, 0xFF,
                0x36, 0xFF, 0x37, 0xFF, 0x38, 0xFF, 0x39, 0xFF,
                0x3A, 0xFF, 0x5B, 0xFF, 0x5C, 0xFF, 0x5D, 0xFF,
                0x5E, 0xFF, 0x5F, 0xFF, 0x60, 0xFF, 0x61, 0xFF,
                0x62, 0xFF, 0x63, 0xFF, 0x64, 0xFF, 0x65, 0xFF,
                0x66, 0xFF, 0x67, 0xFF, 0x68, 0xFF, 0x69, 0xFF,
                0x6A, 0xFF, 0x6B, 0xFF, 0x6C, 0xFF, 0x6D, 0xFF,
                0x6E, 0xFF, 0x6F, 0xFF, 0x70, 0xFF, 0x71, 0xFF,
                0x72, 0xFF, 0x73, 0xFF, 0x74, 0xFF, 0x75, 0xFF,
                0x76, 0xFF, 0x77, 0xFF, 0x78, 0xFF, 0x79, 0xFF,
                0x7A, 0xFF, 0x7B, 0xFF, 0x7C, 0xFF, 0x7D, 0xFF,
                0x7E, 0xFF, 0x7F, 0xFF, 0x80, 0xFF, 0x81, 0xFF,
                0x82, 0xFF, 0x83, 0xFF, 0x84, 0xFF, 0x85, 0xFF,
                0x86, 0xFF, 0x87, 0xFF, 0x88, 0xFF, 0x89, 0xFF,
                0x8A, 0xFF, 0x8B, 0xFF, 0x8C, 0xFF, 0x8D, 0xFF,
                0x8E, 0xFF, 0x8F, 0xFF, 0x90, 0xFF, 0x91, 0xFF,
                0x92, 0xFF, 0x93, 0xFF, 0x94, 0xFF, 0x95, 0xFF,
                0x96, 0xFF, 0x97, 0xFF, 0x98, 0xFF, 0x99, 0xFF,
                0x9A, 0xFF, 0x9B, 0xFF, 0x9C, 0xFF, 0x9D, 0xFF,
                0x9E, 0xFF, 0x9F, 0xFF, 0xA0, 0xFF, 0xA1, 0xFF,
                0xA2, 0xFF, 0xA3, 0xFF, 0xA4, 0xFF, 0xA5, 0xFF,
                0xA6, 0xFF, 0xA7, 0xFF, 0xA8, 0xFF, 0xA9, 0xFF,
                0xAA, 0xFF, 0xAB, 0xFF, 0xAC, 0xFF, 0xAD, 0xFF,
                0xAE, 0xFF, 0xAF, 0xFF, 0xB0, 0xFF, 0xB1, 0xFF,
                0xB2, 0xFF, 0xB3, 0xFF, 0xB4, 0xFF, 0xB5, 0xFF,
                0xB6, 0xFF, 0xB7, 0xFF, 0xB8, 0xFF, 0xB9, 0xFF,
                0xBA, 0xFF, 0xBB, 0xFF, 0xBC, 0xFF, 0xBD, 0xFF,
                0xBE, 0xFF, 0xBF, 0xFF, 0xC0, 0xFF, 0xC1, 0xFF,
                0xC2, 0xFF, 0xC3, 0xFF, 0xC4, 0xFF, 0xC5, 0xFF,
                0xC6, 0xFF, 0xC7, 0xFF, 0xC8, 0xFF, 0xC9, 0xFF,
                0xCA, 0xFF, 0xCB, 0xFF, 0xCC, 0xFF, 0xCD, 0xFF,
                0xCE, 0xFF, 0xCF, 0xFF, 0xD0, 0xFF, 0xD1, 0xFF,
                0xD2, 0xFF, 0xD3, 0xFF, 0xD4, 0xFF, 0xD5, 0xFF,
                0xD6, 0xFF, 0xD7, 0xFF, 0xD8, 0xFF, 0xD9, 0xFF,
                0xDA, 0xFF, 0xDB, 0xFF, 0xDC, 0xFF, 0xDD, 0xFF,
                0xDE, 0xFF, 0xDF, 0xFF, 0xE0, 0xFF, 0xE1, 0xFF,
                0xE2, 0xFF, 0xE3, 0xFF, 0xE4, 0xFF, 0xE5, 0xFF,
                0xE6, 0xFF, 0xE7, 0xFF, 0xE8, 0xFF, 0xE9, 0xFF,
                0xEA, 0xFF, 0xEB, 0xFF, 0xEC, 0xFF, 0xED, 0xFF,
                0xEE, 0xFF, 0xEF, 0xFF, 0xF0, 0xFF, 0xF1, 0xFF,
                0xF2, 0xFF, 0xF3, 0xFF, 0xF4, 0xFF, 0xF5, 0xFF,
                0xF6, 0xFF, 0xF7, 0xFF, 0xF8, 0xFF, 0xF9, 0xFF,
                0xFA, 0xFF, 0xFB, 0xFF, 0xFC, 0xFF, 0xFD, 0xFF,
                0xFE, 0xFF, 0xFF, 0xFF
        };


#endif

#if WITHEXFAT == 1
/***************************************************************************/
BOOLEAN EXFAT_Format(INT16S dsk, INT32U sector_offset,  INT32U sector_number, INT8U *buf)
{
	INT32U TmpVal1,TmpVal2, nfsect;
	INT32U nsector, FATStartSector, FATEndSector, i,ClusterCount,DirSatarClu,MaptableClu,UpCaseClu;
	INT32U FATEndClusAlign=0,uiChecksum = 0;
	INT8U ClusterShift=0;
#ifdef	unSP
	INT16U *bp = (INT16U *)buf;
#else
	INT8U *bp = (INT8U *)buf;
#endif
#if FS_FORMAT_SPEEDUP == 1	
	INT32U *p_format_temp_buffer;
#endif

	for (i=0; i < 4; i++)
	{
		if (sector_number <= DskTableEXFAT[i].DiskSize) 
		{
			nsector = DskTableEXFAT[i].SecPerClusVal;
			if (nsector == 0) 
			{
				format_printf("fail to format\n");
				return FALSE;
			}
			break;
		}
	}
	i = nsector;
	i>>=1;
	while(i)
	{
		i>>=1;
		ClusterShift++;
	}
	
	TmpVal1 = sector_number - ((24+nsector-1)/nsector)*nsector;				//亲，要以簇对齐哦(^-^)
	TmpVal2 = ((256 * nsector) + 2) >> 1;
	nfsect = (TmpVal1 + (TmpVal2 - 1)) / TmpVal2;  							// fat table size
  
	FATStartSector = ((24+nsector-1)/nsector)*nsector + sector_offset; 
	FATEndSector = FATStartSector + nfsect ;
	//对于ExFat 实现data区16K对齐，非常简单 故取消了原先忠琪方法
	FATEndClusAlign=(FATEndSector+ALIGN_16-1)/ALIGN_16*ALIGN_16;
	ClusterCount=(sector_number-FATEndClusAlign)/nsector;

	//位图占用多少簇
	TmpVal1 = (ClusterCount+4095)/4096;										//位图占用Sector个数
	MaptableClu = (TmpVal1+nsector-1)/nsector;								//位图占用簇个数
	TmpVal1 = (FORMAT_UPCASE_LENGTH+511)/512;								//计算Upcase占用secotor
	UpCaseClu = (TmpVal1+nsector-1)/nsector;								//Upcase占用簇个数
	DirSatarClu = MaptableClu+UpCaseClu+2;									//Dir boot 所在簇
	//==========================================================================	
	fmemset(bp, 0, 512>>WORD_PACK_VALUE);
	//BPB
	bp[0] = 0xeb, bp[1] = 0x76, bp[2] = 0x90;	
	strcpy((CHAR *) bp+3, "EXFAT   ");			
	
	putlong(&bp[ExPartionOffSet>>WORD_PACK_VALUE], sector_offset);
	putlong(&bp[ExVolumeLongth>>WORD_PACK_VALUE], sector_number);
	putlong(&bp[ExFatTableoffset>>WORD_PACK_VALUE], FATStartSector-sector_offset);	
	putlong(&bp[ExFatLenth>>WORD_PACK_VALUE], nfsect);	
	putlong(&bp[ExClusterHeapOffset>>WORD_PACK_VALUE], FATEndClusAlign-sector_offset);	
	putlong(&bp[ExClusterCount>>WORD_PACK_VALUE], ClusterCount);	
	putlong(&bp[ExRootCluster>>WORD_PACK_VALUE], DirSatarClu);	
	putlong(&bp[ExVolumeSerialNumber>>WORD_PACK_VALUE], 0x08352D5A);	
	putword(&bp[ExFileSysRevision>>WORD_PACK_VALUE], 0x0100);
	putword(&bp[ExVolumeFlags>>WORD_PACK_VALUE], 0x00);
	bp[ExPerSectorShift]=9;
	bp[ExClusterPerShift]=ClusterShift;
	bp[ExNumofFats]=1;
	bp[ExDriveSelect]=0x80;
	bp[ExPercentUse]=0x03;
	putword(&bp[DBR_end_Addr>>WORD_PACK_VALUE], 0xAA55);

	if ( 0 != dskxfer(dsk, sector_offset, (INT32U)bp, 1, DSKWRITE) )
	{
		return FALSE;			
	}
//8个扩展引导扇区
	memset(bp, 0, 512>>WORD_PACK_VALUE);
	putword(&bp[DBR_end_Addr>>WORD_PACK_VALUE], 0xAA55);
	for(i=1;i<9;i++)
	{
		if ( 0 != dskxfer(dsk, sector_offset+i, (INT32U)bp, 1, DSKWRITE) )
		{
			return FALSE;			
		}
	}
//2个OEM区	
	memset(bp, 0, 512>>WORD_PACK_VALUE);
	for(i=9;i<11;i++)
	{
		if ( 0 != dskxfer(dsk, sector_offset+i, (INT32U)bp, 1, DSKWRITE) )
		{
			return FALSE;			
		}
	}
//计算校验区
	for(TmpVal1=0;TmpVal1<11;TmpVal1++)
	{
		if ( 0 != dskxfer(dsk, sector_offset+TmpVal1, (INT32U)bp, 1, DSKREAD) )
		{
			return FALSE;			
		}
		
		for (i=0;i<512;i++) {
			if (((i == 106) || (i ==107) || (i == 112))&&(TmpVal1 == 0)) {
					continue;
			}
			uiChecksum = ((uiChecksum&1)?0x80000000:0) + (uiChecksum>>1) + (INT32U)bp[i];
		}
	}	
	for (i=0;i<128;i++) {
			putlong(&bp[(i*4)>>WORD_PACK_VALUE], uiChecksum);
	}
	if ( 0 != dskxfer(dsk, sector_offset+11, (INT32U)bp, 1, DSKWRITE) )
	{
		return FALSE;			
	}
//复制备份区
	for(TmpVal1=0;TmpVal1<12;TmpVal1++)
	{
		if ( 0 != dskxfer(dsk, sector_offset+TmpVal1, (INT32U)bp, 1, DSKREAD) )
		{
			return FALSE;			
		}
		
		if ( 0 != dskxfer(dsk, sector_offset+12+TmpVal1, (INT32U)bp, 1, DSKWRITE) )
		{
			return FALSE;			
		}	
	}
	memset(bp, 0, 512>>WORD_PACK_VALUE);
	for(TmpVal1=24;TmpVal1<(FATStartSector-sector_offset);TmpVal1++)
	{
		if ( 0 != dskxfer(dsk, sector_offset+TmpVal1, (INT32U)bp, 1, DSKWRITE) )
		{
			return FALSE;			
		}	
	}
//开始写FAT表
#if FS_FORMAT_SPEEDUP == 1
#if FS_FORMAT_SPEEDUP_BUFFER_SOURCE == ALLOCATE_BUFFER
	p_format_temp_buffer = (INT32U*)gp_malloc_align(C_FS_FORMAT_BUFFER_SIZE,4);
#else
	p_format_temp_buffer = (INT32U*)gFS_format_speedup_buffer;
#endif
	if(p_format_temp_buffer)
	{
		gp_memset((INT8S*)p_format_temp_buffer, 0, C_FS_FORMAT_BUFFER_SIZE>>WORD_PACK_VALUE);
		for (i = FATStartSector; i < FATEndClusAlign ; i += C_FS_FORMAT_BUFFER_SECTOR_SIZE)
		{
			if( 0 != FileSysDrv[dsk]->Drv_WriteSector(i, C_FS_FORMAT_BUFFER_SECTOR_SIZE, (INT32U)p_format_temp_buffer) )
			{
		      #if FS_FORMAT_SPEEDUP_BUFFER_SOURCE == ALLOCATE_BUFFER
				gp_free(p_format_temp_buffer);
		      #endif
				return FALSE;
			}
		}
		if(i > FATEndClusAlign)
		{
			if( 0 != FileSysDrv[dsk]->Drv_WriteSector(i - C_FS_FORMAT_BUFFER_SECTOR_SIZE, C_FS_FORMAT_BUFFER_SECTOR_SIZE - (i - FATEndClusAlign), (INT32U)p_format_temp_buffer) )
			{
		      #if FS_FORMAT_SPEEDUP_BUFFER_SOURCE == ALLOCATE_BUFFER
				gp_free(p_format_temp_buffer);
		      #endif
				return FALSE;
			}
		}
	  #if (FS_FORMAT_SPEEDUP == 1) && (FS_FORMAT_SPEEDUP_BUFFER_SOURCE == ALLOCATE_BUFFER)
		gp_free(p_format_temp_buffer);
	  #endif
	}
	else
#endif
	{
		for (i = FATStartSector; i < FATEndClusAlign; i++)
		{
			if (i == FATStartSector) 
			{
				continue;
			}
			
			if ( 0 != dskxfer(dsk, i, (INT32U)bp, 1, DSKWRITE) )
			{
				return FALSE;
			}
		}
	}
	memset(bp, 0xff, 8);
	bp[0] = 0xf8;
//现把要填好的待使用的簇，填好(^-^)	
	for(i=0;i<(DirSatarClu-1);i++)
	{
		putlong(&bp[(8+i*4)>>WORD_PACK_VALUE], 0xFFFFFFFF);	
	}
	
	if ( 0 != dskxfer(dsk, FATStartSector, (INT32U)bp, 1, DSKWRITE) )
	{
		return FALSE;			
	}
//簇分配表	
	fmemset(bp, 0, 512>>WORD_PACK_VALUE);
	for(i = 0;i<MaptableClu*nsector;i++)
	{
		if ( 0 != dskxfer(dsk, FATEndClusAlign+i, (INT32U)bp, 1, DSKWRITE) )
		{	
			return FALSE;			
		}
	}
//实现分配好matable
	{

		INT32U *Value = (INT32U *)bp;
		INT32U BitUp = 1;
		for(i=0;i<(DirSatarClu-1);i++)
		{
			*(Value+i/32)|=BitUp;	
			BitUp<<=1;
			if(BitUp == 0)
			{
				BitUp = 1;
			}
		}
	}
	if ( 0 != dskxfer(dsk, FATEndClusAlign, (INT32U)bp, 1, DSKWRITE) )
	{
		return FALSE;			
	}
//UpCase
	if( 0 != FileSysDrv[dsk]->Drv_WriteSector(MaptableClu*nsector+FATEndClusAlign,FORMAT_UPCASE_LENGTH/512, (INT32U)G_EXFAT_UPCASE_TABLE) )
	{
		return FALSE;
	}

	fmemset(bp, 0, 512>>WORD_PACK_VALUE);
	TmpVal1 = FORMAT_UPCASE_LENGTH/512 * 512;
	memcpy(bp,&G_EXFAT_UPCASE_TABLE[TmpVal1],FORMAT_UPCASE_LENGTH - TmpVal1);
	i = MaptableClu*nsector+FATEndClusAlign + FORMAT_UPCASE_LENGTH/512;
	if ( 0 != dskxfer(dsk, i, (INT32U)bp, 1, DSKWRITE) )
	{
		return FALSE;			
	}
	i++;
	TmpVal1 = (DirSatarClu-2)*nsector+FATEndClusAlign;
	fmemset(bp, 0, 512>>WORD_PACK_VALUE);
	for(;i<TmpVal1;i++)
	{
		if ( 0 != dskxfer(dsk, i, (INT32U)bp, 1, DSKWRITE) )
		{
			return FALSE;			
		}	
	}
//Dir Build
	TmpVal1 +=nsector;
	for(;i<TmpVal1;i++)
	{
		if ( 0 != dskxfer(dsk, i, (INT32U)bp, 1, DSKWRITE) )
		{
			return FALSE;			
		}	
	}
	//建立Volume
	bp[0] = 0x03;
	//建立maptable dir
	bp[0x20] = 0x81;
	bp[0x34] = 0x02;
	TmpVal1 = (ClusterCount+7)/8;
	putlong(&bp[0x38], TmpVal1);
	//建立Upcase
	bp[0x40] = 0x82;
	putlong(&bp[0x44], 0xe619d30d);
	putlong(&bp[0x54], MaptableClu+2);
	putlong(&bp[0x58], FORMAT_UPCASE_LENGTH);

	TmpVal1 = (DirSatarClu-2)*nsector+FATEndClusAlign;
	if ( 0 != dskxfer(dsk, TmpVal1, (INT32U)bp, 1, DSKWRITE) )
	{
		return FALSE;			
	}
	return TRUE; 
}
#else
BOOLEAN EXFAT_Format(INT16S dsk, INT32U sector_offset,  INT32U sector_number, INT8U *buf)
{
    return -1;
}

#endif





#if WITHFAT12 == 1
//if disk size > 16M, FAT16 is more good than FAT12.
/***************************************************************************/
BOOLEAN FAT12_Format(INT16S dsk, INT32U sector_offset,  INT32U sector_number, INT8U *buf)
{
	INT32U TempValue;
	INT16U nfsect;
	INT16U nsector, FATStartSector, RootEndSector, i;
	INT8U *bp = (INT8U *)buf;
#if FS_FORMAT_SPEEDUP == 1
	INT32U *p_format_temp_buffer;
#endif

	for (i=0; i<5; i++) {
		if (sector_number <= DskTableFAT12[i].DiskSize) {
			nsector = DskTableFAT12[i].SecPerClusVal;
			if (nsector == 0){
				return FALSE;
			}
			break;
		}
	}

	// ( 簇总数 ＋ 2个保留扇区 ) 占用多少个扇区 
	TempValue = sector_number / nsector;	
	nfsect = ( INT16U)(((TempValue + 2) * 3 + 1023) >> 10);
	
	fmemset(bp, 0, 512>>WORD_PACK_VALUE);
	if ( 0 != dskxfer(dsk, sector_offset, (INT32U)bp, 1, DSKWRITE) )
	{
		return FALSE;			
	}

	FATStartSector = 1+sector_offset;
	RootEndSector = FATStartSector + (nfsect<<1)+(0x0200*32+(512-1))/512;
	memset(bp, 0, 512>>WORD_PACK_VALUE);
	
#if FS_FORMAT_SPEEDUP == 1
	p_format_temp_buffer = (INT32U*)gp_malloc_align(C_FS_FORMAT_BUFFER_SIZE,4);
	if(p_format_temp_buffer)
	{
		gp_memset((INT8S*)p_format_temp_buffer, 0, C_FS_FORMAT_BUFFER_SIZE>>WORD_PACK_VALUE);
		for (i = FATStartSector; i < RootEndSector; i += C_FS_FORMAT_BUFFER_SECTOR_SIZE)
		{
			if( 0 != FileSysDrv[dsk]->Drv_WriteSector(i, C_FS_FORMAT_BUFFER_SECTOR_SIZE, (INT32U)p_format_temp_buffer) )
			{
			#if FS_FORMAT_SPEEDUP_BUFFER_SOURCE == ALLOCATE_BUFFER
				gp_free(p_format_temp_buffer);
			#endif
				return FALSE;
			}
		}
		if(i > RootEndSector)
		{
			if( 0 != FileSysDrv[dsk]->Drv_WriteSector(i - C_FS_FORMAT_BUFFER_SECTOR_SIZE, C_FS_FORMAT_BUFFER_SECTOR_SIZE - (i - RootEndSector), (INT32U)p_format_temp_buffer) )
			{
			#if FS_FORMAT_SPEEDUP_BUFFER_SOURCE == ALLOCATE_BUFFER
				gp_free(p_format_temp_buffer);
			#endif
				return FALSE;
			}
		}
	}
	else
#endif
	{
		for (i=FATStartSector; i<RootEndSector; i++)
		{
			if ( (i == FATStartSector) || (i == FATStartSector+nfsect) ) 
			{
				continue;
			}

		    if ( 0 != dskxfer(dsk, i, (INT32U)bp, 1, DSKWRITE) )
			{
			#if (FS_FORMAT_SPEEDUP == 1) && (FS_FORMAT_SPEEDUP_BUFFER_SOURCE == ALLOCATE_BUFFER)
				gp_free(p_format_temp_buffer);
			#endif
				return FALSE;			
			}
		}
	}
	
	memset(bp, 0xff, 3);
	bp[0] = 0xf8;

	if ( 0 != dskxfer(dsk, FATStartSector, (INT32U)bp, 1, DSKWRITE) )
	{
	#if (FS_FORMAT_SPEEDUP == 1) && (FS_FORMAT_SPEEDUP_BUFFER_SOURCE == ALLOCATE_BUFFER)
		gp_free(p_format_temp_buffer);
	#endif
		return FALSE;			
	}
	if ( 0 != dskxfer(dsk, FATStartSector + nfsect, (INT32U)bp, 1, DSKWRITE) )
	{
	#if (FS_FORMAT_SPEEDUP == 1) && (FS_FORMAT_SPEEDUP_BUFFER_SOURCE == ALLOCATE_BUFFER)
		gp_free(p_format_temp_buffer);
	#endif
		return FALSE;
	}
	
	fmemset(bp, 0, 512>>WORD_PACK_VALUE);

	bp[0] = 0xeb, bp[1] = 0x3c, bp[2] = 0x90;	// 0xEB 3C 90
	strcpy((CHAR *) bp+3, "MSWIN4.1");				// MSWIN4.1
	bp[12] = 0x02;								// 0x0200=512 bytes per sector
	bp[13] = nsector;
	putword(&bp[DBR_nreserved_Addr>>WORD_PACK_VALUE], 0x0001);
	putword(&bp[16], 0x02);
	putword(&bp[18], 0x0002);
	putword(&bp[20], 0xf800);

	if (sector_number > 65535 )		
	{
		putword(&bp[DBR_nsize_Addr], 0x0000);
		putlong(&bp[DBR_huge_Addr>>WORD_PACK_VALUE], sector_number);
	}
	else
	{
		bp[19] = sector_number & 0xFF;
		bp[20] = (sector_number >> 8) & 0xFF;
		putlong(&bp[DBR_huge_Addr>>WORD_PACK_VALUE], 0x00000000);		 
	}
	 
	putword(&bp[DBR_nfsect_Addr>>WORD_PACK_VALUE], nfsect);
	putlong(&bp[DBR_hidden_Addr>>WORD_PACK_VALUE], sector_offset);

	bp[38] = 0x29;
	putlong(&bp[DBR_FAT16_VOL_ID], 0x20041014);
	memcpy(&bp[DBR_FAT16_VOL_LAB], "NO NAME    ", 11);	
	memcpy(&bp[DBR_FAT16_FilSysType], "FAT12", 5);

	bp[36>>WORD_PACK_VALUE] = 0x80;       //BS_DrvNum     0x00 for floopy disks, 0x80 for hard disks	 

	putword(&bp[DBR_end_Addr>>WORD_PACK_VALUE], 0xaa55);
	if ( 0 != dskxfer(dsk, sector_offset, (INT32U)bp, 1, DSKWRITE) )
	{
	#if (FS_FORMAT_SPEEDUP == 1) && (FS_FORMAT_SPEEDUP_BUFFER_SOURCE == ALLOCATE_BUFFER)
		gp_free(p_format_temp_buffer);
	#endif
		return FALSE;			
	}
	
#if (FS_FORMAT_SPEEDUP == 1) && (FS_FORMAT_SPEEDUP_BUFFER_SOURCE == ALLOCATE_BUFFER)
	gp_free(p_format_temp_buffer);
#endif
	return TRUE; 
}
#endif

INT16S CheckMBR(INT16S dsk,  INT32U * sector_offset,  INT32U * sector_number, INT8U * bp)
{

	 *sector_number = 0;
	 *sector_offset = 0;
	
	 if ( 0 != dskxfer(dsk, 0, (INT32U)bp, 1, DSKREAD) )
	 {
		 return DE_INVLDDRV; 
	 }

	 if ( getword(&(bp[0x1fe>>WORD_PACK_VALUE])) != 0xaa55 )
	 {
		 return -1;
	 }
	
	 if ((bp[0] & 0xFF) == 0x00eb)
	 {
		 return -1;
	 }
	
	 *sector_number = getlong(&bp[C_MBR_SecNumber_Addr>>WORD_PACK_VALUE]);
	 *sector_offset = getlong(&bp[C_MBR_SecOffset_Addr>>WORD_PACK_VALUE]);
	
	 return 0;
}

INT16S fs_BuildMBR(INT16S dsk, INT8U FATType, INT16U ReservedSectorNum, INT8U * bp)
{	
	INT32U sector_number, sector_offset;
	struct DrvInfo info;
	
	if (!(FileSysDrv[dsk]->Status))
		return DE_INVLDDRV;
	
	if (ReservedSectorNum<32)   // Dominant modify, 32 reserve is avalible
	{
		return DE_INVLDACC;
	}

	// 在此处获得逻辑空间的总数
	FileSysDrv[dsk]->Drv_GetDrvInfo(&info); 
	sector_number = info.nSectors;

	if (sector_number<1024)
	{
		return DE_INVLDACC;
	}
	
	sector_number -= 16;
	sector_number -= ReservedSectorNum;
	sector_offset = ReservedSectorNum;

	fmemset(bp, 0, 512>>WORD_PACK_VALUE);

#ifdef unSP
	bp[0x1be>>WORD_PACK_VALUE] = 0x0180;	 
#else
	putword(&bp[0x1be], 0x0180);
#endif

	putword(&bp[0x1c0>>WORD_PACK_VALUE], 0x01);
	putword(&bp[0x1c4>>WORD_PACK_VALUE], 0x0000);	 
	putlong(&bp[0x1c6>>WORD_PACK_VALUE], sector_offset);
	putlong(&bp[0x1ca>>WORD_PACK_VALUE], sector_number);
	putword(&bp[0x1fe>>WORD_PACK_VALUE], 0xaa55);
	
	{
		INT8U fat_type;
		fat_type = FATType &0x0f;

		if (FAT16_Type == fat_type ) 
		{
			bp[C_MBR_Type_Addr>>WORD_PACK_VALUE] = MBR_FAT16_Type;			
		}
		else if ( FAT32_Type == fat_type ) 
		{
			bp[C_MBR_Type_Addr>>WORD_PACK_VALUE] = MBR_FAT32_Type;			
		}
		else if(EXFAT_Type == fat_type)
		{
			bp[C_MBR_Type_Addr>>WORD_PACK_VALUE] = MBR_EXFAT_Type;	
		}
		else{
			return DE_INVLDACC;			
		}
	}

	if ( 0 != dskxfer(dsk, 0, (INT32U)bp, 1, DSKWRITE) )
	{
		return FALSE;			
	}

	return 0;
}

/***************************************************************************/
INT16S fat_format (INT16S dsk, INT8U FATType, INT16U ReservedSectorNum)
{
	INT8U *bp;
	INT32U sector_offset, sector_number;
	BOOLEAN val = FALSE; 
	INT16S ret;
	
	if (dsk>=MAX_DISK_NUM)
	{
		return DE_INVLDACC;
	}

	format_printf1("format DISK%d start\n",dsk);
	
	if (!(FileSysDrv[dsk]->Status))
		return DE_INVLDDRV;
	
	if (!flush1(firstbuf))
		return DE_INVLDBUF;
	
	firstbuf->b_flag &= ~BFR_VALID;
	
	bp = firstbuf->b_buffer;
	
	clear_buffers(dsk);
	
	if((FATType & 0x0f) == FAT12_Type)
	{
		struct DrvInfo info;
		
		FileSysDrv[dsk]->Drv_GetDrvInfo(&info); 
		sector_number = info.nSectors;
		sector_number -= 8;
	}
	else
	{
		ret = CheckMBR(dsk, &sector_offset, &sector_number, bp);
		
		if ((ret!=0)||((FATType & 0xf0) == 0x10))
		{
		    struct DrvInfo info;  // dominant add, if no MBR, get total sector from driver
		    FileSysDrv[dsk]->Drv_GetDrvInfo(&info);   // dominant add
            sector_number = info.nSectors;
        
			fs_BuildMBR(dsk, FATType, ReservedSectorNum, bp);
			
			if (CheckMBR(dsk, &sector_offset, &sector_number, bp)!=0)
			{
				return DE_INVLDACC;
			 
			}
		}
	}
	
	{
		INT8U fat_type;
		fat_type = FATType & 0x0f;
		
		if (FAT16_Type == fat_type) 
		{
			val = FAT16_Format(dsk,sector_offset, sector_number, bp); 			
		}
		else if (FAT32_Type == fat_type) 
		{
			val = FAT32_Format(dsk,sector_offset, sector_number, bp);			
		}
		else if (FAT12_Type == fat_type)
		{
			val = FAT12_Format(dsk,0, sector_number, bp);
		}
		else if (EXFAT_Type == fat_type)
		{
			val = EXFAT_Format(dsk,sector_offset, sector_number, bp);
		}
		else
		{
			return DE_INVLDACC;			
		}
	}

	flush_buffers(dsk); 
	
	if (val==TRUE)
	{
		ret = fs_mount(dsk);
		
		if (ret!=SUCCESS)
		{
			return ret;
		}
	}
	
	if (val==FALSE)
	{
		return DE_INVLDACC;
	}
	return SUCCESS;
}



#endif //READ_ONLY
