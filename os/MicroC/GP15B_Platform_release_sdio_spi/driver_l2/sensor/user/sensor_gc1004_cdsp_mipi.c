#include "driver_l1.h"
#include "drv_l1_power.h"
#include "drv_l1_interrupt.h"
#include "drv_l1_timer.h"
#include "drv_l1_i2c.h"
#include "drv_l1_csi.h"
#include "drv_l1_mipi.h"
#include "drv_l1_cdsp.h"
#include "drv_l1_front.h"
#include "drv_l2_cdsp.h"
#include "drv_l2_cdsp_config.h"
#include "drv_l2_sensor.h"
#include "drv_l2_sccb.h"
#include "gp_aeawb.h"
#include "sensor_gc1004_cdsp.h"

#define GC1004_SLAVE_ID		0x78

#define GC_48MHZ			800
#define GC_42MHZ			810

#define SENSOR_FLIP			0

//max resolution 1296*742
#define GC1004_RAW					0x01
#define GC1004_MIPI					0x02


//=== This is for code configuration DON'T REMOVE or MODIFY it ===//
#if (defined _SENSOR_GC1004_CDSP_MIPI) && (_SENSOR_GC1004_CDSP_MIPI == 1)
//================================================================//
//Set Gain
#if 0//(!GC1004_GC_AE)
#define ANALOG_GAIN_1 64 		// 1.00x
#define ANALOG_GAIN_2 90 		// 1.4x
#define ANALOG_GAIN_3 118 		// 1.8x
#define ANALOG_GAIN_4 163 		// 2.56x
#define ANALOG_GAIN_5 218 		// 3.40x
#define ANALOG_GAIN_6 304 		// 4.7x
#define ANALOG_GAIN_7 438 		// 6.84x
#define ANALOG_GAIN_8 602 		// 9.4x
#define ANALOG_GAIN_9 851 		// 13.2x
#endif

/**************************************************************************
 *                           C O N S T A N T S                            *
 **************************************************************************/
#define GC_48MHZ							800
#define GC_42MHZ							810
//#define GC_PCLK								GC_48MHZ

#define GC1004_MAX_EXPOSURE_TIME			(904)
#define GC1004_MIN_EXPOSURE_TIME			(8)

#define GC1004_MAX_ANALOG_GAIN				(8*100)
#define GC1004_MIN_ANALOG_GAIN				(1*100)

#define GC1004_MAX_DIGITAL_GAIN				(140)//(1.4*100)
#define GC1004_MIN_DIGITAL_GAIN 			(140)//0x100:1x //SENSOR_GC1004


//#if (GC_PCLK == GC_48MHZ)
#define GC1004_50HZ_EXP_TIME_TOTAL_48MHz			203
#define	GC1004_50HZ_INIT_EV_IDX_48MHz				130
#define GC1004_50HZ_NIGHT_EV_IDX_48MHz				156
#define GC1004_50HZ_DAY_EV_IDX_48MHz				96//200//120//202//56
#define GC1004_50HZ_MAX_EXP_IDX_48MHz				(GC1004_50HZ_EXP_TIME_TOTAL_48MHz-6)//31)  // <= GC1004_50HZ_EXP_TIME_TOTAL

#define GC1004_60HZ_EXP_TIME_TOTAL_48MHz			197
#define	GC1004_60HZ_INIT_EV_IDX_48MHz				122
#define GC1004_60HZ_NIGHT_EV_IDX_48MHz				149
#define GC1004_60HZ_DAY_EV_IDX_48MHz				96
#define GC1004_60HZ_MAX_EXP_IDX_48MHz				(GC1004_60HZ_EXP_TIME_TOTAL_48MHz-1)  // <= GC1004_60HZ_EXP_TIME_TOTAL

//#else //GC 42Mhz

#define GC1004_50HZ_EXP_TIME_TOTAL_42MHz			203
#define	GC1004_50HZ_INIT_EV_IDX_42MHz				120
#define GC1004_50HZ_NIGHT_EV_IDX_42MHz				140
#define GC1004_50HZ_DAY_EV_IDX_42MHz				96
#define GC1004_50HZ_MAX_EXP_IDX_42MHz				(GC1004_50HZ_EXP_TIME_TOTAL_42MHz-20)  // <= GC1004_50HZ_EXP_TIME_TOTAL

#define GC1004_60HZ_EXP_TIME_TOTAL_42MHz			198
#define	GC1004_60HZ_INIT_EV_IDX_42MHz				122
#define GC1004_60HZ_NIGHT_EV_IDX_42MHz				149
#define GC1004_60HZ_DAY_EV_IDX_42MHz				96
#define GC1004_60HZ_MAX_EXP_IDX_42MHz				(GC1004_60HZ_EXP_TIME_TOTAL_42MHz-15)  // <= GC1004_60HZ_EXP_TIME_TOTAL
//#endif

#define GC1004_GC_AE			1	//1:With new AE Table & Can switch 48MHz/42MHz, 0:With old AE Table, Can'nt switch 48/42MHz
/**************************************************************************
 *                          D A T A    T Y P E S                          *
 **************************************************************************/
typedef struct regval8_s 
{
	INT8U reg_num;
	INT8U value;
} regval8_t;




/**************************************************************************
 *                         G L O B A L    D A T A                         *
 **************************************************************************/
INT32U GC_CLK	= GC_48MHZ;

#if SCCB_MODE == SCCB_GPIO
	static void *gc1004_handle;
#elif SCCB_MODE == SCCB_HW_I2C
	static drv_l1_i2c_bus_handle_t gc1004_handle; 
#endif


static sensor_exposure_t gc1004_seInfo;
//static sensor_calibration_t gc1004_cdsp_calibration;
//static INT32U gc1004_digital_gain = 0x180; //SENSOR_GC1004
//static INT32U gc1004_analog_gain = 0x100;
static int *p_expTime_table = 0;
//static int sensor_max_ev_idx;
static gpCdspWBGain_t gc1004_wbgain;
//static INT32U sensor_format = GC1004_MIPI;


static INT8U gc1004_read_en;
extern INT32U g_cdsp_rawcal_mode;

#if CAPTURE_RAW_MODE
extern INT32U g_frame_addr1;
#endif

static gpCdspFav_t myFav;

 
static const regval8_t gc1004_reset_table[] = 
{
	{ 0x12, 0x80 },
	{ 0xFF, 0xFF }
};

static mipi_config_t gc1004_mipi_cfg =
{
	DISABLE, 			/* low power, 0:disable, 1:enable */
	D_PHY_SAMPLE_NEG, 	/* byte clock edge, 0:posedge, 1:negedge */
	NULL,				/* RSD 0 */
	NULL,				/* RSD 1 */
	
	MIPI_USER_DEFINE,	/* data mode, 0:auto detect, 1:user define */
	MIPI_RAW10,			/* data type, valid when data mode is 1*/
	MIPI_DATA_TO_CDSP,	/* data type, 1:data[7:0]+2':00 to cdsp, 0: 2'00+data[7:0] to csi */  
	NULL,				/* RSD 2 */
	
	1280+4,				/* width, 0~0xFFFF */
	720+4,				/* height, 0~0xFFFF */
	0, 					/* back porch, 0~0xF */
	8,					/* front porch, 0~0xF */
	ENABLE,				/* blanking_line_en, 0:disable, 1:enable */
	NULL,				/* RSD 3 */
	
	ENABLE,				/* ecc, 0:disable, 1:enable */
	MIPI_ECC_ORDER3,	/* ecc order */
	220,				/* data mask, unit is ns */
	MIPI_CHECK_HS_SEQ	/* check hs sequence or LP00 for clock lane */
};

static INT8U GC1004_MIPI_720P[][2] =	
{
	// SYS 
	{0xFE, 0x80}, 
	{0xFE, 0x80}, 
	{0xFE, 0x80}, 
	{0xF2, 0x00}, // sync_pad_io_ebi 
	{0xF6, 0x00}, // up down 
	{0xFC, 0xC6}, 
	{0xF7, 0x19}, // pll enable 
	{0xF8, 0x03}, // 0x03,Pll mode 2 
	{0xF9, 0x2E}, // [3]isp all clock enable [0] pll enable 
	{0xFA, 0x00}, // div 
	{0xFE, 0x00}, 

	// ANALOG & CISCTL 
	{0x03, 0x02}, //ExposureTime[15:08] 
	{0x04, 0xfa}, //ExposureTime[07:00] 

	// H-blank 
	{0x05 ,0x01}, 
	//{0x06 ,0x8f}, //0x8f 
	{0x06 ,0x70}, 

	// VB 
	{0x07 ,0x00}, 
	//{0x08 ,0x5a}, //0x30:27fps,0x5a:23fps,0x08 
	{0x08 ,0x08},

	// Win height //for expsure time 
	{0x0D ,0x02}, //height 
	{0x0E ,0xf0}, //0xf0 
	{0x0C ,0x00}, 
	// Win width 
	{0x0F ,0x05}, //width 
	{0x10 ,0x18}, //0x12 

	// Sh-delay 
	{0x11 ,0x00}, 
	{0x12 ,0x18}, //0x18 //0x1a

	{0x13, 0x10}, //0x10 St 
	{0x14, 0x04}, //0x04 Et 

	#if SENSOR_FLIP 
	{0x17, 0x17}, // [0]mirror [1]flip 
	#else 
	{0x17, 0x14}, // [0]mirror [1]flip 
	#endif 

	{0x18, 0x0A}, // sdark off 
	{0x19, 0x06}, 
	{0x1A, 0x09}, 
	{0x1B, 0x4F}, 
	{0x1C, 0x41}, //0x21
	{0x1D, 0xE0}, 

	{0x1E, 0x7C}, // The dark stripes 
	//{0x1E, 0xfC}, 

	{0x1F, 0x08}, // comv_r 
	{0x20, 0xA5}, // A vertical bar on the right 
	{0x21, 0x2F}, // rsg 
	{0x22, 0xB0}, 
	//{0x22, 0xc0}, 
	{0x23, 0x32}, 
	{0x24, 0x2F}, // PAD drive 
	{0x2A, 0x00}, 
	{0x2C, 0xC0}, 
	{0x2D, 0x0F}, 
	{0x2E, 0xf0}, 
	{0x2F, 0x1F}, // exp not work 
	{0x25, 0xC0}, 
	//{0x1F, 0x08}, //0x08->0x0F:¨¾¤î¹q¤l·¸¥X, by gc @0820 
	{0x36, 0x0b}, // exp not work 
	{0x37, 0x13}, 
	{0x38, 0x1b}, 

	// ISP 
	{0xFE, 0x00}, //Page select:0
	{0x8A, 0x00}, 
	{0x8C, 0x07},//2}, //Hsync Polarity falling 
	{0x8E, 0x02}, // luma value not normal 

	// Imagae output 
	{0x90, 0x01}, //crop en
	#if SENSOR_FLIP 
	{0x92, 0x09}, //crop y offset
	#else
	{0x92, 0x01}, //crop y offset	
	#endif
	{0x94, 0x03}, //crop x offset
	{0x95, 0x02}, 
	{0x96, 0xD8},//0xD0, by gc @0820 
	{0x97, 0x05}, 
	{0x98, 0x10}, 

	// Dark SUN 
	{0xfe, 0x02}, 
	{0x40, 0x37},
	{0x49, 0x23}, 
	{0xa4, 0x00}, 
	{0xfe, 0x00}, 

	//	 Gain  
	{0xb0, 0x50},
	{0xb3, 0x40},
	{0xb4, 0x40},
	{0xb5, 0x40},
	{0xfe, 0x00},
	  
	// MIPI 
	{0xFE, 0x03}, //Page select:3
	{0x01, 0x03}, 
	{0x02, 0x17}, //0x17;//0x77
	{0x03, 0x30}, 
	{0x04, 0x01}, 
	{0x05, 0x00}, 
	{0x06, 0xa4}, 
	{0x10, 0x80}, //0x90

	//need delay 1ms
	{0x10, 0x90}, 

	{0x11, 0x2b}, 
	{0x12, 0x54}, //RAW10 buffer[7:0] 1288=0x64a
	{0x13, 0x06}, //RAW10 buffer[15:8]
	{0x15, 0x72}, 

	{0x21, 0x08}, 
	{0x22, 0x08},

	{0x23, 0x30}, 
	{0x24, 0x02}, //0x02
	{0x25, 0x10}, 
	{0x26, 0x08},

	{0x29, 0x0a}, //0x08//0x0a

	{0xfe, 0x00},
	{0xFF, 0xFF}
};



static const sensor_calibration_t gc1004_cdsp_calibration =
{
	g_GC1004_badpix_ob_table,			//ob
	g_GC1004_LiTable_rgb,				//lincorr
	g_GC1004_StepFac,					//lenscmp1	stepfactor
	g_GC1004_MaxTan8,					//lenscmp2	MaxTan8[32]
	g_GC1004_Slope4, 					//lenscmp3	Slop4[16]
	g_GC1004_CLPoint, 					//lenscmp4	CLPoint[8]
	g_GC1004_Radius_File_0, 			//lenscmp5	Radius_File_0[512]
	g_GC1004_Radius_File_1, 			//lenscmp6	Radius_File_1[512]
	g_GC1004_r_b_gain,					//wb_gain
	g_GC1004_gamma_045_table,			//gamma1
	g_GC1004_color_matrix4gamma045,	//color_matrix1
	g_GC1004_gamma_045_table,			//gamma2
	g_GC1004_color_matrix4gamma045,	//color_matrix2
	g_GC1004_awb_thr					//awb_thr	
};

static const  int g_GC1004_exp_time_gain_50Hz[GC1004_50HZ_EXP_TIME_TOTAL_48MHz][3] =  //203,recount by u2
{ // {time, analog gain, digital gain}
{8  ,(int)(1.00*100),(int)(1.00*256)}, 
{9  ,(int)(1.00*100),(int)(1.00*256)}, 
{9  ,(int)(1.00*100),(int)(1.00*256)}, 
{9  ,(int)(1.00*100),(int)(1.00*256)}, 
{10 ,(int)(1.00*100),(int)(1.00*256)}, 
{10 ,(int)(1.00*100),(int)(1.00*256)}, 
{10 ,(int)(1.00*100),(int)(1.00*256)}, 
{11 ,(int)(1.00*100),(int)(1.00*256)}, 
{11 ,(int)(1.00*100),(int)(1.00*256)}, 
{11 ,(int)(1.00*100),(int)(1.00*256)},  //10
{12 ,(int)(1.00*100),(int)(1.00*256)}, 
{12 ,(int)(1.00*100),(int)(1.00*256)}, 
{13 ,(int)(1.00*100),(int)(1.00*256)}, 
{13 ,(int)(1.00*100),(int)(1.00*256)}, 
{14 ,(int)(1.00*100),(int)(1.00*256)}, 
{14 ,(int)(1.00*100),(int)(1.00*256)}, 
{15 ,(int)(1.00*100),(int)(1.00*256)}, 
{15 ,(int)(1.00*100),(int)(1.00*256)}, 
{16 ,(int)(1.00*100),(int)(1.00*256)}, 
{16 ,(int)(1.00*100),(int)(1.00*256)},  //20
{17 ,(int)(1.00*100),(int)(1.00*256)}, 
{17 ,(int)(1.00*100),(int)(1.00*256)}, 
{18 ,(int)(1.00*100),(int)(1.00*256)}, 
{19 ,(int)(1.00*100),(int)(1.00*256)}, 
{19 ,(int)(1.00*100),(int)(1.00*256)}, 
{20 ,(int)(1.00*100),(int)(1.00*256)}, 
{21 ,(int)(1.00*100),(int)(1.00*256)}, 
{21 ,(int)(1.00*100),(int)(1.00*256)}, 
{22 ,(int)(1.00*100),(int)(1.00*256)}, 
{23 ,(int)(1.00*100),(int)(1.00*256)}, 
{24 ,(int)(1.00*100),(int)(1.00*256)}, 
{25 ,(int)(1.00*100),(int)(1.00*256)}, 
{25 ,(int)(1.00*100),(int)(1.00*256)}, 
{26 ,(int)(1.00*100),(int)(1.00*256)}, 
{27 ,(int)(1.00*100),(int)(1.00*256)}, 
{28 ,(int)(1.00*100),(int)(1.00*256)}, 
{29 ,(int)(1.00*100),(int)(1.00*256)}, 
{30 ,(int)(1.00*100),(int)(1.00*256)}, 
{31 ,(int)(1.00*100),(int)(1.00*256)}, 
{32 ,(int)(1.00*100),(int)(1.00*256)},  //40
{34 ,(int)(1.00*100),(int)(1.00*256)}, 
{35 ,(int)(1.00*100),(int)(1.00*256)}, 
{36 ,(int)(1.00*100),(int)(1.00*256)}, 
{37 ,(int)(1.00*100),(int)(1.00*256)}, 
{39 ,(int)(1.00*100),(int)(1.00*256)}, 
{40 ,(int)(1.00*100),(int)(1.00*256)}, 
{41 ,(int)(1.00*100),(int)(1.00*256)}, 
{43 ,(int)(1.00*100),(int)(1.00*256)}, 
{44 ,(int)(1.00*100),(int)(1.00*256)}, 
{46 ,(int)(1.00*100),(int)(1.00*256)}, 
{48 ,(int)(1.00*100),(int)(1.00*256)}, 
{49 ,(int)(1.00*100),(int)(1.00*256)}, 
{51 ,(int)(1.00*100),(int)(1.00*256)}, 
{53 ,(int)(1.00*100),(int)(1.00*256)}, 
{55 ,(int)(1.00*100),(int)(1.00*256)}, 
{57 ,(int)(1.00*100),(int)(1.00*256)}, 
{58 ,(int)(1.00*100),(int)(1.00*256)}, 
{61 ,(int)(1.00*100),(int)(1.00*256)}, 
{63 ,(int)(1.00*100),(int)(1.00*256)}, 
{65 ,(int)(1.00*100),(int)(1.00*256)},  //60
{67 ,(int)(1.00*100),(int)(1.00*256)}, 
{70 ,(int)(1.00*100),(int)(1.00*256)}, 
{72 ,(int)(1.00*100),(int)(1.00*256)}, 
{75 ,(int)(1.00*100),(int)(1.00*256)}, 
{77 ,(int)(1.00*100),(int)(1.00*256)}, 
{80 ,(int)(1.00*100),(int)(1.00*256)}, 
{83 ,(int)(1.00*100),(int)(1.00*256)}, 
{86 ,(int)(1.00*100),(int)(1.00*256)}, 
{89 ,(int)(1.00*100),(int)(1.00*256)}, 
{92 ,(int)(1.00*100),(int)(1.00*256)}, 
{95 ,(int)(1.00*100),(int)(1.00*256)}, 
{98 ,(int)(1.00*100),(int)(1.00*256)}, 
{102,(int)(1.00*100),(int)(1.00*256)}, 
{105,(int)(1.00*100),(int)(1.00*256)}, 
{109,(int)(1.00*100),(int)(1.00*256)}, 
{113,(int)(1.00*100),(int)(1.00*256)}, 
{117,(int)(1.00*100),(int)(1.00*256)}, 
{121,(int)(1.00*100),(int)(1.00*256)}, 
{125,(int)(1.00*100),(int)(1.00*256)}, 
{130,(int)(1.00*100),(int)(1.00*256)},  //80
{134,(int)(1.00*100),(int)(1.00*256)}, 
{139,(int)(1.00*100),(int)(1.00*256)}, 
{144,(int)(1.00*100),(int)(1.00*256)}, 
{149,(int)(1.00*100),(int)(1.00*256)}, 
{154,(int)(1.00*100),(int)(1.00*256)}, 
{160,(int)(1.00*100),(int)(1.00*256)}, 
{165,(int)(1.00*100),(int)(1.00*256)}, 
{171,(int)(1.00*100),(int)(1.00*256)}, 
{177,(int)(1.00*100),(int)(1.00*256)},  
{184,(int)(1.00*100),(int)(1.00*256)},  //90
{190,(int)(1.00*100),(int)(1.00*256)}, 
{197,(int)(1.00*100),(int)(1.00*256)}, 
{204,(int)(1.00*100),(int)(1.00*256)}, 
{211,(int)(1.00*100),(int)(1.00*256)}, 
{218,(int)(1.00*100),(int)(1.00*256)}, 
// 10ms            
{226,(int)(1.00*100),(int)(1.00*256)},  //96,daylight
{226,(int)(1.04*100),(int)(1.00*256)}, 
{226,(int)(1.06*100),(int)(1.00*256)}, 
{226,(int)(1.11*100),(int)(1.00*256)}, 
{226,(int)(1.15*100),(int)(1.00*256)},  //100
{226,(int)(1.19*100),(int)(1.00*256)}, 
{226,(int)(1.23*100),(int)(1.00*256)}, 
{226,(int)(1.27*100),(int)(1.00*256)}, 
{226,(int)(1.31*100),(int)(1.00*256)}, 
{226,(int)(1.37*100),(int)(1.00*256)}, 
{226,(int)(1.41*100),(int)(1.00*256)}, 
{226,(int)(1.46*100),(int)(1.00*256)}, 
{226,(int)(1.52*100),(int)(1.00*256)}, 
{226,(int)(1.57*100),(int)(1.00*256)}, 
{226,(int)(1.62*100),(int)(1.00*256)},  //110
{226,(int)(1.68*100),(int)(1.00*256)}, 
{226,(int)(1.74*100),(int)(1.00*256)}, 
{226,(int)(1.80*100),(int)(1.00*256)},  
//20 ms
{452,(int)(1.00*100),(int)(1.00*256)}, 
{452,(int)(1.04*100),(int)(1.00*256)}, 
{452,(int)(1.06*100),(int)(1.00*256)}, 
{452,(int)(1.11*100),(int)(1.00*256)}, 
{452,(int)(1.15*100),(int)(1.00*256)}, 
{452,(int)(1.19*100),(int)(1.00*256)}, 
{452,(int)(1.23*100),(int)(1.00*256)}, //120
{452,(int)(1.27*100),(int)(1.00*256)}, 
{452,(int)(1.31*100),(int)(1.00*256)}, 
{452,(int)(1.37*100),(int)(1.00*256)}, 
{452,(int)(1.41*100),(int)(1.00*256)}, 
{452,(int)(1.46*100),(int)(1.00*256)}, 
{452,(int)(1.52*100),(int)(1.00*256)}, 
{452,(int)(1.57*100),(int)(1.00*256)}, 
{452,(int)(1.62*100),(int)(1.00*256)}, 
{452,(int)(1.68*100),(int)(1.00*256)},  
{452,(int)(1.74*100),(int)(1.00*256)}, //130
{452,(int)(1.80*100),(int)(1.00*256)}, 
{452,(int)(1.87*100),(int)(1.00*256)}, 
{452,(int)(1.93*100),(int)(1.00*256)},
{452,(int)(2.00*100),(int)(1.00*256)}, 
//30 ms
{678,(int)(1.48*100),(int)(1.00*256)}, 
{678,(int)(1.54*100),(int)(1.00*256)}, 
{678,(int)(1.60*100),(int)(1.00*256)}, 
{678,(int)(1.76*100),(int)(1.00*256)}, 
{678,(int)(1.82*100),(int)(1.00*256)}, 
{678,(int)(1.88*100),(int)(1.00*256)},  //140
{678,(int)(1.94*100),(int)(1.00*256)}, 
{678,(int)(2.00*100),(int)(1.00*256)}, 
{678,(int)(2.06*100),(int)(1.00*256)}, 
{678,(int)(2.12*100),(int)(1.00*256)}, 
{678,(int)(2.18*100),(int)(1.00*256)}, 
{678,(int)(2.24*100),(int)(1.00*256)},  
{678,(int)(2.30*100),(int)(1.00*256)}, 
{678,(int)(2.36*100),(int)(1.00*256)}, 
//40ms
{904,(int)(1.83*100),(int)(1.00*256)}, 
{904,(int)(1.89*100),(int)(1.00*256)},  //150
{904,(int)(1.95*100),(int)(1.00*256)}, 
{904,(int)(2.01*100),(int)(1.00*256)},
{904,(int)(2.07*100),(int)(1.00*256)}, 
{904,(int)(2.14*100),(int)(1.00*256)}, 
{904,(int)(2.22*100),(int)(1.00*256)}, 
{904,(int)(2.30*100),(int)(1.00*256)}, 
{904,(int)(2.38*100),(int)(1.00*256)}, 
{904,(int)(2.46*100),(int)(1.00*256)}, 
{904,(int)(2.55*100),(int)(1.00*256)}, 
{904,(int)(2.64*100),(int)(1.00*256)},  //160
{904,(int)(2.73*100),(int)(1.00*256)}, 
{904,(int)(2.83*100),(int)(1.00*256)}, 
{904,(int)(2.93*100),(int)(1.00*256)}, 
{904,(int)(3.03*100),(int)(1.00*256)}, 
{904,(int)(3.14*100),(int)(1.00*256)}, 
{904,(int)(3.25*100),(int)(1.00*256)}, 
{904,(int)(3.36*100),(int)(1.00*256)}, 
{904,(int)(3.48*100),(int)(1.00*256)}, 
{904,(int)(3.61*100),(int)(1.00*256)}, 
{904,(int)(3.73*100),(int)(1.00*256)}, //170
{904,(int)(3.86*100),(int)(1.00*256)}, 
{904,(int)(4.00*100),(int)(1.00*256)},   // GC_BLK night
{904,(int)(4.14*100),(int)(1.00*256)}, 
{904,(int)(4.29*100),(int)(1.00*256)}, 
{904,(int)(4.44*100),(int)(1.00*256)}, 
{904,(int)(4.59*100),(int)(1.00*256)}, 
{904,(int)(4.76*100),(int)(1.00*256)}, 
{904,(int)(4.92*100),(int)(1.00*256)}, 
{904,(int)(5.10*100),(int)(1.00*256)}, 
{904,(int)(5.28*100),(int)(1.00*256)}, //180 
{904,(int)(5.46*100),(int)(1.00*256)}, 
{904,(int)(5.66*100),(int)(1.00*256)}, 
{904,(int)(5.86*100),(int)(1.00*256)}, 
{904,(int)(6.06*100),(int)(1.00*256)}, 
{904,(int)(6.28*100),(int)(1.00*256)}, 
{904,(int)(6.50*100),(int)(1.00*256)}, 
{904,(int)(6.73*100),(int)(1.00*256)}, 
{904,(int)(6.96*100),(int)(1.00*256)}, 
{904,(int)(7.21*100),(int)(1.00*256)}, //189
{904,(int)(7.46*100),(int)(1.00*256)}, //190 
{904,(int)(7.73*100),(int)(1.00*256)}, 
{904,(int)(8.00*100),(int)(1.00*256)}, 
{904,(int)(8.28*100),(int)(1.00*256)}, 
{904,(int)(8.57*100),(int)(1.00*256)}, 
{904,(int)(8.88*100),(int)(1.00*256)}, 
{904,(int)(9.19*100),(int)(1.00*256)}, 
{904,(int)(9.51*100),(int)(1.00*256)}, 
{904,(int)(9.85*100),(int)(1.00*256)}, 
{904,(int)(9.91*100),(int)(1.00*256)}, 
{904,(int)(9.97*100),(int)(1.00*256)}, //200
{904,(int)(10.03*100),(int)(1.00*256)}, 
{904,(int)(10.09*100),(int)(1.00*256)},  
{904,(int)(10.15*100),(int)(1.00*256)} 
};

static const  int g_GC1004_exp_time_gain_60Hz[GC1004_60HZ_EXP_TIME_TOTAL_48MHz][3] = 
{ // {time, analog gain, digital gain}
{8	,(int)(1.00*100), (int)(1.00*256)},
{9	,(int)(1.00*100), (int)(1.00*256)},
{9	,(int)(1.00*100), (int)(1.00*256)},
{9	,(int)(1.00*100), (int)(1.00*256)},
{10	,(int)(1.00*100), (int)(1.00*256)},
{10	,(int)(1.00*100), (int)(1.00*256)},
{10	,(int)(1.00*100), (int)(1.00*256)},
{11	,(int)(1.00*100), (int)(1.00*256)},
{11	,(int)(1.00*100), (int)(1.00*256)},
{11	,(int)(1.00*100), (int)(1.00*256)},//10
{12	,(int)(1.00*100), (int)(1.00*256)},
{12	,(int)(1.00*100), (int)(1.00*256)},
{13	,(int)(1.00*100), (int)(1.00*256)},
{13	,(int)(1.00*100), (int)(1.00*256)},
{13	,(int)(1.00*100), (int)(1.00*256)},
{14	,(int)(1.00*100), (int)(1.00*256)},
{14	,(int)(1.00*100), (int)(1.00*256)},
{15	,(int)(1.00*100), (int)(1.00*256)},
{16	,(int)(1.00*100), (int)(1.00*256)},
{16	,(int)(1.00*100), (int)(1.00*256)},//20
{17	,(int)(1.00*100), (int)(1.00*256)},
{17	,(int)(1.00*100), (int)(1.00*256)},
{18	,(int)(1.00*100), (int)(1.00*256)},
{18	,(int)(1.00*100), (int)(1.00*256)},
{19	,(int)(1.00*100), (int)(1.00*256)},
{20	,(int)(1.00*100), (int)(1.00*256)},
{20	,(int)(1.00*100), (int)(1.00*256)},
{21	,(int)(1.00*100), (int)(1.00*256)},
{22	,(int)(1.00*100), (int)(1.00*256)},
{23	,(int)(1.00*100), (int)(1.00*256)},//30
{24	,(int)(1.00*100), (int)(1.00*256)},
{24	,(int)(1.00*100), (int)(1.00*256)},
{25	,(int)(1.00*100), (int)(1.00*256)},
{26	,(int)(1.00*100), (int)(1.00*256)},
{27	,(int)(1.00*100), (int)(1.00*256)},
{28	,(int)(1.00*100), (int)(1.00*256)},
{29	,(int)(1.00*100), (int)(1.00*256)},
{30	,(int)(1.00*100), (int)(1.00*256)},
{31	,(int)(1.00*100), (int)(1.00*256)},
{32	,(int)(1.00*100), (int)(1.00*256)},//40
{33	,(int)(1.00*100), (int)(1.00*256)},
{34	,(int)(1.00*100), (int)(1.00*256)},
{36	,(int)(1.00*100), (int)(1.00*256)},
{37	,(int)(1.00*100), (int)(1.00*256)},
{38	,(int)(1.00*100), (int)(1.00*256)},
{40	,(int)(1.00*100), (int)(1.00*256)},
{41	,(int)(1.00*100), (int)(1.00*256)},
{42	,(int)(1.00*100), (int)(1.00*256)},
{44	,(int)(1.00*100), (int)(1.00*256)},
{45	,(int)(1.00*100), (int)(1.00*256)},//50
{47	,(int)(1.00*100), (int)(1.00*256)},
{49	,(int)(1.00*100), (int)(1.00*256)},
{50	,(int)(1.00*100), (int)(1.00*256)},
{52	,(int)(1.00*100), (int)(1.00*256)},
{54	,(int)(1.00*100), (int)(1.00*256)},
{56	,(int)(1.00*100), (int)(1.00*256)},
{58	,(int)(1.00*100), (int)(1.00*256)},
{60	,(int)(1.00*100), (int)(1.00*256)},
{62	,(int)(1.00*100), (int)(1.00*256)},
{64	,(int)(1.00*100), (int)(1.00*256)},//60
{66	,(int)(1.00*100), (int)(1.00*256)},
{69	,(int)(1.00*100), (int)(1.00*256)},
{71	,(int)(1.00*100), (int)(1.00*256)},
{74	,(int)(1.00*100), (int)(1.00*256)},
{76	,(int)(1.00*100), (int)(1.00*256)},
{79	,(int)(1.00*100), (int)(1.00*256)},
{82	,(int)(1.00*100), (int)(1.00*256)},
{85	,(int)(1.00*100), (int)(1.00*256)},
{88	,(int)(1.00*100), (int)(1.00*256)},
{91	,(int)(1.00*100), (int)(1.00*256)},//70
{94	,(int)(1.00*100), (int)(1.00*256)},
{97	,(int)(1.00*100), (int)(1.00*256)},
{101,(int)(1.00*100), (int)(1.00*256)},
{104,(int)(1.00*100), (int)(1.00*256)},
{108,(int)(1.00*100), (int)(1.00*256)},
{112,(int)(1.00*100), (int)(1.00*256)},
{116,(int)(1.00*100), (int)(1.00*256)},
{120,(int)(1.00*100), (int)(1.00*256)},
{124,(int)(1.00*100), (int)(1.00*256)},
{128,(int)(1.00*100), (int)(1.00*256)},//80
{133,(int)(1.00*100), (int)(1.00*256)},
{138,(int)(1.00*100), (int)(1.00*256)},
{142,(int)(1.00*100), (int)(1.00*256)},
{148,(int)(1.00*100), (int)(1.00*256)},
{153,(int)(1.00*100), (int)(1.00*256)},
{158,(int)(1.00*100), (int)(1.00*256)},
{164,(int)(1.00*100), (int)(1.00*256)},
{169,(int)(1.00*100), (int)(1.00*256)},
{175,(int)(1.00*100), (int)(1.00*256)},
{182,(int)(1.00*100), (int)(1.00*256)},//90
{188,(int)(1.00*100), (int)(1.00*256)},
{188,(int)(1.04*100), (int)(1.00*256)},
{188,(int)(1.06*100), (int)(1.00*256)},
{188,(int)(1.11*100), (int)(1.00*256)},
{188,(int)(1.15*100), (int)(1.00*256)},//95,daylight
{188,(int)(1.19*100), (int)(1.00*256)},
{188,(int)(1.23*100), (int)(1.00*256)},
{188,(int)(1.27*100), (int)(1.00*256)},
{188,(int)(1.31*100), (int)(1.00*256)},
{188,(int)(1.37*100), (int)(1.00*256)},//100
{188,(int)(1.41*100), (int)(1.00*256)},
{188,(int)(1.46*100), (int)(1.00*256)},
{188,(int)(1.52*100), (int)(1.00*256)},
{188,(int)(1.57*100), (int)(1.00*256)},
{188,(int)(1.62*100), (int)(1.00*256)},
{188,(int)(1.68*100), (int)(1.00*256)},
{188,(int)(1.74*100), (int)(1.00*256)},
{210,(int)(1.68*100), (int)(1.00*256)},
{220,(int)(1.65*100), (int)(1.00*256)},
{250,(int)(1.50*100), (int)(1.00*256)},//110
{280,(int)(1.40*100), (int)(1.00*256)},
{310,(int)(1.30*100), (int)(1.00*256)},
{340,(int)(1.23*100), (int)(1.00*256)},
{376,(int)(1.11*100), (int)(1.00*256)},
{376,(int)(1.15*100), (int)(1.00*256)},
{376,(int)(1.19*100), (int)(1.00*256)},
{376,(int)(1.23*100), (int)(1.00*256)},
{376,(int)(1.27*100), (int)(1.00*256)},
{376,(int)(1.31*100), (int)(1.00*256)},
{376,(int)(1.37*100), (int)(1.00*256)},//120
{376,(int)(1.41*100), (int)(1.00*256)},
{376,(int)(1.46*100), (int)(1.00*256)},//121,init
{376,(int)(1.52*100), (int)(1.00*256)},
{376,(int)(1.57*100), (int)(1.00*256)},
{376,(int)(1.62*100), (int)(1.00*256)},
{376,(int)(1.68*100), (int)(1.00*256)},
{376,(int)(1.74*100), (int)(1.00*256)},
{376,(int)(1.80*100), (int)(1.00*256)},
{406,(int)(1.73*100), (int)(1.00*256)},
{440,(int)(1.65*100), (int)(1.00*256)},//130
{475,(int)(1.57*100), (int)(1.00*256)},//
{516,(int)(1.50*100), (int)(1.00*256)},
{546,(int)(1.46*100), (int)(1.00*256)},
{564,(int)(1.46*100), (int)(1.00*256)},
{564,(int)(1.52*100), (int)(1.00*256)},
{564,(int)(1.57*100), (int)(1.00*256)},
{564,(int)(1.62*100), (int)(1.00*256)},
{564,(int)(1.68*100), (int)(1.00*256)},
{564,(int)(1.74*100), (int)(1.00*256)},
{564,(int)(1.80*100), (int)(1.00*256)},//140
{600,(int)(1.76*100), (int)(1.00*256)},
{630,(int)(1.74*100), (int)(1.00*256)},
{670,(int)(1.71*100), (int)(1.00*256)},
{700,(int)(1.69*100), (int)(1.00*256)},
{752,(int)(1.62*100), (int)(1.00*256)},
{752,(int)(1.68*100), (int)(1.00*256)},
{752,(int)(1.74*100), (int)(1.00*256)},
{752,(int)(1.80*100), (int)(1.00*256)},
{752,(int)(1.87*100), (int)(1.00*256)},
{752,(int)(1.93*100), (int)(1.00*256)},//150, night
{752,(int)(2.00*100), (int)(1.00*256)},
{752,(int)(2.07*100), (int)(1.00*256)},
{752,(int)(2.14*100), (int)(1.00*256)},
{752,(int)(2.22*100), (int)(1.00*256)},
{752,(int)(2.30*100), (int)(1.00*256)},
{752,(int)(2.38*100), (int)(1.00*256)},
{752,(int)(2.46*100), (int)(1.00*256)},
{752,(int)(2.55*100), (int)(1.00*256)},
{752,(int)(2.64*100), (int)(1.00*256)},
{752,(int)(2.73*100), (int)(1.00*256)},//160
{752,(int)(2.83*100), (int)(1.00*256)},
{752,(int)(2.93*100), (int)(1.00*256)},
{752,(int)(3.03*100), (int)(1.00*256)},
{752,(int)(3.14*100), (int)(1.00*256)},
{752,(int)(3.25*100), (int)(1.00*256)},
{752,(int)(3.36*100), (int)(1.00*256)},
{752,(int)(3.48*100), (int)(1.00*256)},
{752,(int)(3.61*100), (int)(1.00*256)},
{752,(int)(3.73*100), (int)(1.00*256)},
{752,(int)(3.86*100), (int)(1.00*256)},//170
{752,(int)(4.00*100), (int)(1.00*256)},
{752,(int)(4.14*100), (int)(1.00*256)},
{752,(int)(4.29*100), (int)(1.00*256)},
{752,(int)(4.44*100), (int)(1.00*256)},
{752,(int)(4.59*100), (int)(1.00*256)},
{752,(int)(4.76*100), (int)(1.00*256)},
{752,(int)(4.92*100), (int)(1.00*256)},
{752,(int)(5.10*100), (int)(1.00*256)},
{752,(int)(5.28*100), (int)(1.00*256)},
{752,(int)(5.46*100), (int)(1.00*256)},//180
{752,(int)(5.66*100), (int)(1.00*256)},
{752,(int)(5.86*100), (int)(1.00*256)},
{752,(int)(6.06*100), (int)(1.00*256)},
{752,(int)(6.28*100), (int)(1.00*256)},
{752,(int)(6.50*100), (int)(1.00*256)},
{752,(int)(6.73*100), (int)(1.00*256)},
{752,(int)(6.96*100), (int)(1.00*256)},
{752,(int)(7.21*100), (int)(1.00*256)},
{752,(int)(7.46*100), (int)(1.00*256)},

{752,(int)(7.73*100), (int)(1.00*256)},//190
{752,(int)(8.00*100), (int)(1.00*256)},
{752,(int)(8.28*100), (int)(1.00*256)},
{752,(int)(8.57*100), (int)(1.00*256)},
{752,(int)(8.88*100), (int)(1.00*256)},
{752,(int)(9.19*100), (int)(1.00*256)},
{752,(int)(9.51*100), (int)(1.00*256)},
{752,(int)(9.85*100), (int)(1.00*256)}
};

//#elif (GC_PCLK == GC_48MHZ)	//48Mhz 30fps

static const  int g_GC1004_exp_time_gain_50Hz_48MHz[GC1004_50HZ_EXP_TIME_TOTAL_48MHz][3] =  //203,recount by u2
{ // {time, analog gain, digital gain}
{8  ,(int)(1.00*100),(int)(1.00*256)}, 
{9  ,(int)(1.00*100),(int)(1.00*256)}, 
{9  ,(int)(1.00*100),(int)(1.00*256)}, 
{9  ,(int)(1.00*100),(int)(1.00*256)}, 
{10 ,(int)(1.00*100),(int)(1.00*256)}, 
{10 ,(int)(1.00*100),(int)(1.00*256)}, 
{10 ,(int)(1.00*100),(int)(1.00*256)}, 
{11 ,(int)(1.00*100),(int)(1.00*256)}, 
{11 ,(int)(1.00*100),(int)(1.00*256)}, 
{11 ,(int)(1.00*100),(int)(1.00*256)},  //10
{12 ,(int)(1.00*100),(int)(1.00*256)}, 
{12 ,(int)(1.00*100),(int)(1.00*256)}, 
{13 ,(int)(1.00*100),(int)(1.00*256)}, 
{13 ,(int)(1.00*100),(int)(1.00*256)}, 
{14 ,(int)(1.00*100),(int)(1.00*256)}, 
{14 ,(int)(1.00*100),(int)(1.00*256)}, 
{15 ,(int)(1.00*100),(int)(1.00*256)}, 
{15 ,(int)(1.00*100),(int)(1.00*256)}, 
{16 ,(int)(1.00*100),(int)(1.00*256)}, 
{16 ,(int)(1.00*100),(int)(1.00*256)},  //20
{17 ,(int)(1.00*100),(int)(1.00*256)}, 
{17 ,(int)(1.00*100),(int)(1.00*256)}, 
{18 ,(int)(1.00*100),(int)(1.00*256)}, 
{19 ,(int)(1.00*100),(int)(1.00*256)}, 
{19 ,(int)(1.00*100),(int)(1.00*256)}, 
{20 ,(int)(1.00*100),(int)(1.00*256)}, 
{21 ,(int)(1.00*100),(int)(1.00*256)}, 
{21 ,(int)(1.00*100),(int)(1.00*256)}, 
{22 ,(int)(1.00*100),(int)(1.00*256)}, 
{23 ,(int)(1.00*100),(int)(1.00*256)}, 
{24 ,(int)(1.00*100),(int)(1.00*256)}, 
{25 ,(int)(1.00*100),(int)(1.00*256)}, 
{25 ,(int)(1.00*100),(int)(1.00*256)}, 
{26 ,(int)(1.00*100),(int)(1.00*256)}, 
{27 ,(int)(1.00*100),(int)(1.00*256)}, 
{28 ,(int)(1.00*100),(int)(1.00*256)}, 
{29 ,(int)(1.00*100),(int)(1.00*256)}, 
{30 ,(int)(1.00*100),(int)(1.00*256)}, 
{31 ,(int)(1.00*100),(int)(1.00*256)}, 
{32 ,(int)(1.00*100),(int)(1.00*256)},  //40
{34 ,(int)(1.00*100),(int)(1.00*256)}, 
{35 ,(int)(1.00*100),(int)(1.00*256)}, 
{36 ,(int)(1.00*100),(int)(1.00*256)}, 
{37 ,(int)(1.00*100),(int)(1.00*256)}, 
{39 ,(int)(1.00*100),(int)(1.00*256)}, 
{40 ,(int)(1.00*100),(int)(1.00*256)}, 
{41 ,(int)(1.00*100),(int)(1.00*256)}, 
{43 ,(int)(1.00*100),(int)(1.00*256)}, 
{44 ,(int)(1.00*100),(int)(1.00*256)}, 
{46 ,(int)(1.00*100),(int)(1.00*256)}, 
{48 ,(int)(1.00*100),(int)(1.00*256)}, 
{49 ,(int)(1.00*100),(int)(1.00*256)}, 
{51 ,(int)(1.00*100),(int)(1.00*256)}, 
{53 ,(int)(1.00*100),(int)(1.00*256)}, 
{55 ,(int)(1.00*100),(int)(1.00*256)}, 
{57 ,(int)(1.00*100),(int)(1.00*256)}, 
{58 ,(int)(1.00*100),(int)(1.00*256)}, 
{61 ,(int)(1.00*100),(int)(1.00*256)}, 
{63 ,(int)(1.00*100),(int)(1.00*256)}, 
{65 ,(int)(1.00*100),(int)(1.00*256)},  //60
{67 ,(int)(1.00*100),(int)(1.00*256)}, 
{70 ,(int)(1.00*100),(int)(1.00*256)}, 
{72 ,(int)(1.00*100),(int)(1.00*256)}, 
{75 ,(int)(1.00*100),(int)(1.00*256)}, 
{77 ,(int)(1.00*100),(int)(1.00*256)}, 
{80 ,(int)(1.00*100),(int)(1.00*256)}, 
{83 ,(int)(1.00*100),(int)(1.00*256)}, 
{86 ,(int)(1.00*100),(int)(1.00*256)}, 
{89 ,(int)(1.00*100),(int)(1.00*256)}, 
{92 ,(int)(1.00*100),(int)(1.00*256)}, 
{95 ,(int)(1.00*100),(int)(1.00*256)}, 
{98 ,(int)(1.00*100),(int)(1.00*256)}, 
{102,(int)(1.00*100),(int)(1.00*256)}, 
{105,(int)(1.00*100),(int)(1.00*256)}, 
{109,(int)(1.00*100),(int)(1.00*256)}, 
{113,(int)(1.00*100),(int)(1.00*256)}, 
{117,(int)(1.00*100),(int)(1.00*256)}, 
{121,(int)(1.00*100),(int)(1.00*256)}, 
{125,(int)(1.00*100),(int)(1.00*256)}, 
{130,(int)(1.00*100),(int)(1.00*256)},  //80
{134,(int)(1.00*100),(int)(1.00*256)}, 
{139,(int)(1.00*100),(int)(1.00*256)}, 
{144,(int)(1.00*100),(int)(1.00*256)}, 
{149,(int)(1.00*100),(int)(1.00*256)}, 
{154,(int)(1.00*100),(int)(1.00*256)}, 
{160,(int)(1.00*100),(int)(1.00*256)}, 
{165,(int)(1.00*100),(int)(1.00*256)}, 
{171,(int)(1.00*100),(int)(1.00*256)}, 
{177,(int)(1.00*100),(int)(1.00*256)},  
{184,(int)(1.00*100),(int)(1.00*256)},  //90
{190,(int)(1.00*100),(int)(1.00*256)}, 
{197,(int)(1.00*100),(int)(1.00*256)}, 
{204,(int)(1.00*100),(int)(1.00*256)}, 
{211,(int)(1.00*100),(int)(1.00*256)}, 
{218,(int)(1.00*100),(int)(1.00*256)}, 
// 10ms            
{226,(int)(1.00*100),(int)(1.00*256)},  //96,daylight
{226,(int)(1.04*100),(int)(1.00*256)}, 
{226,(int)(1.06*100),(int)(1.00*256)}, 
{226,(int)(1.11*100),(int)(1.00*256)}, 
{226,(int)(1.15*100),(int)(1.00*256)},  //100
{226,(int)(1.19*100),(int)(1.00*256)}, 
{226,(int)(1.23*100),(int)(1.00*256)}, 
{226,(int)(1.27*100),(int)(1.00*256)}, 
{226,(int)(1.31*100),(int)(1.00*256)}, 
{226,(int)(1.37*100),(int)(1.00*256)}, 
{226,(int)(1.41*100),(int)(1.00*256)}, 
{226,(int)(1.46*100),(int)(1.00*256)}, 
{226,(int)(1.52*100),(int)(1.00*256)}, 
{226,(int)(1.57*100),(int)(1.00*256)}, 
{226,(int)(1.62*100),(int)(1.00*256)},  //110
{226,(int)(1.68*100),(int)(1.00*256)}, 
{226,(int)(1.74*100),(int)(1.00*256)}, 
{226,(int)(1.80*100),(int)(1.00*256)},  
//20 ms
{452,(int)(1.00*100),(int)(1.00*256)}, 
{452,(int)(1.04*100),(int)(1.00*256)}, 
{452,(int)(1.06*100),(int)(1.00*256)}, 
{452,(int)(1.11*100),(int)(1.00*256)}, 
{452,(int)(1.15*100),(int)(1.00*256)}, 
{452,(int)(1.19*100),(int)(1.00*256)}, 
{452,(int)(1.23*100),(int)(1.00*256)}, //120
{452,(int)(1.27*100),(int)(1.00*256)}, 
{452,(int)(1.31*100),(int)(1.00*256)}, 
{452,(int)(1.37*100),(int)(1.00*256)}, 
{452,(int)(1.41*100),(int)(1.00*256)}, 
{452,(int)(1.46*100),(int)(1.00*256)}, 
{452,(int)(1.52*100),(int)(1.00*256)}, 
{452,(int)(1.57*100),(int)(1.00*256)}, 
{452,(int)(1.62*100),(int)(1.00*256)}, 
{452,(int)(1.68*100),(int)(1.00*256)},  
{452,(int)(1.74*100),(int)(1.00*256)}, //130
{452,(int)(1.80*100),(int)(1.00*256)}, 
{452,(int)(1.87*100),(int)(1.00*256)}, 
{452,(int)(1.93*100),(int)(1.00*256)},
{452,(int)(2.00*100),(int)(1.00*256)}, 
//30 ms
{678,(int)(1.48*100),(int)(1.00*256)}, 
{678,(int)(1.54*100),(int)(1.00*256)}, 
{678,(int)(1.60*100),(int)(1.00*256)}, 
{678,(int)(1.76*100),(int)(1.00*256)}, 
{678,(int)(1.82*100),(int)(1.00*256)}, 
{678,(int)(1.88*100),(int)(1.00*256)},  //140
{678,(int)(1.94*100),(int)(1.00*256)}, 
{678,(int)(2.00*100),(int)(1.00*256)}, 
{678,(int)(2.06*100),(int)(1.00*256)}, 
{678,(int)(2.12*100),(int)(1.00*256)}, 
{678,(int)(2.18*100),(int)(1.00*256)}, 
{678,(int)(2.24*100),(int)(1.00*256)},  
{678,(int)(2.30*100),(int)(1.00*256)}, 
{678,(int)(2.36*100),(int)(1.00*256)}, 
//40ms
{904,(int)(1.83*100),(int)(1.00*256)}, 
{904,(int)(1.89*100),(int)(1.00*256)},  //150
{904,(int)(1.95*100),(int)(1.00*256)}, 
{904,(int)(2.01*100),(int)(1.00*256)},
{904,(int)(2.07*100),(int)(1.00*256)}, 
{904,(int)(2.14*100),(int)(1.00*256)}, 
{904,(int)(2.22*100),(int)(1.00*256)}, 
{904,(int)(2.30*100),(int)(1.00*256)}, 
{904,(int)(2.38*100),(int)(1.00*256)}, 
{904,(int)(2.46*100),(int)(1.00*256)}, 
{904,(int)(2.55*100),(int)(1.00*256)}, 
{904,(int)(2.64*100),(int)(1.00*256)},  //160
{904,(int)(2.73*100),(int)(1.00*256)}, 
{904,(int)(2.83*100),(int)(1.00*256)}, 
{904,(int)(2.93*100),(int)(1.00*256)}, 
{904,(int)(3.03*100),(int)(1.00*256)}, 
{904,(int)(3.14*100),(int)(1.00*256)}, 
{904,(int)(3.25*100),(int)(1.00*256)}, 
{904,(int)(3.36*100),(int)(1.00*256)}, 
{904,(int)(3.48*100),(int)(1.00*256)}, 
{904,(int)(3.61*100),(int)(1.00*256)}, 
{904,(int)(3.73*100),(int)(1.00*256)}, //170
{904,(int)(3.86*100),(int)(1.00*256)}, 
{904,(int)(4.00*100),(int)(1.00*256)},   // GC_BLK night
{904,(int)(4.14*100),(int)(1.00*256)}, 
{904,(int)(4.29*100),(int)(1.00*256)}, 
{904,(int)(4.44*100),(int)(1.00*256)}, 
{904,(int)(4.59*100),(int)(1.00*256)}, 
{904,(int)(4.76*100),(int)(1.00*256)}, 
{904,(int)(4.92*100),(int)(1.00*256)}, 
{904,(int)(5.10*100),(int)(1.00*256)}, 
{904,(int)(5.28*100),(int)(1.00*256)}, //180 
{904,(int)(5.46*100),(int)(1.00*256)}, 
{904,(int)(5.66*100),(int)(1.00*256)}, 
{904,(int)(5.86*100),(int)(1.00*256)}, 
{904,(int)(6.06*100),(int)(1.00*256)}, 
{904,(int)(6.28*100),(int)(1.00*256)}, 
{904,(int)(6.50*100),(int)(1.00*256)}, 
{904,(int)(6.73*100),(int)(1.00*256)}, 
{904,(int)(6.96*100),(int)(1.00*256)}, 
{904,(int)(7.21*100),(int)(1.00*256)}, //189
{904,(int)(7.46*100),(int)(1.00*256)}, //190 
{904,(int)(7.73*100),(int)(1.00*256)}, 
{904,(int)(8.00*100),(int)(1.00*256)}, 
{904,(int)(8.28*100),(int)(1.00*256)}, 
{904,(int)(8.57*100),(int)(1.00*256)}, 
{904,(int)(8.88*100),(int)(1.00*256)}, 
{904,(int)(9.19*100),(int)(1.00*256)}, 
{904,(int)(9.51*100),(int)(1.00*256)}, 
{904,(int)(9.85*100),(int)(1.00*256)}, 
{904,(int)(9.91*100),(int)(1.00*256)}, 
{904,(int)(9.97*100),(int)(1.00*256)}, //200
{904,(int)(10.03*100),(int)(1.00*256)}, 
{904,(int)(10.09*100),(int)(1.00*256)},  
{904,(int)(10.15*100),(int)(1.00*256)}
}; 

static const  int g_GC1004_exp_time_gain_60Hz_48MHz[GC1004_60HZ_EXP_TIME_TOTAL_48MHz][3] = 
{ // {time, analog gain, digital gain}
{8	,(int)(1.00*100), (int)(1.00*256)},
{9	,(int)(1.00*100), (int)(1.00*256)},
{9	,(int)(1.00*100), (int)(1.00*256)},
{9	,(int)(1.00*100), (int)(1.00*256)},
{10	,(int)(1.00*100), (int)(1.00*256)},
{10	,(int)(1.00*100), (int)(1.00*256)},
{10	,(int)(1.00*100), (int)(1.00*256)},
{11	,(int)(1.00*100), (int)(1.00*256)},
{11	,(int)(1.00*100), (int)(1.00*256)},
{11	,(int)(1.00*100), (int)(1.00*256)},//10
{12	,(int)(1.00*100), (int)(1.00*256)},
{12	,(int)(1.00*100), (int)(1.00*256)},
{13	,(int)(1.00*100), (int)(1.00*256)},
{13	,(int)(1.00*100), (int)(1.00*256)},
{13	,(int)(1.00*100), (int)(1.00*256)},
{14	,(int)(1.00*100), (int)(1.00*256)},
{14	,(int)(1.00*100), (int)(1.00*256)},
{15	,(int)(1.00*100), (int)(1.00*256)},
{16	,(int)(1.00*100), (int)(1.00*256)},
{16	,(int)(1.00*100), (int)(1.00*256)},//20
{17	,(int)(1.00*100), (int)(1.00*256)},
{17	,(int)(1.00*100), (int)(1.00*256)},
{18	,(int)(1.00*100), (int)(1.00*256)},
{18	,(int)(1.00*100), (int)(1.00*256)},
{19	,(int)(1.00*100), (int)(1.00*256)},
{20	,(int)(1.00*100), (int)(1.00*256)},
{20	,(int)(1.00*100), (int)(1.00*256)},
{21	,(int)(1.00*100), (int)(1.00*256)},
{22	,(int)(1.00*100), (int)(1.00*256)},
{23	,(int)(1.00*100), (int)(1.00*256)},//30
{24	,(int)(1.00*100), (int)(1.00*256)},
{24	,(int)(1.00*100), (int)(1.00*256)},
{25	,(int)(1.00*100), (int)(1.00*256)},
{26	,(int)(1.00*100), (int)(1.00*256)},
{27	,(int)(1.00*100), (int)(1.00*256)},
{28	,(int)(1.00*100), (int)(1.00*256)},
{29	,(int)(1.00*100), (int)(1.00*256)},
{30	,(int)(1.00*100), (int)(1.00*256)},
{31	,(int)(1.00*100), (int)(1.00*256)},
{32	,(int)(1.00*100), (int)(1.00*256)},//40
{33	,(int)(1.00*100), (int)(1.00*256)},
{34	,(int)(1.00*100), (int)(1.00*256)},
{36	,(int)(1.00*100), (int)(1.00*256)},
{37	,(int)(1.00*100), (int)(1.00*256)},
{38	,(int)(1.00*100), (int)(1.00*256)},
{40	,(int)(1.00*100), (int)(1.00*256)},
{41	,(int)(1.00*100), (int)(1.00*256)},
{42	,(int)(1.00*100), (int)(1.00*256)},
{44	,(int)(1.00*100), (int)(1.00*256)},
{45	,(int)(1.00*100), (int)(1.00*256)},//50
{47	,(int)(1.00*100), (int)(1.00*256)},
{49	,(int)(1.00*100), (int)(1.00*256)},
{50	,(int)(1.00*100), (int)(1.00*256)},
{52	,(int)(1.00*100), (int)(1.00*256)},
{54	,(int)(1.00*100), (int)(1.00*256)},
{56	,(int)(1.00*100), (int)(1.00*256)},
{58	,(int)(1.00*100), (int)(1.00*256)},
{60	,(int)(1.00*100), (int)(1.00*256)},
{62	,(int)(1.00*100), (int)(1.00*256)},
{64	,(int)(1.00*100), (int)(1.00*256)},//60
{66	,(int)(1.00*100), (int)(1.00*256)},
{69	,(int)(1.00*100), (int)(1.00*256)},
{71	,(int)(1.00*100), (int)(1.00*256)},
{74	,(int)(1.00*100), (int)(1.00*256)},
{76	,(int)(1.00*100), (int)(1.00*256)},
{79	,(int)(1.00*100), (int)(1.00*256)},
{82	,(int)(1.00*100), (int)(1.00*256)},
{85	,(int)(1.00*100), (int)(1.00*256)},
{88	,(int)(1.00*100), (int)(1.00*256)},
{91	,(int)(1.00*100), (int)(1.00*256)},//70
{94	,(int)(1.00*100), (int)(1.00*256)},
{97	,(int)(1.00*100), (int)(1.00*256)},
{101,(int)(1.00*100), (int)(1.00*256)},
{104,(int)(1.00*100), (int)(1.00*256)},
{108,(int)(1.00*100), (int)(1.00*256)},
{112,(int)(1.00*100), (int)(1.00*256)},
{116,(int)(1.00*100), (int)(1.00*256)},
{120,(int)(1.00*100), (int)(1.00*256)},
{124,(int)(1.00*100), (int)(1.00*256)},
{128,(int)(1.00*100), (int)(1.00*256)},//80
{133,(int)(1.00*100), (int)(1.00*256)},
{138,(int)(1.00*100), (int)(1.00*256)},
{142,(int)(1.00*100), (int)(1.00*256)},
{148,(int)(1.00*100), (int)(1.00*256)},
{153,(int)(1.00*100), (int)(1.00*256)},
{158,(int)(1.00*100), (int)(1.00*256)},
{164,(int)(1.00*100), (int)(1.00*256)},
{169,(int)(1.00*100), (int)(1.00*256)},
{175,(int)(1.00*100), (int)(1.00*256)},
{182,(int)(1.00*100), (int)(1.00*256)},//90
{188,(int)(1.00*100), (int)(1.00*256)},
{188,(int)(1.04*100), (int)(1.00*256)},
{188,(int)(1.06*100), (int)(1.00*256)},
{188,(int)(1.11*100), (int)(1.00*256)},
{188,(int)(1.15*100), (int)(1.00*256)},//95,daylight
{188,(int)(1.19*100), (int)(1.00*256)},
{188,(int)(1.23*100), (int)(1.00*256)},
{188,(int)(1.27*100), (int)(1.00*256)},
{188,(int)(1.31*100), (int)(1.00*256)},
{188,(int)(1.37*100), (int)(1.00*256)},//100
{188,(int)(1.41*100), (int)(1.00*256)},
{188,(int)(1.46*100), (int)(1.00*256)},
{188,(int)(1.52*100), (int)(1.00*256)},
{188,(int)(1.57*100), (int)(1.00*256)},
{188,(int)(1.62*100), (int)(1.00*256)},
{188,(int)(1.68*100), (int)(1.00*256)},
{188,(int)(1.74*100), (int)(1.00*256)},
{210,(int)(1.68*100), (int)(1.00*256)},
{220,(int)(1.65*100), (int)(1.00*256)},
{250,(int)(1.50*100), (int)(1.00*256)},//110
{280,(int)(1.40*100), (int)(1.00*256)},
{310,(int)(1.30*100), (int)(1.00*256)},
{340,(int)(1.23*100), (int)(1.00*256)},
{376,(int)(1.11*100), (int)(1.00*256)},
{376,(int)(1.15*100), (int)(1.00*256)},
{376,(int)(1.19*100), (int)(1.00*256)},
{376,(int)(1.23*100), (int)(1.00*256)},
{376,(int)(1.27*100), (int)(1.00*256)},
{376,(int)(1.31*100), (int)(1.00*256)},
{376,(int)(1.37*100), (int)(1.00*256)},//120
{376,(int)(1.41*100), (int)(1.00*256)},
{376,(int)(1.46*100), (int)(1.00*256)},//121,init
{376,(int)(1.52*100), (int)(1.00*256)},
{376,(int)(1.57*100), (int)(1.00*256)},
{376,(int)(1.62*100), (int)(1.00*256)},
{376,(int)(1.68*100), (int)(1.00*256)},
{376,(int)(1.74*100), (int)(1.00*256)},
{376,(int)(1.80*100), (int)(1.00*256)},
{406,(int)(1.73*100), (int)(1.00*256)},
{440,(int)(1.65*100), (int)(1.00*256)},//130
{475,(int)(1.57*100), (int)(1.00*256)},//
{516,(int)(1.50*100), (int)(1.00*256)},
{546,(int)(1.46*100), (int)(1.00*256)},
{564,(int)(1.46*100), (int)(1.00*256)},
{564,(int)(1.52*100), (int)(1.00*256)},
{564,(int)(1.57*100), (int)(1.00*256)},
{564,(int)(1.62*100), (int)(1.00*256)},
{564,(int)(1.68*100), (int)(1.00*256)},
{564,(int)(1.74*100), (int)(1.00*256)},
{564,(int)(1.80*100), (int)(1.00*256)},//140
{600,(int)(1.76*100), (int)(1.00*256)},
{630,(int)(1.74*100), (int)(1.00*256)},
{670,(int)(1.71*100), (int)(1.00*256)},
{700,(int)(1.69*100), (int)(1.00*256)},
{752,(int)(1.62*100), (int)(1.00*256)},
{752,(int)(1.68*100), (int)(1.00*256)},
{752,(int)(1.74*100), (int)(1.00*256)},
{752,(int)(1.80*100), (int)(1.00*256)},
{752,(int)(1.87*100), (int)(1.00*256)},
{752,(int)(1.93*100), (int)(1.00*256)},//150, night
{752,(int)(2.00*100), (int)(1.00*256)},
{752,(int)(2.07*100), (int)(1.00*256)},
{752,(int)(2.14*100), (int)(1.00*256)},
{752,(int)(2.22*100), (int)(1.00*256)},
{752,(int)(2.30*100), (int)(1.00*256)},
{752,(int)(2.38*100), (int)(1.00*256)},
{752,(int)(2.46*100), (int)(1.00*256)},
{752,(int)(2.55*100), (int)(1.00*256)},
{752,(int)(2.64*100), (int)(1.00*256)},
{752,(int)(2.73*100), (int)(1.00*256)},//160
{752,(int)(2.83*100), (int)(1.00*256)},
{752,(int)(2.93*100), (int)(1.00*256)},
{752,(int)(3.03*100), (int)(1.00*256)},
{752,(int)(3.14*100), (int)(1.00*256)},
{752,(int)(3.25*100), (int)(1.00*256)},
{752,(int)(3.36*100), (int)(1.00*256)},
{752,(int)(3.48*100), (int)(1.00*256)},
{752,(int)(3.61*100), (int)(1.00*256)},
{752,(int)(3.73*100), (int)(1.00*256)},
{752,(int)(3.86*100), (int)(1.00*256)},//170
{752,(int)(4.00*100), (int)(1.00*256)},
{752,(int)(4.14*100), (int)(1.00*256)},
{752,(int)(4.29*100), (int)(1.00*256)},
{752,(int)(4.44*100), (int)(1.00*256)},
{752,(int)(4.59*100), (int)(1.00*256)},
{752,(int)(4.76*100), (int)(1.00*256)},
{752,(int)(4.92*100), (int)(1.00*256)},
{752,(int)(5.10*100), (int)(1.00*256)},
{752,(int)(5.28*100), (int)(1.00*256)},
{752,(int)(5.46*100), (int)(1.00*256)},//180
{752,(int)(5.66*100), (int)(1.00*256)},
{752,(int)(5.86*100), (int)(1.00*256)},
{752,(int)(6.06*100), (int)(1.00*256)},
{752,(int)(6.28*100), (int)(1.00*256)},
{752,(int)(6.50*100), (int)(1.00*256)},
{752,(int)(6.73*100), (int)(1.00*256)},
{752,(int)(6.96*100), (int)(1.00*256)},
{752,(int)(7.21*100), (int)(1.00*256)},
{752,(int)(7.46*100), (int)(1.00*256)},

{752,(int)(7.73*100), (int)(1.00*256)},//190
{752,(int)(8.00*100), (int)(1.00*256)},
{752,(int)(8.28*100), (int)(1.00*256)},
{752,(int)(8.57*100), (int)(1.00*256)},
{752,(int)(8.88*100), (int)(1.00*256)},
{752,(int)(9.19*100), (int)(1.00*256)},
{752,(int)(9.51*100), (int)(1.00*256)},
{752,(int)(9.85*100), (int)(1.00*256)} 
};

//#else	//42Mhz 27fps

static const  int g_GC1004_exp_time_gain_50Hz_42MHz[GC1004_50HZ_EXP_TIME_TOTAL_42MHz][3] =  //203,recount by u2
{ // {time, analog gain, digital gain}
{8  ,(int)(1.00*100),(int)(1.00*256)}, 
{8  ,(int)(1.00*100),(int)(1.00*256)}, 
{9  ,(int)(1.00*100),(int)(1.00*256)}, 
{9  ,(int)(1.00*100),(int)(1.00*256)}, 
{9  ,(int)(1.00*100),(int)(1.00*256)}, 
{9  ,(int)(1.00*100),(int)(1.00*256)}, 
{10 ,(int)(1.00*100),(int)(1.00*256)}, 
{10 ,(int)(1.00*100),(int)(1.00*256)}, 
{10 ,(int)(1.00*100),(int)(1.00*256)}, 
{11 ,(int)(1.00*100),(int)(1.00*256)},  //10
{11 ,(int)(1.00*100),(int)(1.00*256)}, 
{12 ,(int)(1.00*100),(int)(1.00*256)}, 
{12 ,(int)(1.00*100),(int)(1.00*256)}, 
{12 ,(int)(1.00*100),(int)(1.00*256)}, 
{13 ,(int)(1.00*100),(int)(1.00*256)}, 
{13 ,(int)(1.00*100),(int)(1.00*256)}, 
{14 ,(int)(1.00*100),(int)(1.00*256)}, 
{14 ,(int)(1.00*100),(int)(1.00*256)}, 
{15 ,(int)(1.00*100),(int)(1.00*256)}, 
{15 ,(int)(1.00*100),(int)(1.00*256)},  //20
{16 ,(int)(1.00*100),(int)(1.00*256)}, 
{16 ,(int)(1.00*100),(int)(1.00*256)}, 
{17 ,(int)(1.00*100),(int)(1.00*256)}, 
{18 ,(int)(1.00*100),(int)(1.00*256)}, 
{18 ,(int)(1.00*100),(int)(1.00*256)}, 
{19 ,(int)(1.00*100),(int)(1.00*256)}, 
{20 ,(int)(1.00*100),(int)(1.00*256)}, 
{20 ,(int)(1.00*100),(int)(1.00*256)}, 
{21 ,(int)(1.00*100),(int)(1.00*256)}, 
{22 ,(int)(1.00*100),(int)(1.00*256)}, 
{22 ,(int)(1.00*100),(int)(1.00*256)}, 
{23 ,(int)(1.00*100),(int)(1.00*256)}, 
{24 ,(int)(1.00*100),(int)(1.00*256)}, 
{25 ,(int)(1.00*100),(int)(1.00*256)}, 
{26 ,(int)(1.00*100),(int)(1.00*256)}, 
{27 ,(int)(1.00*100),(int)(1.00*256)}, 
{28 ,(int)(1.00*100),(int)(1.00*256)}, 
{29 ,(int)(1.00*100),(int)(1.00*256)}, 
{30 ,(int)(1.00*100),(int)(1.00*256)}, 
{31 ,(int)(1.00*100),(int)(1.00*256)},  //40
{32 ,(int)(1.00*100),(int)(1.00*256)}, 
{33 ,(int)(1.00*100),(int)(1.00*256)}, 
{34 ,(int)(1.00*100),(int)(1.00*256)}, 
{35 ,(int)(1.00*100),(int)(1.00*256)}, 
{37 ,(int)(1.00*100),(int)(1.00*256)}, 
{38 ,(int)(1.00*100),(int)(1.00*256)}, 
{39 ,(int)(1.00*100),(int)(1.00*256)}, 
{41 ,(int)(1.00*100),(int)(1.00*256)}, 
{42 ,(int)(1.00*100),(int)(1.00*256)}, 
{43 ,(int)(1.00*100),(int)(1.00*256)}, 
{45 ,(int)(1.00*100),(int)(1.00*256)}, 
{47 ,(int)(1.00*100),(int)(1.00*256)}, 
{48 ,(int)(1.00*100),(int)(1.00*256)}, 
{50 ,(int)(1.00*100),(int)(1.00*256)}, 
{52 ,(int)(1.00*100),(int)(1.00*256)}, 
{54 ,(int)(1.00*100),(int)(1.00*256)}, 
{55 ,(int)(1.00*100),(int)(1.00*256)}, 
{57 ,(int)(1.00*100),(int)(1.00*256)}, 
{59 ,(int)(1.00*100),(int)(1.00*256)}, 
{61 ,(int)(1.00*100),(int)(1.00*256)},  //60
{64 ,(int)(1.00*100),(int)(1.00*256)}, 
{66 ,(int)(1.00*100),(int)(1.00*256)}, 
{68 ,(int)(1.00*100),(int)(1.00*256)}, 
{71 ,(int)(1.00*100),(int)(1.00*256)}, 
{73 ,(int)(1.00*100),(int)(1.00*256)}, 
{76 ,(int)(1.00*100),(int)(1.00*256)}, 
{78 ,(int)(1.00*100),(int)(1.00*256)}, 
{81 ,(int)(1.00*100),(int)(1.00*256)}, 
{84 ,(int)(1.00*100),(int)(1.00*256)}, 
{87 ,(int)(1.00*100),(int)(1.00*256)}, 
{90 ,(int)(1.00*100),(int)(1.00*256)}, 
{93 ,(int)(1.00*100),(int)(1.00*256)}, 
{96 ,(int)(1.00*100),(int)(1.00*256)}, 
{100,(int)(1.00*100),(int)(1.00*256)}, 
{103,(int)(1.00*100),(int)(1.00*256)}, 
{107,(int)(1.00*100),(int)(1.00*256)}, 
{111,(int)(1.00*100),(int)(1.00*256)}, 
{115,(int)(1.00*100),(int)(1.00*256)}, 
{119,(int)(1.00*100),(int)(1.00*256)}, 
{123,(int)(1.00*100),(int)(1.00*256)},  //80
{127,(int)(1.00*100),(int)(1.00*256)}, 
{132,(int)(1.00*100),(int)(1.00*256)}, 
{136,(int)(1.00*100),(int)(1.00*256)}, 
{141,(int)(1.00*100),(int)(1.00*256)}, 
{146,(int)(1.00*100),(int)(1.00*256)}, 
{151,(int)(1.00*100),(int)(1.00*256)}, 
{157,(int)(1.00*100),(int)(1.00*256)}, 
{162,(int)(1.00*100),(int)(1.00*256)}, 
{168,(int)(1.00*100),(int)(1.00*256)},  
{174,(int)(1.00*100),(int)(1.00*256)},  //90
{180,(int)(1.00*100),(int)(1.00*256)}, 
{186,(int)(1.00*100),(int)(1.00*256)}, 
{193,(int)(1.00*100),(int)(1.00*256)}, 
{200,(int)(1.00*100),(int)(1.00*256)}, 
{207,(int)(1.00*100),(int)(1.00*256)}, 
// 10ms            
{214,(int)(1.00*100),(int)(1.00*256)},  //96,daylight
{214,(int)(1.04*100),(int)(1.00*256)}, 
{214,(int)(1.06*100),(int)(1.00*256)}, 
{214,(int)(1.11*100),(int)(1.00*256)}, 
{214,(int)(1.15*100),(int)(1.00*256)},  //100
{214,(int)(1.19*100),(int)(1.00*256)}, 
{214,(int)(1.23*100),(int)(1.00*256)}, 
{214,(int)(1.27*100),(int)(1.00*256)}, 
{214,(int)(1.31*100),(int)(1.00*256)}, 
{214,(int)(1.37*100),(int)(1.00*256)}, 
{214,(int)(1.41*100),(int)(1.00*256)}, 
{214,(int)(1.46*100),(int)(1.00*256)}, 
{214,(int)(1.52*100),(int)(1.00*256)}, 
{214,(int)(1.57*100),(int)(1.00*256)}, 
{214,(int)(1.62*100),(int)(1.00*256)},  //110
{214,(int)(1.68*100),(int)(1.00*256)}, 
{214,(int)(1.74*100),(int)(1.00*256)}, 
{214,(int)(1.80*100),(int)(1.00*256)},  
//20 ms
{428,(int)(1.00*100),(int)(1.00*256)}, 
{428,(int)(1.04*100),(int)(1.00*256)}, 
{428,(int)(1.06*100),(int)(1.00*256)}, 
{428,(int)(1.11*100),(int)(1.00*256)}, 
{428,(int)(1.15*100),(int)(1.00*256)}, 
{428,(int)(1.19*100),(int)(1.00*256)}, 
{428,(int)(1.23*100),(int)(1.00*256)}, //120
{428,(int)(1.27*100),(int)(1.00*256)}, 
{428,(int)(1.31*100),(int)(1.00*256)}, 
{428,(int)(1.37*100),(int)(1.00*256)}, 
{428,(int)(1.41*100),(int)(1.00*256)}, 
{428,(int)(1.46*100),(int)(1.00*256)}, 
{428,(int)(1.52*100),(int)(1.00*256)}, 
{428,(int)(1.57*100),(int)(1.00*256)}, 
{428,(int)(1.62*100),(int)(1.00*256)}, 
{428,(int)(1.68*100),(int)(1.00*256)},  
{428,(int)(1.74*100),(int)(1.00*256)}, //130
{428,(int)(1.80*100),(int)(1.00*256)}, 
{428,(int)(1.87*100),(int)(1.00*256)}, 
{428,(int)(1.93*100),(int)(1.00*256)},
{428,(int)(2.00*100),(int)(1.00*256)}, 
//30 ms
{642,(int)(1.48*100),(int)(1.00*256)}, 
{642,(int)(1.54*100),(int)(1.00*256)}, 
{642,(int)(1.60*100),(int)(1.00*256)}, 
{642,(int)(1.76*100),(int)(1.00*256)}, 
{642,(int)(1.82*100),(int)(1.00*256)}, 
{642,(int)(1.88*100),(int)(1.00*256)},  //140
{642,(int)(1.94*100),(int)(1.00*256)}, 
{642,(int)(2.00*100),(int)(1.00*256)}, 
{642,(int)(2.06*100),(int)(1.00*256)}, 
{642,(int)(2.12*100),(int)(1.00*256)}, 
{642,(int)(2.18*100),(int)(1.00*256)}, 
{642,(int)(2.24*100),(int)(1.00*256)},  
{642,(int)(2.30*100),(int)(1.00*256)}, 
{642,(int)(2.36*100),(int)(1.00*256)}, 
//40ms
{856,(int)(1.83*100),(int)(1.00*256)}, 
{856,(int)(1.89*100),(int)(1.00*256)},  //150
{856,(int)(1.95*100),(int)(1.00*256)}, 
{856,(int)(2.01*100),(int)(1.00*256)},
{856,(int)(2.07*100),(int)(1.00*256)}, 
{856,(int)(2.14*100),(int)(1.00*256)}, 
{856,(int)(2.22*100),(int)(1.00*256)}, 
{856,(int)(2.30*100),(int)(1.00*256)}, 
{856,(int)(2.38*100),(int)(1.00*256)}, 
{856,(int)(2.46*100),(int)(1.00*256)}, 
{856,(int)(2.55*100),(int)(1.00*256)}, 
{856,(int)(2.64*100),(int)(1.00*256)},  //160
{856,(int)(2.73*100),(int)(1.00*256)}, 
{856,(int)(2.83*100),(int)(1.00*256)}, 
{856,(int)(2.93*100),(int)(1.00*256)}, 
{856,(int)(3.03*100),(int)(1.00*256)}, 
{856,(int)(3.14*100),(int)(1.00*256)}, 
{856,(int)(3.25*100),(int)(1.00*256)}, 
{856,(int)(3.36*100),(int)(1.00*256)}, 
{856,(int)(3.48*100),(int)(1.00*256)}, 
{856,(int)(3.61*100),(int)(1.00*256)}, 
{856,(int)(3.73*100),(int)(1.00*256)}, //170
{856,(int)(3.86*100),(int)(1.00*256)}, 
{856,(int)(4.00*100),(int)(1.00*256)},   // GC_BLK night
{856,(int)(4.14*100),(int)(1.00*256)}, 
{856,(int)(4.29*100),(int)(1.00*256)}, 
{856,(int)(4.44*100),(int)(1.00*256)}, 
{856,(int)(4.59*100),(int)(1.00*256)}, 
{856,(int)(4.76*100),(int)(1.00*256)}, 
{856,(int)(4.92*100),(int)(1.00*256)}, 
{856,(int)(5.10*100),(int)(1.00*256)}, 
{856,(int)(5.28*100),(int)(1.00*256)}, //180 
{856,(int)(5.46*100),(int)(1.00*256)}, 
{856,(int)(5.66*100),(int)(1.00*256)}, 
{856,(int)(5.86*100),(int)(1.00*256)}, 
{856,(int)(6.06*100),(int)(1.00*256)}, 
{856,(int)(6.28*100),(int)(1.00*256)}, 
{856,(int)(6.50*100),(int)(1.00*256)}, 
{856,(int)(6.73*100),(int)(1.00*256)}, 
{856,(int)(6.96*100),(int)(1.00*256)}, 
{856,(int)(7.21*100),(int)(1.00*256)}, //189
{856,(int)(7.46*100),(int)(1.00*256)}, //190 
{856,(int)(7.73*100),(int)(1.00*256)}, 
{856,(int)(8.00*100),(int)(1.00*256)}, 
{856,(int)(8.28*100),(int)(1.00*256)}, 
{856,(int)(8.57*100),(int)(1.00*256)}, 
{856,(int)(8.88*100),(int)(1.00*256)}, 
{856,(int)(9.19*100),(int)(1.00*256)}, 
{856,(int)(9.51*100),(int)(1.00*256)}, 
{856,(int)(9.85*100),(int)(1.00*256)}, 
{856,(int)(9.91*100),(int)(1.00*256)}, 
{856,(int)(9.97*100),(int)(1.00*256)}, //200
{856,(int)(10.03*100),(int)(1.00*256)}, 
{856,(int)(10.09*100),(int)(1.00*256)},  
{856,(int)(10.15*100),(int)(1.00*256)}
}; 

static const  int g_GC1004_exp_time_gain_60Hz_42MHz[GC1004_60HZ_EXP_TIME_TOTAL_42MHz][3] = 
{ // {time, analog gain, digital gain}
{8  ,(int)(1.00*100),(int)(1.00*256)}, 
{8  ,(int)(1.00*100),(int)(1.00*256)}, 
{9  ,(int)(1.00*100),(int)(1.00*256)}, 
{9  ,(int)(1.00*100),(int)(1.00*256)}, 
{9  ,(int)(1.00*100),(int)(1.00*256)}, 
{9  ,(int)(1.00*100),(int)(1.00*256)}, 
{10 ,(int)(1.00*100),(int)(1.00*256)}, 
{10 ,(int)(1.00*100),(int)(1.00*256)}, 
{10 ,(int)(1.00*100),(int)(1.00*256)}, 
{11 ,(int)(1.00*100),(int)(1.00*256)},  //10
{11 ,(int)(1.00*100),(int)(1.00*256)}, 
{12 ,(int)(1.00*100),(int)(1.00*256)}, 
{12 ,(int)(1.00*100),(int)(1.00*256)}, 
{12 ,(int)(1.00*100),(int)(1.00*256)}, 
{13 ,(int)(1.00*100),(int)(1.00*256)}, 
{13 ,(int)(1.00*100),(int)(1.00*256)}, 
{14 ,(int)(1.00*100),(int)(1.00*256)}, 
{14 ,(int)(1.00*100),(int)(1.00*256)}, 
{15 ,(int)(1.00*100),(int)(1.00*256)}, 
{15 ,(int)(1.00*100),(int)(1.00*256)},  //20
{16 ,(int)(1.00*100),(int)(1.00*256)}, 
{16 ,(int)(1.00*100),(int)(1.00*256)}, 
{17 ,(int)(1.00*100),(int)(1.00*256)}, 
{18 ,(int)(1.00*100),(int)(1.00*256)}, 
{18 ,(int)(1.00*100),(int)(1.00*256)}, 
{19 ,(int)(1.00*100),(int)(1.00*256)}, 
{20 ,(int)(1.00*100),(int)(1.00*256)}, 
{20 ,(int)(1.00*100),(int)(1.00*256)}, 
{21 ,(int)(1.00*100),(int)(1.00*256)}, 
{22 ,(int)(1.00*100),(int)(1.00*256)}, 
{22 ,(int)(1.00*100),(int)(1.00*256)}, 
{23 ,(int)(1.00*100),(int)(1.00*256)}, 
{24 ,(int)(1.00*100),(int)(1.00*256)}, 
{25 ,(int)(1.00*100),(int)(1.00*256)}, 
{26 ,(int)(1.00*100),(int)(1.00*256)}, 
{27 ,(int)(1.00*100),(int)(1.00*256)}, 
{28 ,(int)(1.00*100),(int)(1.00*256)}, 
{29 ,(int)(1.00*100),(int)(1.00*256)}, 
{30 ,(int)(1.00*100),(int)(1.00*256)}, 
{31 ,(int)(1.00*100),(int)(1.00*256)},  //40
{32 ,(int)(1.00*100),(int)(1.00*256)}, 
{33 ,(int)(1.00*100),(int)(1.00*256)}, 
{34 ,(int)(1.00*100),(int)(1.00*256)}, 
{35 ,(int)(1.00*100),(int)(1.00*256)}, 
{37 ,(int)(1.00*100),(int)(1.00*256)}, 
{38 ,(int)(1.00*100),(int)(1.00*256)}, 
{39 ,(int)(1.00*100),(int)(1.00*256)}, 
{41 ,(int)(1.00*100),(int)(1.00*256)}, 
{42 ,(int)(1.00*100),(int)(1.00*256)}, 
{43 ,(int)(1.00*100),(int)(1.00*256)}, 
{45 ,(int)(1.00*100),(int)(1.00*256)}, 
{47 ,(int)(1.00*100),(int)(1.00*256)}, 
{48 ,(int)(1.00*100),(int)(1.00*256)}, 
{50 ,(int)(1.00*100),(int)(1.00*256)}, 
{52 ,(int)(1.00*100),(int)(1.00*256)}, 
{54 ,(int)(1.00*100),(int)(1.00*256)}, 
{55 ,(int)(1.00*100),(int)(1.00*256)}, 
{57 ,(int)(1.00*100),(int)(1.00*256)}, 
{59 ,(int)(1.00*100),(int)(1.00*256)}, 
{61 ,(int)(1.00*100),(int)(1.00*256)},  //60
{64 ,(int)(1.00*100),(int)(1.00*256)}, 
{66 ,(int)(1.00*100),(int)(1.00*256)}, 
{68 ,(int)(1.00*100),(int)(1.00*256)}, 
{71 ,(int)(1.00*100),(int)(1.00*256)}, 
{73 ,(int)(1.00*100),(int)(1.00*256)}, 
{76 ,(int)(1.00*100),(int)(1.00*256)}, 
{78 ,(int)(1.00*100),(int)(1.00*256)}, 
{81 ,(int)(1.00*100),(int)(1.00*256)}, 
{84 ,(int)(1.00*100),(int)(1.00*256)}, 
{87 ,(int)(1.00*100),(int)(1.00*256)}, 
{90 ,(int)(1.00*100),(int)(1.00*256)}, 
{93 ,(int)(1.00*100),(int)(1.00*256)}, 
{96 ,(int)(1.00*100),(int)(1.00*256)}, 
{100,(int)(1.00*100),(int)(1.00*256)}, 
{103,(int)(1.00*100),(int)(1.00*256)}, 
{107,(int)(1.00*100),(int)(1.00*256)}, 
{111,(int)(1.00*100),(int)(1.00*256)}, 
{115,(int)(1.00*100),(int)(1.00*256)}, 
{119,(int)(1.00*100),(int)(1.00*256)}, 
{123,(int)(1.00*100),(int)(1.00*256)},  //80
{127,(int)(1.00*100),(int)(1.00*256)}, 
{132,(int)(1.00*100),(int)(1.00*256)}, 
{136,(int)(1.00*100),(int)(1.00*256)}, 
{141,(int)(1.00*100),(int)(1.00*256)}, 
{146,(int)(1.00*100),(int)(1.00*256)}, 
{151,(int)(1.00*100),(int)(1.00*256)}, 
{157,(int)(1.00*100),(int)(1.00*256)}, 
{162,(int)(1.00*100),(int)(1.00*256)}, 
{168,(int)(1.00*100),(int)(1.00*256)},  
{174,(int)(1.00*100),(int)(1.00*256)},  //90 
// 10ms            
{178,(int)(1.00*100),(int)(1.00*256)},  //91,daylight
{178,(int)(1.04*100),(int)(1.00*256)}, 
{178,(int)(1.06*100),(int)(1.00*256)}, 
{178,(int)(1.11*100),(int)(1.00*256)}, 
{178,(int)(1.15*100),(int)(1.00*256)},  
{178,(int)(1.19*100),(int)(1.00*256)}, 
{178,(int)(1.23*100),(int)(1.00*256)}, 
{178,(int)(1.27*100),(int)(1.00*256)}, 
{178,(int)(1.31*100),(int)(1.00*256)}, 
{178,(int)(1.37*100),(int)(1.00*256)}, //100
{178,(int)(1.41*100),(int)(1.00*256)}, 
{178,(int)(1.46*100),(int)(1.00*256)}, 
{178,(int)(1.52*100),(int)(1.00*256)}, 
{178,(int)(1.57*100),(int)(1.00*256)}, 
{178,(int)(1.62*100),(int)(1.00*256)}, 
{178,(int)(1.68*100),(int)(1.00*256)}, 
{178,(int)(1.74*100),(int)(1.00*256)}, 
{178,(int)(1.80*100),(int)(1.00*256)},  
//20 ms
{356,(int)(1.00*100),(int)(1.00*256)}, 
{356,(int)(1.04*100),(int)(1.00*256)}, //110
{356,(int)(1.06*100),(int)(1.00*256)}, 
{356,(int)(1.11*100),(int)(1.00*256)}, 
{356,(int)(1.15*100),(int)(1.00*256)}, 
{356,(int)(1.19*100),(int)(1.00*256)}, 
{356,(int)(1.23*100),(int)(1.00*256)}, 
{356,(int)(1.27*100),(int)(1.00*256)}, 
{356,(int)(1.31*100),(int)(1.00*256)}, 
{356,(int)(1.37*100),(int)(1.00*256)}, 
{356,(int)(1.41*100),(int)(1.00*256)}, 
{356,(int)(1.46*100),(int)(1.00*256)}, //120
{356,(int)(1.52*100),(int)(1.00*256)}, 
{356,(int)(1.57*100),(int)(1.00*256)}, 
{356,(int)(1.62*100),(int)(1.00*256)}, 
{356,(int)(1.68*100),(int)(1.00*256)},  
{356,(int)(1.74*100),(int)(1.00*256)}, 
{356,(int)(1.80*100),(int)(1.00*256)}, 
{356,(int)(1.87*100),(int)(1.00*256)}, 
{356,(int)(1.93*100),(int)(1.00*256)},
{356,(int)(2.00*100),(int)(1.00*256)}, 
//30 ms
{534,(int)(1.48*100),(int)(1.00*256)}, //130
{534,(int)(1.54*100),(int)(1.00*256)}, 
{534,(int)(1.60*100),(int)(1.00*256)}, 
{534,(int)(1.76*100),(int)(1.00*256)}, 
{534,(int)(1.82*100),(int)(1.00*256)}, 
{534,(int)(1.88*100),(int)(1.00*256)}, 
{534,(int)(1.94*100),(int)(1.00*256)}, 
{534,(int)(2.00*100),(int)(1.00*256)}, 
{534,(int)(2.06*100),(int)(1.00*256)}, 
{534,(int)(2.12*100),(int)(1.00*256)}, 
{534,(int)(2.18*100),(int)(1.00*256)}, //140
{534,(int)(2.24*100),(int)(1.00*256)},  
{534,(int)(2.30*100),(int)(1.00*256)}, 
{534,(int)(2.36*100),(int)(1.00*256)}, 
//40ms
{712,(int)(1.83*100),(int)(1.00*256)}, 
{712,(int)(1.89*100),(int)(1.00*256)}, 
{712,(int)(1.95*100),(int)(1.00*256)}, 
{712,(int)(2.01*100),(int)(1.00*256)},
{712,(int)(2.07*100),(int)(1.00*256)}, 
{712,(int)(2.14*100),(int)(1.00*256)}, 
{712,(int)(2.22*100),(int)(1.00*256)}, //150
{712,(int)(2.30*100),(int)(1.00*256)}, 
{712,(int)(2.38*100),(int)(1.00*256)}, 
{712,(int)(2.46*100),(int)(1.00*256)}, 
{712,(int)(2.55*100),(int)(1.00*256)}, 
{712,(int)(2.64*100),(int)(1.00*256)}, 
{712,(int)(2.73*100),(int)(1.00*256)}, 
{712,(int)(2.83*100),(int)(1.00*256)}, 
{712,(int)(2.93*100),(int)(1.00*256)}, 
{712,(int)(3.03*100),(int)(1.00*256)}, 
{712,(int)(3.14*100),(int)(1.00*256)}, //160
{712,(int)(3.25*100),(int)(1.00*256)}, 
{712,(int)(3.36*100),(int)(1.00*256)}, 
{712,(int)(3.48*100),(int)(1.00*256)}, 
{712,(int)(3.61*100),(int)(1.00*256)}, 
{712,(int)(3.73*100),(int)(1.00*256)}, 
{712,(int)(3.86*100),(int)(1.00*256)}, 
{712,(int)(4.00*100),(int)(1.00*256)}, 
{712,(int)(4.14*100),(int)(1.00*256)}, 
{712,(int)(4.29*100),(int)(1.00*256)}, 
{712,(int)(4.44*100),(int)(1.00*256)}, //170
{712,(int)(4.59*100),(int)(1.00*256)}, 
{712,(int)(4.76*100),(int)(1.00*256)}, 
{712,(int)(4.92*100),(int)(1.00*256)}, 
{712,(int)(5.10*100),(int)(1.00*256)}, 
{712,(int)(5.28*100),(int)(1.00*256)},  
{712,(int)(5.46*100),(int)(1.00*256)}, 
{712,(int)(5.66*100),(int)(1.00*256)}, 
{712,(int)(5.86*100),(int)(1.00*256)}, 
{712,(int)(6.06*100),(int)(1.00*256)}, 
{712,(int)(6.28*100),(int)(1.00*256)}, //180
{712,(int)(6.50*100),(int)(1.00*256)}, 
{712,(int)(6.73*100),(int)(1.00*256)}, 
{712,(int)(6.96*100),(int)(1.00*256)}, 
{712,(int)(7.21*100),(int)(1.00*256)}, 
{712,(int)(7.46*100),(int)(1.00*256)}, 
{712,(int)(7.73*100),(int)(1.00*256)}, 
{712,(int)(8.00*100),(int)(1.00*256)}, 
{712,(int)(8.28*100),(int)(1.00*256)}, 
{712,(int)(8.57*100),(int)(1.00*256)}, 
{712,(int)(8.88*100),(int)(1.00*256)}, //190
{712,(int)(9.19*100),(int)(1.00*256)}, 
{712,(int)(9.51*100),(int)(1.00*256)}, 
{712,(int)(9.85*100),(int)(1.00*256)}, 
{712,(int)(9.91*100),(int)(1.00*256)}, 
{712,(int)(9.97*100),(int)(1.00*256)}, 
{712,(int)(10.03*100),(int)(1.00*256)}, 
{712,(int)(10.09*100),(int)(1.00*256)},  
{712,(int)(10.15*100),(int)(1.00*256)} //198
};

/**************************************************************************
 *                         SENSEOR FUNCTION                          *
 **************************************************************************/

static INT32S gc1004_sccb_open(void)
{
#if SCCB_MODE == SCCB_GPIO
	gc1004_handle = drv_l2_sccb_open(GC1004_SLAVE_ID, 8, 8);
	if(gc1004_handle == 0) {
		DBG_PRINT("Sccb open fail.\r\n");
		return STATUS_FAIL;
	}
#elif SCCB_MODE == SCCB_HW_I2C	
	drv_l1_i2c_init();
	gc1004_handle.slaveAddr = GC1004_SLAVE_ID;
	gc1004_handle.clkRate = 100;
#endif
	return STATUS_OK;
}

static void gc1004_sccb_close(void)
{
#if SCCB_MODE == SCCB_GPIO
	if(gc1004_handle) {
		drv_l2_sccb_close(gc1004_handle);
		gc1004_handle = NULL;
	}	
#elif SCCB_MODE == SCCB_HW_I2C	
	drv_l1_i2c_uninit();
	gc1004_handle.slaveAddr = 0;
	gc1004_handle.clkRate = 0;
#endif
}

static INT32S gc1004_sccb_write(INT8U reg, INT8U value)
{
#if SCCB_MODE == SCCB_GPIO
	return drv_l2_sccb_write(gc1004_handle, reg, value);

#elif SCCB_MODE == SCCB_HW_I2C	
	INT8U data[2];
	
	data[0] = reg;
	data[1] = value;
	return drv_l1_i2c_bus_write(gc1004_handle, data, 2);
#endif
}

static INT32S gc1004_sccb_write_table(regval8_t *pTable)
{
	int j=0;
	
	while(1) {
		if(pTable->reg_num == 0xFF && pTable->value == 0xFF) {
			break;
		}
		
		if(pTable->reg_num == 0x10 && pTable->value == 0x80) {
			j = 1;
		}		
		
		if(gc1004_sccb_write(pTable->reg_num, pTable->value) < 0) {
			DBG_PRINT("sccb write fail.\r\n");
			continue;
		}

		if(j==1)
		{
			drv_msec_wait(200);
			DBG_PRINT("dly 200\r\n");
			j=0;
		}
		pTable++;
	}

	return STATUS_OK;
}

sensor_exposure_t *gc1004_get_senInfo(void)
{
	return &gc1004_seInfo;
}

#if 0//ggg
void gc1004_sensor_calibration_str(void)
{
	gc1004_cdsp_calibration.wb_gain = g_GC1004_r_b_gain;
	/*
	gc1004_cdsp_calibration.gamma = g_GC1004_gamma_045_table_5;
	gc1004_cdsp_calibration.color_matrix = g_GC1004_color_matrix4gamma045_7;
	gc1004_cdsp_calibration.awb_thr = g_GC1004_awb_thr_2;
	*/
}


sensor_calibration_t *gc1004_get_calibration(void)
{
	return &gc1004_cdsp_calibration;
}

#endif

#if 0//ggg
void gc1004_sensor_calibration(void)
{
	//OB
	gp_Cdsp_SetBadPixOb((INT16U *)g_GC1004_badpix_ob_table);
	//Linearity
	/*
	hwIsp_LinCorr_Table((INT8U *)g_GC1004_LiTable_rgb);
	//Lenscmp
	hwIsp_luc_MaxTan8_Slop_CLP((INT16U *)g_GC1004_MaxTan8 ,(INT16U *)g_GC1004_Slope4 ,(INT16U *)g_GC1004_CLPoint);
	hwIsp_RadusF0((INT16U *)g_GC1004_Radius_File_0);
	hwIsp_RadusF1((INT16U *)g_GC1004_Radius_File_1);
	*/		
	//Gamma
	hwCdsp_InitGamma((INT32U *)g_GC1004_gamma_045_table);
	//Color Correction
	hwCdsp_SetColorMatrix_Str((INT16S *)g_GC1004_color_matrix4gamma045);
	//AWB
	gp_Cdsp_SetAWBYUV((INT16S *)g_GC1004_awb_thr);
}
#endif
int gc1004_get_night_ev_idx(void)
{
	return gc1004_seInfo.night_ev_idx;
}

int gc1004_get_max_ev_idx(void)
{
	return gc1004_seInfo.max_ev_idx;
}

gpCdspWBGain_t *gc1004_awb_r_b_gain_boundary(void)
{
	int i;
	int max_r_gain, max_b_gain, min_r_gain, min_b_gain;
	
	max_r_gain = max_b_gain = 0;
	min_r_gain = min_b_gain = 255;
	
	for(i = 10 ; i < 55 ; i++)
	{
		if(max_r_gain < g_GC1004_r_b_gain[i][0]) max_r_gain = g_GC1004_r_b_gain[i][0];
		if(max_b_gain < g_GC1004_r_b_gain[i][1]) max_b_gain = g_GC1004_r_b_gain[i][1];
		if(min_r_gain > g_GC1004_r_b_gain[i][0]) min_r_gain = g_GC1004_r_b_gain[i][0];
		if(min_b_gain > g_GC1004_r_b_gain[i][1]) min_b_gain = g_GC1004_r_b_gain[i][1];
	}
	
	gc1004_wbgain.max_rgain = max_r_gain;
	gc1004_wbgain.max_bgain = max_b_gain;
	gc1004_wbgain.min_rgain = min_r_gain;
	gc1004_wbgain.min_bgain = min_b_gain;
	
	return &gc1004_wbgain;
}
/**************************************************************************
 *             F U N C T I O N    I M P L E M E N T A T I O N S           *
 **************************************************************************/
/*
static int gc1004_analog_gain_table[9] = 
{
	(int)(1.00*256+0.5), (int)(1.40*256+0.5), (int)(1.80*256+0.5), (int)(2.60*256+0.5), 
	(int)(3.40*256+0.5), (int)(4.70*256+0.5), (int)(6.84*256+0.5), (int)(9.40*256+0.5), 
	(int)(13.2*256+0.5)
};


static int gc1004_analog_gain_table[49] = 
{
	//digital gain x 1
	(int)(1.00*256+0.5), (int)(1.06*256+0.5), (int)(1.13*256+0.5), (int)(1.19*256+0.5),
	(int)(1.25*256+0.5), (int)(1.31*256+0.5), (int)(1.38*256+0.5), (int)(1.44*256+0.5),
	(int)(1.50*256+0.5), (int)(1.56*256+0.5), (int)(1.63*256+0.5), (int)(1.69*256+0.5), 
	(int)(1.75*256+0.5), (int)(1.81*256+0.5), (int)(1.88*256+0.5), (int)(1.94*256+0.5),
	
	//digital gain x 2
	(int)(2.00*256+0.5), (int)(2.06*256+0.5), (int)(2.13*256+0.5), (int)(2.19*256+0.5),
	(int)(2.25*256+0.5), (int)(2.31*256+0.5), (int)(2.38*256+0.5), (int)(2.44*256+0.5),
	(int)(2.50*256+0.5), (int)(2.56*256+0.5), (int)(2.63*256+0.5), (int)(2.69*256+0.5),
	(int)(2.75*256+0.5), (int)(2.81*256+0.5), (int)(2.88*256+0.5), (int)(2.94*256+0.5),

	//digital gain x 3
	(int)(3.00*256+0.5), (int)(3.06*256+0.5), (int)(3.13*256+0.5), (int)(3.19*256+0.5),           
	(int)(3.25*256+0.5), (int)(3.31*256+0.5), (int)(3.38*256+0.5), (int)(3.44*256+0.5),           
	(int)(3.50*256+0.5), (int)(3.56*256+0.5), (int)(3.63*256+0.5), (int)(3.69*256+0.5),           
	(int)(3.75*256+0.5), (int)(3.81*256+0.5), (int)(3.88*256+0.5), (int)(3.94*256+0.5),           


	//digital gain x 4
	(int)(4.00*256+0.5),
};
*/

#if 0//(!GC1004_GC_AE)
static void gc1004_cvt_analog_gain(INT32U analog_gain)
{
	INT32U iReg, temp;
	//INT32U coarse_gain, fine_gain;

	gc1004_analog_gain = analog_gain;                                                          

	iReg = analog_gain >> 2;
	
	gc1004_sccb_write(0xb1, 0x01);   

	if(iReg < 0x40) {
		iReg = 0x40; 
		gc1004_sccb_write( 0xb1, 0x01);                               
		gc1004_sccb_write( 0xb2, 0x00);                                                                                  
	}                                                        
	else if((ANALOG_GAIN_1<= iReg)&&(iReg < ANALOG_GAIN_2))                
	{                                                                      
		//analog gain                                                          
		temp = iReg;                                                           
		//gc1004_sccb_write( 0xb1, temp>>6);                               
		gc1004_sccb_write( 0xb2, (temp<<2)&0xfc);                     

		gc1004_sccb_write( 0xb6, 0x00);//                                   
		//DBG_PRINT("GC1004 analogic gain 1x , GC1004 add pregain = %d\r\n",temp);  
		//DBG_PRINT("a:1x,p:%d\r\n",(temp<<2)&0xfc);  
	}                                                                      
	else if((ANALOG_GAIN_2<= iReg)&&(iReg < ANALOG_GAIN_3))                
	{                                                                      
		temp = 64*iReg/ANALOG_GAIN_2;                                          
		//sccb_write(GC1004_SLAVE_ID, 0xb1, temp>>6);                               
		gc1004_sccb_write( 0xb2, (temp<<2)&0xfc);                 
		
		gc1004_sccb_write( 0xb6, 0x01);//  
		//DBG_PRINT("a:1.4x,p:%d\r\n",(temp<<2)&0xfc);                                       
		//DBG_PRINT("GC1004 analogic gain 1.4x , GC1004 add pregain = %d\r\n",temp);
	}                                                                      
	else if((ANALOG_GAIN_3<= iReg)&&(iReg < ANALOG_GAIN_4))                
	{                                                                                       
		temp = 64*iReg/ANALOG_GAIN_3;                                          
		//sccb_write(GC1004_SLAVE_ID, 0xb1, temp>>6);                               
		gc1004_sccb_write( 0xb2, (temp<<2)&0xfc);                 
		
		gc1004_sccb_write( 0xb6, 0x02);//                      
		//DBG_PRINT("a:1.8x,p:%d\r\n",(temp<<2)&0xfc);  
		//DBG_PRINT("GC1004 analogic gain 1.8x , GC1004 add pregain = %d\r\n",temp);
	}                                                                      
	else if((ANALOG_GAIN_4<= iReg)&&(iReg < ANALOG_GAIN_5))                
	{                                                                      
		temp = 64*iReg/ANALOG_GAIN_4;       
		//sccb_write(GC1004_SLAVE_ID, 0xb1, temp>>6);                                                                   
		gc1004_sccb_write( 0xb2, (temp<<2)&0xfc);                 
		
		gc1004_sccb_write( 0xb6, 0x03);
		//DBG_PRINT("a:2.56x,p:%d\r\n",(temp<<2)&0xfc);                                            
		//DBG_PRINT("GC1004 analogic gain 2.56x , GC1004 add pregain = %d\r\n",temp);
	}                                                                       
	else if((ANALOG_GAIN_5<= iReg)&&(iReg < ANALOG_GAIN_6))                 
	{                                                                       
		temp = 64*iReg/ANALOG_GAIN_5;                                           
		//sccb_write(GC1004_SLAVE_ID, 0xb1, temp>>6);                                
		gc1004_sccb_write( 0xb2, (temp<<2)&0xfc);                  

		gc1004_sccb_write( 0xb6, 0x04);
		//DBG_PRINT("a:3.4x,p:%d\r\n",(temp<<2)&0xfc);                                   		       
		//DBG_PRINT("GC1004 analogic gain 3.4x , GC1004 add pregain = %d\r\n",temp); 
	}                                                                       
	else if((ANALOG_GAIN_6<= iReg)&&(iReg < ANALOG_GAIN_7))                 
	{                                                                                                     
		temp = 64*iReg/ANALOG_GAIN_6;                                           
		//sccb_write(GC1004_SLAVE_ID, 0xb1, temp>>6);                                
		gc1004_sccb_write( 0xb2, (temp<<2)&0xfc);                  

		gc1004_sccb_write( 0xb6, 0x05);
		//DBG_PRINT("a:4.7x,p:%d\r\n",(temp<<2)&0xfc);   		       
		//DBG_PRINT("GC1004 analogic gain 4.7x , GC1004 add pregain = %d\r\n",temp); 
	}                                                                       
	else if((ANALOG_GAIN_7<= iReg)&&(iReg < ANALOG_GAIN_8))                 
	{                                                                                                   
		temp = 64*iReg/ANALOG_GAIN_7;                                           
		//sccb_write(GC1004_SLAVE_ID, 0xb1, temp>>6);                                
		gc1004_sccb_write( 0xb2, (temp<<2)&0xfc);                  

		gc1004_sccb_write( 0xb6, 0x06);//     		       
		//DBG_PRINT("a:6.84x,p:%d\r\n",(temp<<2)&0xfc);
		//DBG_PRINT("GC1004 analogic gain 6.84x, GC1004 add pregain = %d\r\n",temp); 
	}                                                                       
	else if((ANALOG_GAIN_8<= iReg)&&(iReg < ANALOG_GAIN_9))                 
	{                                                                                                 
		temp = 64*iReg/ANALOG_GAIN_8;                                           
		//sccb_write(GC1004_SLAVE_ID, 0xb1, temp>>6);                                
		gc1004_sccb_write( 0xb2, (temp<<2)&0xfc);                  

		gc1004_sccb_write( 0xb6, 0x07);       		       
		//DBG_PRINT("a:9.4x,p:%d\r\n",(temp<<2)&0xfc);
		//DBG_PRINT("GC1004 analogic gain 9.4x,GC1004 add pregain = %d\r\n",temp);   
	}                                                                                                                  
	else //if((ANALOG_GAIN_9<= iReg)&&(iReg < ANALOG_GAIN_10))                
	{                                                                                                 
		temp = 64*iReg/ANALOG_GAIN_9;                                           
		//sccb_write(GC1004_SLAVE_ID, 0xb1, temp>>6);                                
		gc1004_sccb_write( 0xb2, (temp<<2)&0xfc);                  

		gc1004_sccb_write( 0xb6, 0x08);       		       
		//DBG_PRINT("GC1004 analogic gain 13.2x ,GC1004 add pregain = %d\r\n",temp); 
	} 
}
#else
static void gc1004_cvt_analog_gain(INT32U analog_gain)
{
	INT32U Analog_Multiple[9]={100, 140, 180, 256, 340,480,684,940,1320}; 

	INT32U Analog_Index;
	//INT32U Digital_Gain;
	INT32U Decimal;
	INT32U gc1004_analog_gain;


	gc1004_analog_gain = analog_gain;	 	
	
    if(gc1004_analog_gain>720)   gc1004_analog_gain=720; // max_gain=7.2 
    //if(gc1004_analog_gain>5200)   gc1004_analog_gain=5200; // max_gain=5.2

	Analog_Index=0;
	
	while(Analog_Index<9)
	{
	  if(gc1004_analog_gain<Analog_Multiple[Analog_Index]) 
	  {
		break;
	  }
	  else
	  {
		Analog_Index++; 
	  }
	}

	//Digital_Gain = gc1004_analog_gain*1000/Analog_Multiple[Analog_Index-1];
	//Decimal=(Digital_Gain*64)/1000;
	Decimal = (gc1004_analog_gain << 6)/Analog_Multiple[Analog_Index-1];

	if(gc1004_analog_gain>400)
	{
      gc1004_sccb_write(0x66,  0x1c); 
	  //DBG_PRINT("dark_current_ratio[0x66] set 0x1c\r\n");
	}
	if(gc1004_analog_gain<325)
    {
      gc1004_sccb_write( 0x66,  0x20); 
	   // DBG_PRINT("dark_current_ratio[0x66] set 0x20\r\n");
	}
	
	
#if 1
	//DBG_PRINT("pre gain = 0x%x, a gain = 0x%x\r\n\r\n\r\n", Decimal, Analog_Index-1);
	gc1004_sccb_write( 0xb1,  Decimal>>6); 
	gc1004_sccb_write( 0xb2,  (Decimal<<2)&0xfc);
	gc1004_sccb_write( 0xb6,   Analog_Index-1);
#else
	gc1004_sccb_write( 0xb1, 0x01); 
	gc1004_sccb_write( 0xb2, 0x00);
	gc1004_sccb_write( 0xb6, 0x06);
#endif

}
#endif

int gc1004_set_exposure_time(void)
{	
	INT8U lsb_time, msb_time;
	int idx;

	// From agoritham calc new data update to gc1004_seInfo.
	gc1004_seInfo.sensor_ev_idx += gc1004_seInfo.ae_ev_idx;
	if(gc1004_seInfo.sensor_ev_idx >= gc1004_seInfo.max_ev_idx) gc1004_seInfo.sensor_ev_idx = gc1004_seInfo.max_ev_idx;
	if(gc1004_seInfo.sensor_ev_idx < 0) gc1004_seInfo.sensor_ev_idx = 0;
	
	idx = gc1004_seInfo.sensor_ev_idx * 3;
	gc1004_seInfo.time = p_expTime_table[idx];
	gc1004_seInfo.analog_gain = p_expTime_table[idx+1];
	gc1004_seInfo.digital_gain = p_expTime_table[idx+2];
	//DBG_PRINT("ev idx %d.\r\n", gc1004_seInfo.sensor_ev_idx );
	//DBG_PRINT("T %d, ag %d, ev %d.\r\n", gc1004_seInfo.time, gc1004_seInfo.analog_gain, gc1004_seInfo.sensor_ev_idx );
	//DBG_PRINT("Time = %d, a gain = %d, d gain = %d, ev idx = %d [%d]\r\n", gc1004_seInfo.time, gc1004_seInfo.analog_gain, gc1004_seInfo.digital_gain, gc1004_seInfo.sensor_ev_idx, gc1004_seInfo.ae_ev_idx );
	//digital_gain = ((si->digital_gain >> 2) & 0xFF);	//0x40:1x, 0xff:4x
	// set exposure time
	lsb_time = (INT8U)(gc1004_seInfo.time & 0xFF);
	msb_time = (INT8U)((gc1004_seInfo.time >>8 ) & 0x1F);
		
	//sccb_write(GC1004_SLAVE_ID, 0x04 , lsb_time );
	//sccb_write(GC1004_SLAVE_ID, 0x03 , msb_time );

	gc1004_sccb_write(0x04, lsb_time);
	gc1004_sccb_write(0x03, msb_time);

	gc1004_cvt_analog_gain(gc1004_seInfo.analog_gain);
	
	gc1004_seInfo.ae_ev_idx = 0;
	return 0;
}



void gc1004_get_exposure_time(sensor_exposure_t *se)
{
	//int ret=0;
	gp_memcpy((INT8S *)se, (INT8S *)&gc1004_seInfo, sizeof(sensor_exposure_t));

}

void gc1004_set_exp_freq(int freq)
{
	if(freq == 50)
	{
		if(GC_CLK == GC_48MHZ) {
			gc1004_seInfo.sensor_ev_idx = GC1004_50HZ_INIT_EV_IDX_48MHz;
			gc1004_seInfo.ae_ev_idx = 0;
			gc1004_seInfo.daylight_ev_idx= GC1004_50HZ_DAY_EV_IDX_48MHz;
			gc1004_seInfo.night_ev_idx= GC1004_50HZ_NIGHT_EV_IDX_48MHz;
			gc1004_seInfo.max_ev_idx = GC1004_50HZ_MAX_EXP_IDX_48MHz - 1;
			gc1004_seInfo.total_ev_idx = GC1004_50HZ_EXP_TIME_TOTAL_48MHz;
		} else {
			gc1004_seInfo.sensor_ev_idx = GC1004_50HZ_INIT_EV_IDX_42MHz;
			gc1004_seInfo.ae_ev_idx = 0;
			gc1004_seInfo.daylight_ev_idx= GC1004_50HZ_DAY_EV_IDX_42MHz;
			gc1004_seInfo.night_ev_idx= GC1004_50HZ_NIGHT_EV_IDX_42MHz;
			gc1004_seInfo.max_ev_idx = GC1004_50HZ_MAX_EXP_IDX_42MHz - 1;
			gc1004_seInfo.total_ev_idx = GC1004_50HZ_EXP_TIME_TOTAL_42MHz;
		}

		#if (!GC1004_GC_AE)
			p_expTime_table = (int *)g_GC1004_exp_time_gain_50Hz;
		#else
			if(GC_CLK == GC_48MHZ) {
				p_expTime_table = (int *)g_GC1004_exp_time_gain_50Hz_48MHz;
				DBG_PRINT("p_expTime_table = (int *)g_GC1004_exp_time_gain_50Hz_48MHz\r\n");
			} else {
				p_expTime_table = (int *)g_GC1004_exp_time_gain_50Hz_42MHz;
				DBG_PRINT("p_expTime_table = (int *)g_GC1004_exp_time_gain_50Hz_42MHz\r\n");				
			}
		#endif
	}
	else if(freq == 60)
	{
		if(GC_CLK == GC_48MHZ) {
			gc1004_seInfo.sensor_ev_idx = GC1004_60HZ_INIT_EV_IDX_48MHz;
			gc1004_seInfo.ae_ev_idx = 0;
			gc1004_seInfo.daylight_ev_idx= GC1004_60HZ_DAY_EV_IDX_48MHz;
			gc1004_seInfo.night_ev_idx= GC1004_60HZ_NIGHT_EV_IDX_48MHz;
			gc1004_seInfo.max_ev_idx = GC1004_60HZ_MAX_EXP_IDX_48MHz - 1;
			gc1004_seInfo.total_ev_idx = GC1004_60HZ_EXP_TIME_TOTAL_48MHz;
		} else {
			gc1004_seInfo.sensor_ev_idx = GC1004_60HZ_INIT_EV_IDX_42MHz;
			gc1004_seInfo.ae_ev_idx = 0;
			gc1004_seInfo.daylight_ev_idx= GC1004_60HZ_DAY_EV_IDX_42MHz;
			gc1004_seInfo.night_ev_idx= GC1004_60HZ_NIGHT_EV_IDX_42MHz;
			gc1004_seInfo.max_ev_idx = GC1004_60HZ_MAX_EXP_IDX_42MHz - 1;
			gc1004_seInfo.total_ev_idx = GC1004_60HZ_EXP_TIME_TOTAL_42MHz;			
		}
		#if (!GC1004_GC_AE)
			p_expTime_table = (int *)g_GC1004_exp_time_gain_60Hz;
		#else
			if(GC_CLK == GC_48MHZ) {
				p_expTime_table = (int *)g_GC1004_exp_time_gain_60Hz_48MHz;
			} else {
				p_expTime_table = (int *)g_GC1004_exp_time_gain_60Hz_42MHz;
			}
		#endif
	}
}

static void gc1004_cdsp_eof_isr(void)
{
/*	if(gc1004_read_en == 1) {
		gc1004_read_en = 2;
		gc1004_set_exposure_time(&gc1004_seInfo);
	}  else if(gc1004_read_en == 2) {
		gc1004_read_en = 0;
		gc1004_set_exposure_gain();
	}
*/
//nickfu 20150514
	if(gc1004_read_en == 1) {		
		gc1004_set_exposure_time();
		gc1004_read_en = 0;
		//DBG_PRINT("SET GC1004 exp done\r\n");
	}

}


static INT32S gc1004_set_ctrl(gpCdspCtrl_t *ctrl)
{
	INT32S ret;

	switch(ctrl->id)
	{
	case V4L2_CID_BACKLIGHT_COMPENSATION:
		DBG_PRINT("NightMode = %d\n", ctrl->value);
		if(ctrl->value) {	// NIGH MODE ON
			
		} else {	// NIGH MODE OFF
			
		}
		break;
		
	case V4L2_CID_EXPOSURE:
		{
			sensor_exposure_t *si;
			
			si = (sensor_exposure_t *) ctrl->value;
			gc1004_seInfo.userISO = si->userISO;
			if(p_expTime_table != 0 && gc1004_read_en == 0) {				
				gc1004_seInfo.ae_ev_idx = si->ae_ev_idx;
				gc1004_read_en = 1;
				//DBG_PRINT("V4L2_CID_EXPOSURE gc1004_seInfo.ae_ev_idx = %d\r\n", gc1004_seInfo.ae_ev_idx);
			} 
		}
		break;
		
	case V4L2_CID_POWER_LINE_FREQUENCY:
		gc1004_set_exp_freq(ctrl->value);
		break;
		
	default:
		return STATUS_FAIL;			
	}

	return STATUS_OK;
}

static INT32S gc1004_get_ctrl(gpCdspCtrl_t *ctrl)
{
	switch(ctrl->id)
	{
	case V4L2_CID_EXPOSURE:
		//gc1004_get_exposure_time(&gc1004_seInfo);
		ctrl->value = (int)&gc1004_seInfo;
		break;
		
	case V4L2_CID_BRIGHTNESS:
		//ctrl->value = 64 - (sensor_total_ev - ov9712_seInfo.max_ev_idx);
		break;
		
	default:
		return STATUS_FAIL;		
	}

	return STATUS_OK;
}

static const gpCdspSensor_t gc1004_ctrl =
{
	gc1004_set_ctrl,
	gc1004_get_ctrl
};

static void gc1004_set_favorite(void)
{
	myFav.ob_val = (INT16U)g_GC1004_FavTable[0];
	myFav.ae_target= (INT16U)g_GC1004_FavTable[1];
	myFav.ae_target_night= (INT16U)g_GC1004_FavTable[2];
	myFav.awb_mode = (INT16U)g_GC1004_FavTable[3];
	myFav.color_mode = (INT16U)g_GC1004_FavTable[4];
	myFav.iso = (INT16U)g_GC1004_FavTable[5];
	myFav.ev = (INT16U)g_GC1004_FavTable[6];
	myFav.day_hue_u_offset = (INT8S)g_GC1004_FavTable[7];
	myFav.day_hue_v_offset = (INT8S)g_GC1004_FavTable[8];
	myFav.day_hue_y_offset = (INT8S)g_GC1004_FavTable[9];
	myFav.day_sat_y_scale = (INT8S)g_GC1004_FavTable[10];
	myFav.day_sat_u_scale = (INT8S)g_GC1004_FavTable[11];
	myFav.day_sat_v_scale = (INT8S)g_GC1004_FavTable[12];
	myFav.day_edge= (INT8U)g_GC1004_FavTable[13];

	myFav.night_wb_offset = (INT8S)g_GC1004_FavTable[14];
	myFav.night_hue_u_offset = (INT8S)g_GC1004_FavTable[15];
	myFav.night_hue_v_offset = (INT8S)g_GC1004_FavTable[16];
	myFav.night_hue_y_offset = (INT8S)g_GC1004_FavTable[17];
	myFav.night_sat_y_scale = (INT8S)g_GC1004_FavTable[18];
	myFav.night_sat_u_scale = (INT8S)g_GC1004_FavTable[19];
	myFav.night_sat_v_scale = (INT8S)g_GC1004_FavTable[20];
	myFav.night_edge= (INT8U)g_GC1004_FavTable[21];
	myFav.night_wb_offset = (INT8S)g_GC1004_FavTable[22];
}


static int gc1004_init(void)
{
	gc1004_seInfo.max_time = GC1004_MAX_EXPOSURE_TIME;
	gc1004_seInfo.min_time = GC1004_MIN_EXPOSURE_TIME;

	gc1004_seInfo.max_digital_gain = GC1004_MAX_DIGITAL_GAIN ;
	gc1004_seInfo.min_digital_gain = GC1004_MIN_DIGITAL_GAIN ;

	gc1004_seInfo.max_analog_gain = GC1004_MAX_ANALOG_GAIN;
	gc1004_seInfo.min_analog_gain = GC1004_MIN_ANALOG_GAIN;

	gc1004_seInfo.analog_gain = gc1004_seInfo.min_analog_gain;
	gc1004_seInfo.digital_gain = gc1004_seInfo.min_digital_gain;
	gc1004_seInfo.time = gc1004_seInfo.max_time;// >> 1;
	gc1004_seInfo.userISO = ISO_AUTO;

	gc1004_seInfo.total_ev_idx = GC1004_50HZ_EXP_TIME_TOTAL_48MHz;

	gc1004_set_exp_freq(50);
	
	gc1004_set_favorite();	
	
	DBG_PRINT("gc1004_init\r\n");
	return 0;
}


void gc1004_cdsp_init(void)
{
	
	gc1004_init();
	// Turn on LDO 2.8V for CSI sensor
	drv_l1_power_ldo_28_ctrl(1, LDO_LDO28_3P3V);

	// set Mclk(CSI_CLKO) to IOD12, for MIPI Mclk
	R_FUNPOS1 |= 0x42; 
	// set Mclk(CSI_CLKO) to IOD7, for MIPI Mclk	
	//R_FUNPOS1 |= 0x21;
	drv_l2_sensor_set_mclkout(gc1004_cdsp_mipi_ops.info[0].mclk);

	drv_l1_mipi_init(ENABLE);
	drv_l1_mipi_set_parameter(&gc1004_mipi_cfg);
		
	//gc1004_sensor_calibration_str();
	gc1004_sccb_open();
	
	// cdsp init
	drv_l2_cdsp_open();
	drv_l2_CdspTableRegister((sensor_calibration_t *)&gc1004_cdsp_calibration);
	drv_l2_CdspSensorCtrlRegister((gpCdspSensor_t *)&gc1004_ctrl);

}

/**
 * @brief   un-initialization function
 * @param   sensor format parameters
 * @return 	none
 */
static void gc1004_cdsp_uninit(void)
{
	// disable mclk
	drv_l2_sensor_set_mclkout(MCLK_NONE);

	// cdsp disable
	drv_l2_cdsp_close();

	drv_l1_mipi_init(DISABLE);

	// release sccb
	gc1004_sccb_close();
	
	/* Turn off LDO 2.8V for CSI sensor */
	drv_l1_power_ldo_28_ctrl(0, LDO_LDO28_2P8V);
}	

/**
 * @brief   stream start function
 * @param   info index
 *			
 * @return 	none
 */
static void gc1004_cdsp_stream_on(INT32U index, INT32U bufA, INT32U bufB)
{
	INT16U target_w, target_h;
	gpCdspFmt_t format;
	
	DBG_PRINT("gc1004 index = %d\r\n", index);
	switch(index)
	{
	case 0:
	case 1:
	case 2:
			gc1004_sccb_write_table((regval8_t *)GC1004_MIPI_720P);
		break;
		
	default:
		return;	
	}

	// mclk output

		drv_l2_sensor_set_mclkout(gc1004_cdsp_mipi_ops.info[index].mclk);
		format.image_source = C_CDSP_MIPI;
		format.input_format = gc1004_cdsp_mipi_ops.info[index].input_format;
		format.output_format = gc1004_cdsp_mipi_ops.info[index].output_format;
		target_w = gc1004_cdsp_mipi_ops.info[index].target_w;
		target_h = gc1004_cdsp_mipi_ops.info[index].target_h;
		format.hpixel = gc1004_cdsp_mipi_ops.info[index].sensor_w;
		format.vline = gc1004_cdsp_mipi_ops.info[index].sensor_h;
		format.hoffset = gc1004_cdsp_mipi_ops.info[index].hoffset;
		format.voffset = gc1004_cdsp_mipi_ops.info[index].voffset;
		format.sensor_timing_mode = gc1004_cdsp_mipi_ops.info[index].interface_mode;
		format.sensor_hsync_mode = gc1004_cdsp_mipi_ops.info[index].hsync_active;
		format.sensor_vsync_mode = gc1004_cdsp_mipi_ops.info[index].vsync_active;
	
	if(drv_l2_cdsp_set_fmt(&format) < 0) {
		DBG_PRINT("cdsp set fmt err!!!\r\n");
	}
	
	// set scale down
	if((format.hpixel > target_w) || (format.vline > target_h)) {
		drv_l2_cdsp_set_yuv_scale(target_w, target_h);
	}
	
	// cdsp start
#if 0
	drv_l2_cdsp_stream_on(DISABLE, bufA, bufB);	
#else	
	drv_l2_cdsp_stream_on(ENABLE, bufA, bufB);
	

	// set ae/awb
	drv_l2_cdsp_enable(target_w, target_h, myFav);	

	if( drv_l2_get_raw_yuv_path() == 0)
	{
		#if CAPTURE_RAW_MODE
		save_raw10(g_cdsp_rawcal_mode, g_frame_addr1);
		#else
		save_raw10(g_cdsp_rawcal_mode, DUMMY_BUFFER_ADDRS2);
		#endif	
	}
	drv_l2_CdspIsrRegister(C_ISR_SENSOR, gc1004_cdsp_eof_isr);	

	R_CDSP_MIPI_CTRL &= ~0x7;
	
#endif
}

/**
 * @brief   stream stop function
 * @param   none
 * @return 	none
 */ 
static void gc1004_cdsp_stream_off(void)
{
	drv_l2_cdsp_stream_off();
}	

/**
 * @brief   get info function
 * @param   none
 * @return 	pointer to sensor information data
 */ 
static drv_l2_sensor_info_t* gc1004_cdsp_get_info(INT32U index)
{
	if(index > (MAX_INFO_NUM - 1)) {
		return NULL;
	} else {
		return (drv_l2_sensor_info_t*)&gc1004_cdsp_mipi_ops.info[index];

	}
}

INT32S gc1004_switch_pclk(INT8U flag)
{
	if(flag) {
		GC_CLK = GC_42MHZ;
	} else {
		GC_CLK = GC_48MHZ;
	}
	return 0;
}

const drv_l2_sensor_ops_t gc1004_cdsp_mipi_ops =
{
	SENSOR_GC1004_CDSP_MIPI_NAME,		/* sensor name */
	gc1004_cdsp_init,
	gc1004_cdsp_uninit,
	gc1004_cdsp_stream_on,
	gc1004_cdsp_stream_off,
	gc1004_cdsp_get_info,
	{
		/* 1st info */
		{
			MCLK_24M,					/* MCLK */
			V4L2_PIX_FMT_SBGGR10,		/* input format */
			V4L2_PIX_FMT_YVYU,			/* output format */
			30,							/* FPS in sensor */
			640,						/* target width */
			480, 						/* target height */	
			640,						/* sensor width */
			480, 						/* sensor height */	
			0,							/* sensor h offset */ 
			0,							/* sensor v offset */
			MODE_CCIR_601,				/* input interface */
			MODE_NONE_INTERLACE,		/* interlace mode */			
			MODE_ACTIVE_HIGH,			/* hsync pin active level */
			MODE_ACTIVE_HIGH,			/* vsync pin active level */
		},
		/* 2st info */
		{
			MCLK_24M,					/* MCLK */
			V4L2_PIX_FMT_SBGGR10,		/* input format */
			V4L2_PIX_FMT_YVYU,			/* output format */
			30,							/* FPS in sensor */
			1280,						/* target width */
			720, 						/* target height */	
			1280+2,						/* sensor width */
			720, 						/* sensor height */
			#if SENSOR_FLIP
			7,//8,						/* sensor h offset */ 
			1,                                            /* sensor v offset */
			#else
			8,
			2,
			#endif
			MODE_CCIR_601,				/* input interface */
			MODE_NONE_INTERLACE,		/* interlace mode */			
			MODE_ACTIVE_HIGH,			/* hsync pin active level */
			MODE_ACTIVE_HIGH,			/* vsync pin active level */
		},
		/* 3st info */
		{
			MCLK_24M,					/* MCLK */
			V4L2_PIX_FMT_SBGGR10,		/* input format */
			V4L2_PIX_FMT_VYUY,			/* output format */
			30,							/* FPS in sensor */
			1280,						/* target width */
			800, 						/* target height */	
			1280,						/* sensor width */
			800,		 				/* sensor height */
			0,							/* sensor h offset */ 
			0,							/* sensor v offset */
			MODE_CCIR_601,				/* input interface */
			MODE_NONE_INTERLACE,		/* interlace mode */			
			MODE_ACTIVE_HIGH,			/* hsync pin active level */
			MODE_ACTIVE_HIGH,			/* vsync pin active level */
		},
	}
};


//=== This is for code configuration DON'T REMOVE or MODIFY it ===//
#endif //(USE_SENSOR_NAME == SENSOR_GC1004)     //
//================================================================//
